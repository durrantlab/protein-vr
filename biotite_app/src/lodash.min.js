/*
 almond 0.3.3 Copyright jQuery Foundation and other contributors.
 Released under MIT license, http://github.com/requirejs/almond/LICENSE
*/
var C="function"==typeof Object.defineProperties?Object.defineProperty:function(w,r,l){w!=Array.prototype&&w!=Object.prototype&&(w[r]=l.value)},D="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function E(w){if(w){for(var r=D,l=["Math","sign"],t=0;t<l.length-1;t++){var a=l[t];a in r||(r[a]={});r=r[a]}l=l[l.length-1];t=r[l];w=w(t);w!=t&&null!=w&&C(r,l,{configurable:!0,writable:!0,value:w})}}
E(function(w){return w?w:function(r){r=Number(r);return 0===r||isNaN(r)?r:0<r?1:-1}});
(function(){var w,r,l;(function(t){function a(a,e){var b,c;e=e&&e.split("/");var k=q.map,z=k&&k["*"]||{};if(a){a=a.split("/");var d=a.length-1;q.eb&&x.test(a[d])&&(a[d]=a[d].replace(x,""));"."===a[0].charAt(0)&&e&&(d=e.slice(0,e.length-1),a=d.concat(a));for(d=0;d<a.length;d++){var n=a[d];"."===n?(a.splice(d,1),--d):".."===n&&0!==d&&(1!==d||".."!==a[2])&&".."!==a[d-1]&&0<d&&(a.splice(d-1,2),d-=2)}a=a.join("/")}if((e||z)&&k){n=a.split("/");for(d=n.length;0<d;--d){var g=n.slice(0,d).join("/");if(e)for(c=
e.length;0<c;--c)if(b=k[e.slice(0,c).join("/")])if(b=b[g]){var h=b;var v=d;break}if(h)break;if(!f&&z&&z[g]){var f=z[g];var A=d}}!h&&f&&(h=f,v=A);h&&(n.splice(0,v,h),a=n.join("/"))}return a}function f(a,e){return function(){var b=v.call(arguments,0);"string"!==typeof b[0]&&1===b.length&&b.push(null);return p.apply(t,b.concat([a,e]))}}function d(e){return function(b){return a(b,e)}}function g(a){return function(e){c[a]=e}}function b(a){if(k.call(e,a)){var b=e[a];delete e[a];n[a]=!0;y.apply(t,b)}if(!k.call(c,
a)&&!k.call(n,a))throw Error("No "+a);return c[a]}function m(a){var e=a?a.indexOf("!"):-1;if(-1<e){var b=a.substring(0,e);a=a.substring(e+1,a.length)}return[b,a]}function h(a){return function(){return q&&q.M&&q.M[a]||{}}}var p,c={},e={},q={},n={},k=Object.prototype.hasOwnProperty,v=[].slice,x=/\.js$/;var A=function(e,c){e=m(e);var k=e[0];c=c[1];e=e[1];if(k){k=a(k,c);var n=b(k)}k?n&&n.normalize?e=n.normalize(e,d(c)):e=a(e,c):(e=a(e,c),e=m(e),k=e[0],e=e[1],k&&(n=b(k)));return{ga:k?k+"!"+e:e,n:e,gb:k,
p:n}};var u={Pa:function(a){return f(a)},G:function(a){var e=c[a];return"undefined"!==typeof e?e:c[a]={}},Ma:function(a){return{id:a,uri:"",G:c[a],M:h(a)}}};var y=function(a,d,h,x){var q,v=[];var p=typeof h;var z=(x=x||a)?m(x):[];if("undefined"===p||"function"===p){d=!d.length&&h.length?["require","exports","module"]:d;for(q=0;q<d.length;q+=1){var y=A(d[q],z);p=y.ga;if("require"===p)v[q]=u.Pa(a);else if("exports"===p){v[q]=u.G(a);var F=!0}else if("module"===p)var l=v[q]=u.Ma(a);else if(k.call(c,p)||
k.call(e,p)||k.call(n,p))v[q]=b(p);else if(y.p)y.p.load(y.n,f(x,!0),g(p),{}),v[q]=c[p];else throw Error(a+" missing "+p);}d=h?h.apply(c[a],v):void 0;a&&(l&&l.G!==t&&l.G!==c[a]?c[a]=l.G:d===t&&F||(c[a]=d))}else a&&(c[a]=h)};w=r=p=function(a,e,k,d,c){if("string"===typeof a)return u[a]?u[a](e):b(A(a,e?m(e):[]).ga);if(!a.splice){q=a;q.Ca&&p(q.Ca,q.ab);if(!e)return;e.splice?(a=e,e=k,k=null):a=t}e=e||function(){};"function"===typeof k&&(k=d,d=c);d?y(t,a,e,k):setTimeout(function(){y(t,a,e,k)},4);return p};
p.M=function(a){return p(a)};w.i=c;l=function(a,b,d){if("string"!==typeof a)throw Error("See almond README: incorrect module build, no module name");b.splice||(d=b,b=[]);k.call(c,a)||k.call(e,a)||(e[a]=[a,b,d])};l.i={jQuery:!0}})();l("external/almond",function(){});l("Vars",["require","exports"],function(l,a){Object.defineProperty(a,"__esModule",{value:!0});a.ba=11;a.T=1.5;a.aa=1;a.ra=2E3;a.S=1.2;a.ta=2.5;a.sa=.1;a.ua=.01;a.xa=500;a.wa=750;a.J=.1;a.$=15;a.va=.05;a.qa=/iPad|iPhone|iPod/.test(navigator.userAgent)&&
!window.MSStream;a.c=function(){a.canvas=document.getElementById("renderCanvas");a.l=new BABYLON.Engine(a.canvas,!0);BABYLON.Database.IDBStorageEnabled=!0;a.a=new BABYLON.Scene(a.l);window.scene=a.a};a.Da=function(){if(void 0===a.L){var f=new BABYLON.Ray(a.a.activeCamera.position,new BABYLON.Vector3(0,-1,0),50);f=a.a.pickWithRay(f,function(a){return"ground"===a.name});a.L=f.distance}};a.Ra=function(f){a.L=f};a.Wa=function(f){var d={createDeviceOrientationCamera:!0};a.a.getEngine().getCaps().multiview&&
(d.useMultiview=!0);a.f=a.a.createDefaultVRExperience(d);document.getElementById("babylonVRiconbtn").style.opacity="0.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=0)";window.vrHelper=a.f;a.b=f;a.b.ma=!0}});l("Cameras/NonVRCamera",["require","exports","../Vars"],function(l,a,f){function d(){g.ellipsoid=new BABYLON.Vector3(1,.5*f.L,1)}Object.defineProperty(a,"__esModule",{value:!0});var g;new BABYLON.Vector3(0,0,0);a.c=function(){g=f.a.activeCamera;g.keysUp=[87,38];g.keysDown=
[83,40];g.keysLeft=[65,37];g.keysRight=[68,39];d();f.a.collisionsEnabled=!0;g.checkCollisions=!0;g.speed=.1;g.attachControl(f.canvas,!0);g._updatePosition()};a.Qa=d});l("Cameras/Setup",["require","exports","../Vars","./NonVRCamera"],function(l,a,f,d){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){a.U=f.a.cameras.filter(function(a){return-1===a.name.indexOf("VR")})[0];var g=new BABYLON.DeviceOrientationCamera("DevOr_camera",a.U.position.clone(),f.a,!0);g.rotation=a.U.rotation;f.a.activeCamera=
g;f.a.activeCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.U.rotation);f.Da();d.c()}});l("Navigation/Points",["require","exports","../Cameras/CommonCamera","../Vars","./Pickables"],function(l,a,f,d,g){function b(b){a.h.copyFrom(b)}function m(){if(3===d.b.g)var c=d.a.activeCamera.getForwardRay();else if(2===d.b.g||1===d.b.g){c=void 0;1===d.b.g?(c=d.f.rightControllerGazeTrackerMesh,c||(c=d.f.leftControllerGazeTrackerMesh)):2===d.b.g&&(c=d.f.gazeTrackerMesh);if(!c){console.log("error!");
return}c.isVisible?b(c.absolutePosition):b(a.H);c=f.m();c=new BABYLON.Ray(c,a.h.subtract(c))}else console.log("Unexpected error.");h(c)}function h(c,e){void 0===e&&(e=!0);c=d.a.pickWithRay(c,function(a){return g.fa(a)});c.hit&&c.distance<d.$?(e&&b(c.pickedPoint),g.C(c.pickedMesh)):(b(a.H),g.C(void 0))}function p(a){a=new BABYLON.Ray(a,new BABYLON.Vector3(0,-1,0),50);return d.a.pickWithRay(a,function(a){return a.id===d.b.j.id})}Object.defineProperty(a,"__esModule",{value:!0});a.H=new BABYLON.Vector3(-1E3,
1E3,1E3);a.W=new BABYLON.Vector3(0,0,0);a.X=new BABYLON.Vector3(0,0,0);a.h=new BABYLON.Vector3(0,0,0);a.hb=b;a.c=function(){d.a.registerBeforeRender(function(){m();void 0===a.h?(b(a.H),g.C(void 0)):10<BABYLON.Vector3.Distance(f.m(),a.h)&&(b(a.H),g.C(void 0));d.b.na.position.copyFrom(a.h);void 0!==g.s&&(d.b.na.isVisible=g.s!==g.v);var c=p(f.m()).pickedPoint;c&&(a.W=c);if(c=p(a.h).pickedPoint)a.X=c})};a.ib=m;a.Ha=p});l("Cameras/CommonCamera",["require","exports","../Navigation/Points","../Vars"],function(l,
a,f,d){function g(){if(3===d.b.g)return new BABYLON.Vector3(0,0,0);var a=d.f.webVRCamera,b;a.leftCamera?b=a.leftCamera.globalPosition.subtract(a.position):b=new BABYLON.Vector3(0,0,0);return b}Object.defineProperty(a,"__esModule",{value:!0});var b=new BABYLON.Vector3(1,0,0),m=new BABYLON.Vector3(1,0,0);a.m=function(){var a=d.a.activeCamera,b=a.position.clone();if(2===d.b.g||1===d.b.g)a.leftCamera?b.copyFrom(a.leftCamera.globalPosition):console.log("Prob here");return b};a.pa=function(a){if(3===d.b.g){var b=
d.a.activeCamera;b.position.copyFrom(a)}else if(2===d.b.g||1===d.b.g)b=d.f.webVRCamera,b.position.copyFrom(a.subtract(g()))};a.ia=function(){if(2===d.b.g||1===d.b.g){var a=f.X.subtract(f.W),g=BABYLON.Vector3.GetAngleBetweenVectors(a,b,m);for(0>a.z&&(g=-g);0>g;)g+=2*Math.PI;for(;g>2*Math.PI;)g-=2*Math.PI;return g+=.5*Math.PI}return d.a.activeCamera.rotation.clone().y};a.Ga=g});l("Mols/Shadows",["require","exports","../Vars"],function(l,a,f){function d(){var a=f.a.lights[0],b=64,d=.9625,h=a.name.match(/blur_([0-9\.]+)/g);
null!==h&&(b=parseFloat(h[0].substr(5)));a=a.name.match(/dark_([0-9\.]+)/g);null!==a&&(d=parseFloat(a[0].substr(5)));return{blur:b,N:d}}Object.defineProperty(a,"__esModule",{value:!0});a.Va=function(){var g=f.a.lights[0],b=d();b.$a=0;b.blur=2;console.log(b);f.qa?console.log("iOS, so not generating shadows... causes an error... See https://forum.babylonjs.com/t/issues-between-shadowgenerator-and-ios-osx/795"):(a.o=new BABYLON.ShadowGenerator(4096,g),a.o.useBlurExponentialShadowMap=!0,a.o.setDarkness(b.N),
a.o.A=!0,a.o.i=b.blur,window.o=a.o)};a.Ea=d;a.Ua=function(){for(var a in f.a.meshes)if(f.a.meshes.hasOwnProperty(a)){var b=f.a.meshes[a];if(-1!==b.name.toLowerCase().indexOf("shadowcatcher")||-1!==b.name.toLowerCase().indexOf("shadow_catcher"))b.material=new BABYLON.ShadowOnlyMaterial("shadow_catch"+a.toString(),f.a),b.material.activeLight=f.a.lights[0],b.receiveShadows=!0}}});l("Scene/Optimizations",["require","exports","../Mols/Shadows","../Vars"],function(l,a,f,d){function g(a){if(void 0!==a){a=
a.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(null===a)return null;a=a.length/3}else a=0;return a}function b(){var a=new BABYLON.SceneOptimizerOptions(25,2E3),b=0;a.optimizations.push(new BABYLON.ShadowsOptimization(b));a.optimizations.push(new BABYLON.LensFlaresOptimization(b));a.optimizations.push(new BABYLON.PostProcessesOptimization(b));a.optimizations.push(new BABYLON.ParticlesOptimization(b));a.optimizations.push(new h(b));b++;a.optimizations.push(new p(b));a.optimizations.push(new h(b));
b++;a.optimizations.push(new BABYLON.TextureOptimization(b,512));a.optimizations.push(new h(b));b++;a.optimizations.push(new BABYLON.RenderTargetsOptimization(b));a.optimizations.push(new BABYLON.TextureOptimization(b,256));a.optimizations.push(new h(b));b++;a.optimizations.push(new BABYLON.HardwareScalingOptimization(b,4));a.optimizations.push(new c(b,500));a.optimizations.push(new h(b));return a}function m(a){null!==a&&a.dispose()}function h(a){var b=this;"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){console.log("Optimization priority:",b.priority);console.log("FPS:",d.l.getFps());console.log("");return!0};this.getDescription=function(){return"Reports the current priority. For debugging."}}function p(a){"undefined"===typeof a&&(a=0);this.priority=a;this.apply=function(){var a=d.a.getMeshByName("surfaces.wrl");m(a);return!0};this.getDescription=function(){return"Removes surface representations."}}function c(a,b,c){void 0===c&&(c=void 0);"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){var a=[],e;for(e in d.a.meshes)if(d.a.meshes.hasOwnProperty(e)){var n=d.a.meshes[e];if(-1===n.name.indexOf("Decimated")){var h=g(n);null!==h&&(h<b||a.push([h,n,void 0===c?1-b/h:c]))}}a.sort(function(a,b){return b[0]-a[0]});for(e in a)if(a.hasOwnProperty(e)){n=a[e][1];for(h=a[e][2];0<n.getLODLevels().length;){var f=n.getLODLevels()[0].mesh;n.removeLODLevel(f);m(f)}n.simplify([{quality:h,distance:.001}],!1,BABYLON.SimplificationType.QUADRATIC,function(){})}return!0};this.getDescription=
function(){return"Simplifies the geometry of complex objects in the scene."}}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){BABYLON.SceneOptimizer.OptimizeAsync(d.a,b());d.a.autoClear=!1;d.a.autoClearDepthAndStencil=!1;for(var a in d.a.meshes)if(d.a.meshes.hasOwnProperty(a)){var c=d.a.meshes[a];-1!==c.name.indexOf("baked")&&void 0!==c.material&&(c.material.diffuseColor=new BABYLON.Color3(0,0,0),c.material.specularColor=new BABYLON.Color3(0,0,0),c.material.emissiveTexture=c.material.diffuseTexture,
c.material.diffuseTexture=null,c.freezeWorldMatrix())}};a.Y=function(a){var b=g(a);null===b||100>b||(b=1+Math.floor(b/d.ra),1<b&&a.subdivide(b))};a.ha=function(a,b){void 0===b&&(b=!0);b&&a.material.freeze()};a.I=function(){f.o&&(d.a.lights[0].autoUpdateExtends=!0,f.o.getShadowMap().refreshRate=BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE,d.a.lights[0].autoUpdateExtends=!1)};a.Oa=m});l("Navigation/Navigation","require exports ../Cameras/CommonCamera ../Cameras/NonVRCamera ../Scene/Optimizations ../Vars ./Pickables ./Points".split(" "),
function(l,a,f,d,g,b,m,h){function p(){v=f.m();b.a.registerBeforeRender(function(){var a=f.m();null===h.Ha(a).pickedMesh?f.pa(v):v=a})}function c(){jQuery("body").keypress(function(a){32===a.charCode&&e()})}function e(){var a=(new Date).getTime();if(!(250>a-x))switch(x=a,console.log("hi"),m.Fa()){case 2:console.log("teleport");q();break;case 4:n();break;case 3:m.s.u()}}function q(a,e){void 0===a&&(a=void 0);void 0===e&&(e=void 0);void 0===e&&(e=function(){});b.f.gazeTrackerMesh.isVisible=!1;var c=
new BABYLON.Animation("animationCameraTeleportation","position",90,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),d=f.m();void 0===a&&(a=new BABYLON.Vector3(h.h.x,h.h.y+b.L,h.h.z));var k=f.Ga();a=a.subtract(k);d=d.subtract(k);c.setKeys([{frame:0,value:d},{frame:b.ba,value:a}]);var n=b.a.activeCamera;n.animations=[];n.animations.push(c);b.a.beginAnimation(n,0,b.ba,!1,1,function(){b.f.gazeTrackerMesh.isVisible=!0;n.animations=[];e()})}function n(){var a=h.X,e=
f.m(),c=h.h.subtract(e),k=c.length(),n;.1*k<b.aa?n=h.h.subtract(c.normalize().scale(b.aa)):.1*k>b.T?n=h.h.subtract(c.normalize().scale(b.T)):.1*k<b.T&&(n=e.add(c.scale(.9)));n.y=h.h.y;n.y-a.y<.5*b.S+.1&&(n.y=a.y+.5*b.S+.1);b.Ra(h.h.y-a.y);q(n,function(){d.Qa()})}function k(){A=jQuery("#capture-clicks");A.click(function(){console.log("clicked!");e()});b.a.registerBeforeRender(function(){var a=b.a.activeCamera.inputs.attached.deviceOrientation;(a=a?0!==a._alpha||0!==a._beta||0!==a._gamma:!1)&&!u?(u=
!0,A.show()):!a&&u&&(u=!1,A.bb())})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){b.b.j=b.a.getMeshByID(b.b.ja);null===b.b.j&&alert("No mesh named "+b.b.ja);b.b.j.checkCollisions=!0;b.b.j.visibility=0;g.Y(b.b.j);m.la({K:e,mesh:b.b.j});b.b.g=3;c();h.c();k();p()};var v,x=0;a.ca=e;var A=void 0,u=!1});l("Navigation/Pickables","require exports ../Cameras/CommonCamera ../Scene/Optimizations ../Vars ./Navigation".split(" "),function(l,a,f,d,g,b){function m(a){void 0===a.K&&(a.K=b.ca);void 0===
a.a&&(a.a=g.a);void 0!==a.mesh&&(a.mesh.actionManager=new BABYLON.ActionManager(a.a),a.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(){3===g.b.g&&a.K()})))}Object.defineProperty(a,"__esModule",{value:!0});var h=[],p=[],c=[];a.C=function(b){a.s=b};a.c=function(){h.push(g.b.j)};a.ya=function(a){h.push(a);p.push(a);d.Y(a);m({mesh:a,K:function(){a.u()}})};a.za=function(a){h.push(a);c.push(a);d.Y(a);m({mesh:a})};a.fa=function(a){return a.id===
g.b.j.id?!0:a.isVisible?-1!==h.indexOf(a):!1};a.Fa=function(){return void 0===a.s?1:a.s===g.b.j?2:-1!==p.indexOf(a.s)?3:-1!==c.indexOf(a.s)?4:a.s===a.v?5:1};a.la=m;a.La=function(){a.v=BABYLON.Mesh.CreateSphere("padNavSphereAroundCamera",4,g.$-1,g.a);a.v.flipFaces(!0);var b=new BABYLON.StandardMaterial("padNavSphereAroundCameraMat",g.a);b.diffuseColor=new BABYLON.Color3(1,1,1);b.specularColor=new BABYLON.Color3(0,0,0);b.i=null;a.v.material=b;a.v.visibility=0;g.a.registerBeforeRender(function(){a.v.position=
f.m()});h.push(a.v)}});l("Cameras/VRControllers","require exports ../Navigation/Navigation ../Navigation/Pickables ../Navigation/Points ../Vars ./CommonCamera ./VRCamera".split(" "),function(l,a,f,d,g,b,m,h){function p(a){a.onTriggerStateChangedObservable.add(function(a){a.pressed&&(a=(new Date).getTime(),a-e>b.xa&&(e=a,f.ca()))})}function c(a){a.onPadStateChangedObservable.add(function(a){(v=a.pressed)&&Math.abs(n)<b.J&&Math.abs(k)<b.J&&console.log("Would reset camera view if you didn't get an error below...")});
a.onPadValuesChangedObservable.add(function(a){n=a.y;k=a.x;Math.abs(k)<b.J&&Math.abs(n)<b.J?k=n=0:.5>Math.abs(k)?k=0:(k+=0<k?-.5:.5,k=2*k)});b.a.registerBeforeRender(function(){if(v){if(!g.h.equals(g.H)){var a=m.m(),c=g.h.subtract(a);c.normalize();c=c.scale(n*b.ua*b.a.getAnimationRatio());m.pa(a.subtract(c))}0!==k&&(a=(new Date).getTime(),a-q<b.wa||(q=a,a=b.f.webVRCamera.rotationQuaternion.toEulerAngles(),a.y+=.25*Math.sign(k)*Math.PI,b.f.webVRCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a)))}})}
Object.defineProperty(a,"__esModule",{value:!0});var e=0,q=0,n=0,k=0,v=!1;a.c=function(){d.La();b.f.webVRCamera.onControllerMeshLoadedObservable.add(function(a){b.b.g=1;console.log("controller loaded");h.Sa();console.log("Isnt there on pickable or something");p(a);c(a)})}});l("Cameras/VRCamera","require exports ../Navigation/Pickables ../Scene/Optimizations ../Vars ./VRControllers".split(" "),function(l,a,f,d,g,b){function m(){g.f.onEnteringVRObservable.add(function(){g.b.g=2;p();f.C(void 0);d.I();
window.vrHelper=g.f});g.f.onExitingVRObservable.add(function(){g.b.g=3;f.C(void 0);d.I()})}function h(){var a=new BABYLON.Mesh("vrNavTargetMesh",g.a),b=new BABYLON.VertexData;b.A=[0,0,0];b.i=[0];b.applyToMesh(a);a.isVisible=!1;return a}function p(){g.f.raySelectionPredicate=function(a){return f.fa(a)};g.f.gazeTrackerMesh=h();g.f.updateGazeTrackerScale=!1;g.f.displayGaze=!0;g.f.enableInteractions()}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m();b.c()};a.Sa=p});l("Mols/CommonLoader",
"require exports ../Navigation/Pickables ../Scene/LoadAndSetup ../Scene/Optimizations ../Vars ./Shadows".split(" "),function(l,a,f,d,g,b,m){Object.defineProperty(a,"__esModule",{value:!0});a.Ba=function(){m.Va();BABYLON.OBJFileLoader.OPTIMIZE_WITH_UV=!0};a.Aa=function(a){m.Ua();void 0!==a.transparentGround&&!0===a.transparentGround&&(b.b.j?(b.b.j.visibility=1,a=new BABYLON.StandardMaterial("transparentGround",b.a),a.diffuseColor=new BABYLON.Color3(1,1,1),a.specularColor=new BABYLON.Color3(0,0,0),
a.emissiveColor=new BABYLON.Color3(0,0,0),a.alpha=b.va,b.b.j.material=a):console.log("Warning: Vars.vrVars.groundMesh not defined."));d.Ka()};a.Ta=function(a){if(void 0!==a.material&&null!==a.material){var b=m.Ea();b=.95<b.N?.05:.4>b.N?.0025:.013636363636363637*b.N-.0029545454545454545;a.material.emissiveColor=new BABYLON.Color3(b,b,b);g.ha(a)}a.scaling.z=-1;a.scaling.x=-1;m.o&&m.o.getShadowMap().renderList.push(a);f.za(a)}});l("Mols/3DMol/VRMLParserWebWorker",["require","exports"],function(l,a){function f(a){var k=
[];a=a.split("geometry IndexedFaceSet {").splice(1);for(var n in a)if(a.hasOwnProperty(n)){var f=a[n],l=void 0,u=void 0,y=void 0,z=void 0;u=g(b("point [","]",f));u=u.map(function(a){return[a[2],a[1],a[0]]});u=m(u);u=h(u);y=g(b("vector [","]",f));y=y.map(function(a){return[a[2],a[1],a[0]]});y=m(y);y=h(y);l=g(b("color [","]",f));l=l.map(function(a){return[a[0],a[1],a[2],1]});l=m(l);l=h(l);z=b("coordIndex [","]",f).split(",").map(function(a){return parseInt(a,10)}).filter(function(a){return-1!==a&&!isNaN(a)&&
void 0!==a});k.push({colorsFlat:l,coorsFlat:u,normsFlat:y,trisIdxs:z})}k=p(c(k).map(function(a){return-a}),k);if(q){e=[];n=["colorsFlat","coorsFlat","normsFlat","trisIdxs"];for(var t in k)if(k.hasOwnProperty(t))for(var r in n)if(n.hasOwnProperty(r)){a=n[r];f=d(k[t][a]);for(var w in f)f.hasOwnProperty(w)&&e.push([parseInt(t,10),a,f[w]])}return[]}return k}function d(a){for(var b=[],c=0,d=a.length;c<d;)b.push(a.slice(c,c+=1E5));return b}function g(a){return a.split(",").map(function(a){a=a.replace(/\n/g,
"").replace(/^ +/gm,"");return a.split(" ").map(function(a){return parseFloat(a)})})}function b(a,b,c){a=c.split(a,2);if(1>=a.length)return"";a=a[1].split(b,2);return a[0]}function m(a){if(6E4>=a.length)return[].concat.apply([],a);console.log("large array");var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c],e;for(e in d)d.hasOwnProperty(e)&&b.push(d[e])}return b}function h(a){return a.filter(function(a){return!isNaN(a)&&void 0!==a})}function p(a,b){for(var c in b)b.hasOwnProperty(c)&&(b[c].coorsFlat=
b[c].coorsFlat.map(function(b,c){return b+a[c%3]}));return b}function c(a){if(0===a.length)return[0,0,0];var b=a.map(function(a){return a.coorsFlat.length}).reduce(function(a,b){return a+b});if(0===b)return[0,0,0];var c=0,d=0,e=0,f;for(f in a)if(a.hasOwnProperty(f)){var g=a[f];c+=g.coorsFlat.map(function(a,b){return 0===b%3?a:0}).reduce(function(a,b){return a+b});d+=g.coorsFlat.map(function(a,b){return 1===b%3?a:0}).reduce(function(a,b){return a+b});e+=g.coorsFlat.map(function(a,b){return 2===b%3?
a:0}).reduce(function(a,b){return a+b})}a=b/3;return[c/a,d/a,e/a]}Object.defineProperty(a,"__esModule",{value:!0});var e=void 0,q=!1;"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&(q=!0);q&&(self.onmessage=function(a){var b=a.data.cmd;a=a.data.data;"start"===b&&(f(a),b="sendDataChunk");"sendDataChunk"===b&&(b=e.shift(),postMessage({chunk:b,status:0===e.length?"done":"more"}))});a.Ja=f});l("Mols/3DMol/VRML","require exports ../../Scene/Optimizations ../../Vars ../CommonLoader ./VRMLParserWebWorker".split(" "),
function(l,a,f,d,g,b){function m(a){c=[];"undefined"!==typeof Worker?("undefined"===typeof q&&(q=new Worker("VRMLParserWebWorker.js")),q.onmessage=function(b){var d=b.data;b=d.chunk;d=d.status;var e=b[0],k=b[1];b=b[2];c.length===e&&c.push({coorsFlat:[],normsFlat:[],colorsFlat:[],trisIdxs:[]});c[e][k].push.apply(c[e][k],b);switch(d){case "more":q.postMessage({cmd:"sendDataChunk",data:void 0});break;case "done":console.log(c);a();break;default:console.log("Error here!")}},q.postMessage({cmd:"start",
data:e})):(c=b.Ja(e),a())}function h(){var a=[],b;for(b in c)if(c.hasOwnProperty(b)){var e=c[b],f=new BABYLON.VertexData;f.positions=e.coorsFlat;f.indices=e.trisIdxs;f.normals=e.normsFlat;f.colors=e.colorsFlat;e=new BABYLON.Mesh("mesh_3dmol_tmp"+b,d.a);f.applyToMesh(e);f=new BABYLON.StandardMaterial("Material",d.a);f.diffuseColor=new BABYLON.Color3(1,1,1);f.emissiveColor=new BABYLON.Color3(0,0,0);f.specularColor=new BABYLON.Color3(0,0,0);e.material=f;a.push(e)}if(0<a.length){var h=BABYLON.Mesh.MergeMeshes(a,
!0,!0);h.name="MeshFrom3DMol"+Math.random().toString();h.id=h.name;g.Ta(h)}return h}function p(a,b){if(void 0!==a){a.scaling=new BABYLON.Vector3(1,1,1);a.position=new BABYLON.Vector3(0,0,0);d.a.render();var c=b.getBoundingInfo().boundingBox;b=Object.keys(c.maximumWorld).map(function(a){return c.maximumWorld[a]-c.minimumWorld[a]});var e=a.getBoundingInfo().boundingBox,g=Object.keys(e.maximumWorld).map(function(a){return e.maximumWorld[a]-e.minimumWorld[a]});b=b.map(function(a,b){return a/g[b]});b=
Math.min.apply(null,b);a.scaling=new BABYLON.Vector3(b,b,b);d.a.render();b=e.centerWorld.subtract(c.centerWorld);a.position=a.position.subtract(b);f.I()}}Object.defineProperty(a,"__esModule",{value:!0});var c=[],e,q;a.c=function(){jQuery("body").append('<div\n        id="mol-container"\n        class="mol-container"\n        style="display:none;"></div>');var b=jQuery("#mol-container");a.w=$3Dmol.createViewer(b,{backgroundColor:"white"});window.viewer=a.w};a.Ia=function(b){jQuery.ajax("https://files.rcsb.org/view/1XDN.pdb",
{success:function(c){a.w.addModel(c,"pdb");b()},error:function(a,b,c){console.error("Failed to load PDB https://files.rcsb.org/view/1XDN.pdb: "+c)}})};a.render=function(b,f){void 0===b&&(b=!0);void 0===f&&(f=function(){});d.l.hideLoadingUI();a.w.render();b&&(e=a.w.exportVRML(),m(function(){var a=h();p(a,d.a.getMeshByName("protein_box"));f(a);c=[]}))};a.cb=h;a.fb=p});l("Mols/3DMol/Visualize",["require","exports","../../Scene/Optimizations","./VRML"],function(l,a,f,d){function g(a,b,d){a.sort();return{B:a.join("-")+
"-"+b,V:a.join("-")+"-"+b+"-"+d}}function b(a){var b=a.map(function(a){return a}),c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(d.toUpperCase());b.push(d.toLowerCase())}return b=b.filter(function(a,c){return b.indexOf(a)>=c})}Object.defineProperty(a,"__esModule",{value:!0});var m={},h={All:{},Protein:{resn:b("ALA ARG ASP ASN ASX CYS GLN GLU GLX GLY HIS HSP HYP ILE LEU LYS MET PCA PHE PRO TRP TYR VAL GLU SER THR MSE".split(" "))},Acidic:{resn:b(["ASP","GLU"])},Cyclic:{resn:b(["HIS","PHE",
"PRO","TRP","TYR"])},Aliphatic:{resn:b(["ALA","GLY","ILE","LEU","VAL"])},Aromatic:{resn:b(["HIS","PHE","TRP","TYR"])},Basic:{resn:b(["ARG","HIS","LYS","HSP"])},Charged:{resn:b("ASP GLU ARG HIS LYS HSP".split(" "))},Hydrophobic:{resn:b("ALA LEU VAL ILE PRO PHE MET TRP".split(" "))},Neutral:{resn:b("VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP".split(" "))},Nucleic:{resn:b("ADE A GUA G CYT C THY T URA U".split(" "))},Purine:{resn:b(["ADE","A","GUA","G"])},Pyrimidine:{resn:b("CYT C THY T URA U".split(" "))},
Ions:{resn:b("AL BA CA CAL CD CES CLA CL CO CS CU CU1 CUA HG IN IOD K MG MN3 MO3 MO4 MO5 MO6 NA NAW OC7 PB POT PT RB SOD TB TL WO4 YB ZN ZN1 ZN2".split(" "))},Water:{resn:b(["WAT","HOH","TIP","TIP3"])}};h.Ligand={not:{or:[h.Protein,h.Nucleic,h.Ions,h.Water]}};var p={Element:{colorscheme:"default"},Red:{color:"red"},Blue:{color:"blue"},Green:{color:"green"},Orange:{color:"orange"},Yellow:{color:"yellow"},Purple:{color:"purple"},Spectrum:{color:"spectrum"}};a.Za=function(a,b,l){var c=g(a,b,l);if("Hide"===
l)for(var e in m)m.hasOwnProperty(e)&&(a=m[e],a.B===c.B&&(a.mesh.isVisible=!1,console.log("Hiding existing mesh...")));else void 0!==m[c.V]?(m[c.V].mesh.isVisible=!0,console.log("showing existing mesh...")):(d.w.setStyle({}),e={},e[b.toLowerCase()]=p[l],a={and:a.map(function(a){return h[a]})},d.w.addStyle(a,e),d.render(!0,function(a){for(var b in m)if(m.hasOwnProperty(b)){var d=m[b];d.B===c.B&&(f.Oa(d.mesh),delete m[b],console.log("deleting old mesh..."))}m[c.V]={B:c.B,mesh:a};console.log("added new mesh");
console.log(m)}))}});l("UI/Menu3D","require exports ../Cameras/CommonCamera ../Mols/3DMol/Visualize ../Navigation/Pickables ../Navigation/Points ../Vars".split(" "),function(l,a,f,d,g,b,m){function h(){function a(a){if(b.hasOwnProperty(a)){x[a]=new BABYLON.GUI.SpherePanel;v.addControl(x[a]);x[a].blockLayout=!0;b[a].reverse();var c=function(c){if(b[a].hasOwnProperty(c)){c=b[a][c];var d=c.D,e=c.P;k.push(new B({u:function(){e()},default:!1,O:d,ka:function(a){a.isVisible(!1)},level:parseInt(a,10),name:"menu-visible-button-"+
d,oa:x[a],R:d,color:c.color}));x[a].columns=4;window.panels=x;x[a].blockLayout=!1;x[a].linkToTransformNode(t);setInterval(function(){x[a].radius=m.ta;x[a].margin=m.sa},1E3)}},d;for(d in b[a])c(d)}}var b=p();b=c(b);t=new BABYLON.TransformNode("");v=new BABYLON.GUI.GUI3DManager(m.a);for(var d in b)a(d)}function p(){function a(e,f,g){function h(d){if(k.hasOwnProperty(d)){d=k[d];var h=e[d];c[f]=void 0===c[f]?[]:c[f];switch(typeof h){case "function":c[f].push({P:h,D:d,F:g});break;case "object":var l=b(f+
1);c[f].push({color:r,P:function(){q(l)},D:d+" \u21e8",F:g});a(h,l,f);break;default:alert("error!")}}}d.push(f);var k=Object.keys(e),l;for(l in k)h(l)}function b(a){for(;-1!==d.indexOf(a);)a++;return a}var c={},d=[];a(n,1,void 0);return c}function c(a){function b(b){if(a.hasOwnProperty(b)){a[b].sort(function(a,b){return(""+a.D).localeCompare(b.D)});var c=parseInt(b,10);1<c&&a[b].push({color:w,P:function(){q(a[b][0].F)},D:"Back \u21e6",F:a[b][0].F});0<c&&a[b].push({color:G,P:function(){y.Z()},D:"Close Menu \u00d7",
F:a[b][0].F})}}for(var c in a)b(c);console.log(a);return a}function e(){var a=new BABYLON.GUI.StackPanel3D;v.addControl(a);y=new B({u:function(a){a.value?q(1):q(0);t.position.copyFrom(f.m());t.rotation.y=f.ia()},default:!1,O:"Show Menu",level:0,name:"menu-visible-button",oa:a,R:"Hide Menu"});var c=new BABYLON.TransformNode("");a.linkToTransformNode(c);c.rotation.x=.5*Math.PI;m.a.registerBeforeRender(function(){c.position.copyFrom(b.W);c.position.y+=.1;c.rotation.y=f.ia()})}function q(a){for(var b in k)if(k.hasOwnProperty(b)){var c=
k[b];0===c.level?c.isVisible(!0):c.level===a?c.isVisible(!0):c.isVisible(!1)}}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function a(a){if(b.hasOwnProperty(a)){var e=b[a];h[e]={};a=function(a){if(c[e].hasOwnProperty(a)){var b=c[e][a];h[e][b]={};a=function(a){if(f[e].hasOwnProperty(a)){var c=f[e][a];h[e][b][c]={};a=function(a){if(g.hasOwnProperty(a)){var f=g[a];h[e][b][c][f]=function(){d.Za([e,b],c,f);y.Z()}}};for(var k in g)a(k)}};for(var k in f[e])a(k)}};for(var k in c[e])a(k)}}
var b=["Protein","Ligand","Water","Nucleic"],c={Ligand:["All"],Nucleic:["All"],Protein:["All","Hydrophobic","Hydrophilic","Charged","Aromatic"],Water:["All"]},e=["Stick","Sphere","Surface"],f={Ligand:e,Nucleic:e,Protein:["Cartoon"].concat(e),Water:e},g="Element Red Blue Green Orange Yellow Purple Spectrum Hide".split(" "),h={},k;for(k in b)a(k);return h}(),k=[],v,x={},t,u,y,r=new BABYLON.Color3(.3,.35+.1,.4),w=new BABYLON.Color3(.4,.35+.1,.4),G=new BABYLON.Color3(.4,.35,.4);a.c=function(a){h(a);e();
u=new BABYLON.Sound("click-button","assets/staple-public-domain.mp3",m.a,null,{loop:!1,autoplay:!1,jb:!0,volume:.1})};var B=function(){function a(a){var b=this;this.button=new BABYLON.GUI.HolographicButton(a.name);a.oa.addControl(this.button);if(void 0!==a.color){var c=this.button.mesh.material.clone();c.albedoColor=a.color;this.button.mesh.material=c}this.level=a.level;this.A=new BABYLON.GUI.TextBlock;this.A.color="white";this.A.i=!0;this.value=a.default;this.R=a.R;this.O=a.O;this.u=a.u;this.ea();
this.i=BABYLON.Mesh.CreateSphere(a.name+"-container-mesh",2,m.S,m.a);this.i.position=this.button.node.absolutePosition;this.i.visibility=0;this.i.u=function(){b.Z()};g.ya(this.i);void 0!==a.ka&&a.ka(this)}a.prototype.isVisible=function(a){if(void 0===a)return this.button.isVisible;this.button.isVisible=a;this.i.isVisible=a};a.prototype.Z=function(){u.setPosition(this.i.position.clone());u.play();this.value=!this.value;this.u(this);this.ea()};a.prototype.ea=function(){this.A.text=this.value?this.R:
this.O;this.button.content.dispose();this.button.content=this.A};return a}()});l("Mols/3DMol/ThreeDMol",["require","exports","../CommonLoader","./VRML"],function(l,a,f,d){function g(a){d.c();d.Ia(function(){d.w.setStyle({},{cartoon:{color:"spectrum"}});d.render();f.Aa(a)})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(a){try{jQuery.getScript("https://3Dmol.csb.pitt.edu/build/3Dmol-min.js",function(){g(a)})}catch(m){g(a)}}});l("Mols/Load","require exports ../Scene/Optimizations ../UI/Menu3D ../Vars ./3DMol/ThreeDMol ./CommonLoader".split(" "),
function(l,a,f,d,g,b,m){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m.Ba();jQuery.getJSON("scene_info.json",function(a){!1===a.menuActive&&(g.b.ma=!1);b.c(a);g.b.ma&&d.c(a);f.I()})}});l("UI/LoadingScreens",["require","exports","../Vars"],function(l,a,f){function d(){clearInterval(g)}Object.defineProperty(a,"__esModule",{value:!0});var g;a.Na=function(){document.getElementById("loading-container").outerHTML=""};a.da=function(a){d();f.l.displayLoadingUI();f.l.loadingUIText=a};a.Xa=
function(){var a=90;clearInterval(g);g=setInterval(function(){a+=.02*(99-a);f.l.displayLoadingUI();f.l.loadingUIText="Loading the main scene... "+a.toFixed(0)+"%"},100)};a.Ya=d});l("UI/UI2D",["require","exports","../Vars"],function(l,a,f){function d(){jQuery("body").append('\n        <button\n          title="Click to switch to full screen"\n          id="fullscreen-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:80px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n            <svg\n              style="position:relative; left:0.5px;"\n              width="48" height="48"\n              xmlns="http://www.w3.org/2000/svg"\n              xmlns:svg="http://www.w3.org/2000/svg"\n              clip-rule="evenodd">\n                <g class="layer">\n                    <path d="m47.799999,43.649999l-47.699999,0l0,-39.749999l47.699999,0l0,39.749999zm-1.9875,-37.762499l-43.724999,0l0,35.774999l43.724999,0l0,-35.774999zm-7.95,13.9125l-1.9875,0l0,-6.441487l-22.341487,22.341487l6.441487,0l0,1.9875l-9.9375,0l0,-9.9375l1.9875,0l0,6.441487l22.341487,-22.341487l-6.441487,0l0,-1.9875l9.9375,0l0,9.9375z" fill="#ffffff" id="svg_1"/>\n                </g>\n            </svg>\n        </button>\n\n        <button\n          title="Click for help"\n          id="help-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:140px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n                 <svg version="1.2" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" xml:space="preserve">\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="\n\tM35.5,9.8c1.7,5.4-0.6,8-1.6,8.9c-1.9,1.9-4.5,4.7-5.8,7c-1.5,2.7-4.1,12-6.8,4.4c-3.2-9.1,1.3-11.6,3.5-13.4\n\tc1.5-1.3,3.4-4.3,0.5-5.3c-4-1.3-6.1,5.3-10.7,4c-3-0.8-3.2-4.1-2.2-6.6C15.4,1.7,32.5,0.6,35.5,9.8L35.5,9.8z"/>\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" d="M28.3,39.6c0-5.5-8.5-5.5-8.5,0S28.3,45.1,28.3,39.6\n\t"/>\n</svg>\n\n        </button>\n    ');
jQuery("#fullscreen-button").click(function(){f.l.switchFullscreen(!0);jQuery("#renderCanvas").focus()});jQuery("#help-button").click(function(){window.open("help/index.html","_blank")});document.getElementById("babylonVRiconbtn").style.opacity="1.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=1.0)"}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){d()};window.debugMode=function(){f.a.debugLayer.show();setTimeout(function(){document.getElementById("inspector-host").style.zIndex=
"15";document.getElementById("scene-explorer-host").style.zIndex="15"},500)}});l("Scene/LoadAndSetup","require exports ../Cameras/Setup ../Cameras/VRCamera ../Mols/Load ../Navigation/Navigation ../Navigation/Pickables ../UI/LoadingScreens ../UI/UI2D ../Vars ./Optimizations".split(" "),function(l,a,f,d,g,b,m,h,p,c,e){function q(){var a=BABYLON.Mesh.CreateSphere("navTargetMesh",4,.1,c.a),b=new BABYLON.StandardMaterial("myMaterial",c.a);b.diffuseColor=new BABYLON.Color3(1,0,1);a.material=b;c.Wa({ja:"ground",
na:a});d.c();e.c();window.i=c}function n(a){h.da("Loading the main scene...");BABYLON.SceneLoader.LoadAssetContainer("scene/","scene.babylon",c.a,function(b){h.Xa();c.a.executeWhenReady(function(){b.addAllToScene();c.a.activeCamera=c.a.cameras[0];for(var d=!1,f=0;1<c.a.lights.length;){var g=c.a.lights[f].name.toLowerCase();-1===g.indexOf("shadowlight")&&-1===g.indexOf("shadow_light")?c.a.lights[f].dispose():d?c.a.lights[f].dispose():(d=!0,f++)}for(var h in c.a.meshes)"protein_box"===c.a.meshes[h].name&&
(c.a.getMeshByName("protein_box").isVisible=!1);for(var k in c.a.meshes)if(c.a.meshes[k].material){d=c.a.meshes[k];if(void 0===d.material.emissiveTexture||null===d.material.emissiveTexture)d.material.emissiveTexture=d.material.diffuseTexture,d.material.diffuseColor=new BABYLON.Color3(0,0,0),d.material.specularColor=new BABYLON.Color3(0,0,0),d.material.emissiveColor=new BABYLON.Color3(0,0,0);e.ha(d,!1);m.la({mesh:d,a:c.a})}a()})},function(a){a.lengthComputable&&h.da("ALoading the main scene... "+Math.round(90*
a.loaded/a.total).toString()+"%")})}Object.defineProperty(a,"__esModule",{value:!0});a.load=function(){c.c();h.Na();q();n(function(){f.c();b.c();m.c();p.c();g.c()});window.addEventListener("resize",function(){c.l.resize()})};a.Ka=function(){setTimeout(e.I,1E3);h.Ya();c.a.activeCamera.maxZ=250;c.a.activeCamera.minZ=0;c.l.runRenderLoop(function(){c.a.render()})}});r.M({urlArgs:"bust="+(new Date).getTime()});r(["Scene/LoadAndSetup"],function(l){l.load()});l("Start",function(){})})();
