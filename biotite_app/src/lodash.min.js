/*
 almond 0.3.3 Copyright jQuery Foundation and other contributors.
 Released under MIT license, http://github.com/requirejs/almond/LICENSE
*/
var D="function"==typeof Object.defineProperties?Object.defineProperty:function(w,t,n){w!=Array.prototype&&w!=Object.prototype&&(w[t]=n.value)},E="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function F(w){if(w){for(var t=E,n=["Math","sign"],v=0;v<n.length-1;v++){var a=n[v];a in t||(t[a]={});t=t[a]}n=n[n.length-1];v=t[n];w=w(v);w!=v&&null!=w&&D(t,n,{configurable:!0,writable:!0,value:w})}}
F(function(w){return w?w:function(t){t=Number(t);return 0===t||isNaN(t)?t:0<t?1:-1}});
(function(){var w,t,n;(function(v){function a(a,c){var x,b;c=c&&c.split("/");var d=q.map,f=d&&d["*"]||{};if(a){a=a.split("/");var k=a.length-1;q.cb&&e.test(a[k])&&(a[k]=a[k].replace(e,""));"."===a[0].charAt(0)&&c&&(k=c.slice(0,c.length-1),a=k.concat(a));for(k=0;k<a.length;k++){var l=a[k];"."===l?(a.splice(k,1),--k):".."===l&&0!==k&&(1!==k||".."!==a[2])&&".."!==a[k-1]&&0<k&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((c||f)&&d){l=a.split("/");for(k=l.length;0<k;--k){var r=l.slice(0,k).join("/");if(c)for(b=
c.length;0<b;--b)if(x=d[c.slice(0,b).join("/")])if(x=x[r]){var h=x;var u=k;break}if(h)break;if(!y&&f&&f[r]){var y=f[r];var g=k}}!h&&y&&(h=y,u=g);h&&(l.splice(0,u,h),a=l.join("/"))}return a}function g(a,c){return function(){var e=u.call(arguments,0);"string"!==typeof e[0]&&1===e.length&&e.push(null);return p.apply(v,e.concat([a,c]))}}function f(c){return function(e){return a(e,c)}}function h(a){return function(c){d[a]=c}}function b(a){if(k.call(c,a)){var e=c[a];delete c[a];r[a]=!0;A.apply(v,e)}if(!k.call(d,
a)&&!k.call(r,a))throw Error("No "+a);return d[a]}function m(a){var c=a?a.indexOf("!"):-1;if(-1<c){var e=a.substring(0,c);a=a.substring(c+1,a.length)}return[e,a]}function l(a){return function(){return q&&q.M&&q.M[a]||{}}}var p,d={},c={},q={},r={},k=Object.prototype.hasOwnProperty,u=[].slice,e=/\.js$/;var y=function(c,e){c=m(c);var k=c[0];e=e[1];c=c[1];if(k){k=a(k,e);var d=b(k)}k?d&&d.normalize?c=d.normalize(c,f(e)):c=a(c,e):(c=a(c,e),c=m(c),k=c[0],c=c[1],k&&(d=b(k)));return{ga:k?k+"!"+c:c,n:c,fb:k,
p:d}};var z={require:function(a){return g(a)},G:function(a){var c=d[a];return"undefined"!==typeof c?c:d[a]={}},Ma:function(a){return{id:a,uri:"",G:d[a],M:l(a)}}};var A=function(a,e,f,l){var q,u=[];var p=typeof f;var x=(l=l||a)?m(l):[];if("undefined"===p||"function"===p){e=!e.length&&f.length?["require","exports","module"]:e;for(q=0;q<e.length;q+=1){var A=y(e[q],x);p=A.ga;if("require"===p)u[q]=z.require(a);else if("exports"===p){u[q]=z.G(a);var B=!0}else if("module"===p)var n=u[q]=z.Ma(a);else if(k.call(d,
p)||k.call(c,p)||k.call(r,p))u[q]=b(p);else if(A.p)A.p.load(A.n,g(l,!0),h(p),{}),u[q]=d[p];else throw Error(a+" missing "+p);}e=f?f.apply(d[a],u):void 0;a&&(n&&n.G!==v&&n.G!==d[a]?d[a]=n.G:e===v&&B||(d[a]=e))}else a&&(d[a]=f)};w=t=p=function(a,c,e,k,d){if("string"===typeof a)return z[a]?z[a](c):b(y(a,c?m(c):[]).ga);if(!a.splice){q=a;q.Ca&&p(q.Ca,q.$a);if(!c)return;c.splice?(a=c,c=e,e=null):a=v}c=c||function(){};"function"===typeof e&&(e=k,k=d);k?A(v,a,c,e):setTimeout(function(){A(v,a,c,e)},4);return p};
p.M=function(a){return p(a)};w.i=d;n=function(a,e,f){if("string"!==typeof a)throw Error("See almond README: incorrect module build, no module name");e.splice||(f=e,e=[]);k.call(d,a)||k.call(c,a)||(c[a]=[a,e,f])};n.i={jQuery:!0}})();n("external/almond",function(){});n("Vars",["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.ba=11;a.T=1.5;a.aa=1;a.ra=2E3;a.S=1.2;a.ta=2.5;a.sa=.1;a.ua=.01;a.xa=500;a.wa=750;a.J=.1;a.$=15;a.va=.05;a.qa=/iPad|iPhone|iPod/.test(navigator.userAgent)&&
!window.MSStream;a.c=function(){a.canvas=document.getElementById("renderCanvas");a.l=new BABYLON.Engine(a.canvas,!0);BABYLON.Database.IDBStorageEnabled=!0;a.a=new BABYLON.Scene(a.l);window.scene=a.a};a.Da=function(){if(void 0===a.L){var g=new BABYLON.Ray(a.a.activeCamera.position,new BABYLON.Vector3(0,-1,0),50);g=a.a.pickWithRay(g,function(a){return"ground"===a.name});a.L=g.distance}};a.Qa=function(g){a.L=g};a.Va=function(g){var f={createDeviceOrientationCamera:!0};a.a.getEngine().getCaps().multiview&&
(f.useMultiview=!0);a.f=a.a.createDefaultVRExperience(f);document.getElementById("babylonVRiconbtn").style.opacity="0.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=0)";window.vrHelper=a.f;a.b=g;a.b.ma=!0}});n("Cameras/NonVRCamera",["require","exports","../Vars"],function(n,a,g){function f(){h.ellipsoid=new BABYLON.Vector3(1,.5*g.L,1)}Object.defineProperty(a,"__esModule",{value:!0});var h;new BABYLON.Vector3(0,0,0);a.c=function(){h=g.a.activeCamera;h.keysUp=[87,38];h.keysDown=
[83,40];h.keysLeft=[65,37];h.keysRight=[68,39];f();g.a.collisionsEnabled=!0;h.checkCollisions=!0;h.speed=.1;h.attachControl(g.canvas,!0);h._updatePosition()};a.Pa=f});n("Cameras/Setup",["require","exports","../Vars","./NonVRCamera"],function(n,a,g,f){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){a.U=g.a.cameras.filter(function(a){return-1===a.name.indexOf("VR")})[0];var h=new BABYLON.DeviceOrientationCamera("DevOr_camera",a.U.position.clone(),g.a,!0);h.rotation=a.U.rotation;g.a.activeCamera=
h;g.a.activeCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.U.rotation);g.Da();f.c()}});n("Navigation/Points",["require","exports","../Cameras/CommonCamera","../Vars","./Pickables"],function(n,a,g,f,h){function b(d){a.h.copyFrom(d)}function m(){if(3===f.b.g)var d=f.a.activeCamera.getForwardRay();else if(2===f.b.g||1===f.b.g){d=void 0;1===f.b.g?(d=f.f.rightControllerGazeTrackerMesh,d||(d=f.f.leftControllerGazeTrackerMesh)):2===f.b.g&&(d=f.f.gazeTrackerMesh);if(!d){console.log("error!");
return}d.isVisible?b(d.absolutePosition):b(a.H);d=g.m();d=new BABYLON.Ray(d,a.h.subtract(d))}else console.log("Unexpected error.");l(d)}function l(d,c){void 0===c&&(c=!0);d=f.a.pickWithRay(d,function(a){return h.fa(a)});d.hit&&d.distance<f.$?(c&&b(d.pickedPoint),h.C(d.pickedMesh)):(b(a.H),h.C(void 0))}function p(a){a=new BABYLON.Ray(a,new BABYLON.Vector3(0,-1,0),50);return f.a.pickWithRay(a,function(a){return a.id===f.b.j.id})}Object.defineProperty(a,"__esModule",{value:!0});a.H=new BABYLON.Vector3(-1E3,
1E3,1E3);a.W=new BABYLON.Vector3(0,0,0);a.X=new BABYLON.Vector3(0,0,0);a.h=new BABYLON.Vector3(0,0,0);a.gb=b;a.c=function(){f.a.registerBeforeRender(function(){m();void 0===a.h?(b(a.H),h.C(void 0)):10<BABYLON.Vector3.Distance(g.m(),a.h)&&(b(a.H),h.C(void 0));f.b.na.position.copyFrom(a.h);void 0!==h.s&&(f.b.na.isVisible=h.s!==h.w);var d=p(g.m()).pickedPoint;d&&(a.W=d);if(d=p(a.h).pickedPoint)a.X=d})};a.hb=m;a.Ha=p});n("Cameras/CommonCamera",["require","exports","../Navigation/Points","../Vars"],function(n,
a,g,f){function h(){if(3===f.b.g)return new BABYLON.Vector3(0,0,0);var a=f.f.webVRCamera,b;a.leftCamera?b=a.leftCamera.globalPosition.subtract(a.position):b=new BABYLON.Vector3(0,0,0);return b}Object.defineProperty(a,"__esModule",{value:!0});var b=new BABYLON.Vector3(1,0,0),m=new BABYLON.Vector3(1,0,0);a.m=function(){var a=f.a.activeCamera,b=a.position.clone();if(2===f.b.g||1===f.b.g)a.leftCamera?b.copyFrom(a.leftCamera.globalPosition):console.log("Prob here");return b};a.pa=function(a){if(3===f.b.g){var b=
f.a.activeCamera;b.position.copyFrom(a)}else if(2===f.b.g||1===f.b.g)b=f.f.webVRCamera,b.position.copyFrom(a.subtract(h()))};a.ia=function(){if(2===f.b.g||1===f.b.g){var a=g.X.subtract(g.W),h=BABYLON.Vector3.GetAngleBetweenVectors(a,b,m);for(0>a.z&&(h=-h);0>h;)h+=2*Math.PI;for(;h>2*Math.PI;)h-=2*Math.PI;return h+=.5*Math.PI}return f.a.activeCamera.rotation.clone().y};a.Ga=h});n("Mols/Shadows",["require","exports","../Vars"],function(n,a,g){function f(){var a=g.a.lights[0],b=64,f=.9625,l=a.name.match(/blur_([0-9\.]+)/g);
null!==l&&(b=parseFloat(l[0].substr(5)));a=a.name.match(/dark_([0-9\.]+)/g);null!==a&&(f=parseFloat(a[0].substr(5)));return{blur:b,N:f}}Object.defineProperty(a,"__esModule",{value:!0});a.Ua=function(){var h=g.a.lights[0],b=f();b.Za=0;b.blur=2;console.log(b);g.qa?console.log("iOS, so not generating shadows... causes an error... See https://forum.babylonjs.com/t/issues-between-shadowgenerator-and-ios-osx/795"):(a.o=new BABYLON.ShadowGenerator(4096,h),a.o.useBlurExponentialShadowMap=!0,a.o.setDarkness(b.N),
a.o.A=!0,a.o.i=b.blur,window.o=a.o)};a.Ea=f;a.Ta=function(){for(var a in g.a.meshes)if(g.a.meshes.hasOwnProperty(a)){var b=g.a.meshes[a];if(-1!==b.name.toLowerCase().indexOf("shadowcatcher")||-1!==b.name.toLowerCase().indexOf("shadow_catcher"))b.material=new BABYLON.ShadowOnlyMaterial("shadow_catch"+a.toString(),g.a),b.material.activeLight=g.a.lights[0],b.receiveShadows=!0}}});n("Scene/Optimizations",["require","exports","../Mols/Shadows","../Vars"],function(n,a,g,f){function h(a){if(void 0!==a){a=
a.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(null===a)return null;a=a.length/3}else a=0;return a}function b(){var a=new BABYLON.SceneOptimizerOptions(25,2E3),b=0;a.optimizations.push(new BABYLON.ShadowsOptimization(b));a.optimizations.push(new BABYLON.LensFlaresOptimization(b));a.optimizations.push(new BABYLON.PostProcessesOptimization(b));a.optimizations.push(new BABYLON.ParticlesOptimization(b));a.optimizations.push(new l(b));b++;a.optimizations.push(new p(b));a.optimizations.push(new l(b));
b++;a.optimizations.push(new BABYLON.TextureOptimization(b,512));a.optimizations.push(new l(b));b++;a.optimizations.push(new BABYLON.RenderTargetsOptimization(b));a.optimizations.push(new BABYLON.TextureOptimization(b,256));a.optimizations.push(new l(b));b++;a.optimizations.push(new BABYLON.HardwareScalingOptimization(b,4));a.optimizations.push(new d(b,500));a.optimizations.push(new l(b));return a}function m(a){null!==a&&a.dispose()}function l(a){var c=this;"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){console.log("Optimization priority:",c.priority);console.log("FPS:",f.l.getFps());console.log("");return!0};this.getDescription=function(){return"Reports the current priority. For debugging."}}function p(a){"undefined"===typeof a&&(a=0);this.priority=a;this.apply=function(){var a=f.a.getMeshByName("surfaces.wrl");m(a);return!0};this.getDescription=function(){return"Removes surface representations."}}function d(a,b,d){void 0===d&&(d=void 0);"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){var a=[],c;for(c in f.a.meshes)if(f.a.meshes.hasOwnProperty(c)){var e=f.a.meshes[c];if(-1===e.name.indexOf("Decimated")){var l=h(e);null!==l&&(l<b||a.push([l,e,void 0===d?1-b/l:d]))}}a.sort(function(a,e){return e[0]-a[0]});for(c in a)if(a.hasOwnProperty(c)){e=a[c][1];for(l=a[c][2];0<e.getLODLevels().length;){var r=e.getLODLevels()[0].mesh;e.removeLODLevel(r);m(r)}e.simplify([{quality:l,distance:.001}],!1,BABYLON.SimplificationType.QUADRATIC,function(){})}return!0};this.getDescription=
function(){return"Simplifies the geometry of complex objects in the scene."}}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){BABYLON.SceneOptimizer.OptimizeAsync(f.a,b());f.a.autoClear=!1;f.a.autoClearDepthAndStencil=!1;for(var a in f.a.meshes)if(f.a.meshes.hasOwnProperty(a)){var d=f.a.meshes[a];-1!==d.name.indexOf("baked")&&void 0!==d.material&&(d.material.diffuseColor=new BABYLON.Color3(0,0,0),d.material.specularColor=new BABYLON.Color3(0,0,0),d.material.emissiveTexture=d.material.diffuseTexture,
d.material.diffuseTexture=null,d.freezeWorldMatrix())}};a.Y=function(a){var c=h(a);null===c||100>c||(c=1+Math.floor(c/f.ra),1<c&&a.subdivide(c))};a.ha=function(a,b){void 0===b&&(b=!0);b&&a.material.freeze()};a.I=function(){g.o&&(f.a.lights[0].autoUpdateExtends=!0,g.o.getShadowMap().refreshRate=BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE,f.a.lights[0].autoUpdateExtends=!1)};a.Oa=m});n("Navigation/Navigation","require exports ../Cameras/CommonCamera ../Cameras/NonVRCamera ../Scene/Optimizations ../Vars ./Pickables ./Points".split(" "),
function(n,a,g,f,h,b,m,l){function p(){u=g.m();b.a.registerBeforeRender(function(){var a=g.m();null===l.Ha(a).pickedMesh?g.pa(u):u=a})}function d(){jQuery("body").keypress(function(a){32===a.charCode&&c()})}function c(){var a=(new Date).getTime();if(!(250>a-e))switch(e=a,console.log("hi"),m.Fa()){case 2:console.log("teleport");q();break;case 4:r();break;case 3:m.s.v()}}function q(a,e){void 0===a&&(a=void 0);void 0===e&&(e=void 0);void 0===e&&(e=function(){});b.f.gazeTrackerMesh.isVisible=!1;var c=
new BABYLON.Animation("animationCameraTeleportation","position",90,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),d=g.m();void 0===a&&(a=new BABYLON.Vector3(l.h.x,l.h.y+b.L,l.h.z));var k=g.Ga();a=a.subtract(k);d=d.subtract(k);c.setKeys([{frame:0,value:d},{frame:b.ba,value:a}]);var f=b.a.activeCamera;f.animations=[];f.animations.push(c);b.a.beginAnimation(f,0,b.ba,!1,1,function(){b.f.gazeTrackerMesh.isVisible=!0;f.animations=[];e()})}function r(){var a=l.X,e=
g.m(),c=l.h.subtract(e),d=c.length(),k;.1*d<b.aa?k=l.h.subtract(c.normalize().scale(b.aa)):.1*d>b.T?k=l.h.subtract(c.normalize().scale(b.T)):.1*d<b.T&&(k=e.add(c.scale(.9)));k.y=l.h.y;k.y-a.y<.5*b.S+.1&&(k.y=a.y+.5*b.S+.1);b.Qa(l.h.y-a.y);q(k,function(){f.Pa()})}function k(){y=jQuery("#capture-clicks");y.click(function(){console.log("clicked!");c()});b.a.registerBeforeRender(function(){var a=b.a.activeCamera.inputs.attached.deviceOrientation;(a=a?0!==a._alpha||0!==a._beta||0!==a._gamma:!1)&&!z?(z=
!0,y.show()):!a&&z&&(z=!1,y.ab())})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){b.b.j=b.a.getMeshByID(b.b.ja);null===b.b.j&&alert("No mesh named "+b.b.ja);b.b.j.checkCollisions=!0;b.b.j.visibility=0;h.Y(b.b.j);m.la({K:c,mesh:b.b.j});b.b.g=3;d();l.c();k();p()};var u,e=0;a.ca=c;var y=void 0,z=!1});n("Navigation/Pickables","require exports ../Cameras/CommonCamera ../Scene/Optimizations ../Vars ./Navigation".split(" "),function(n,a,g,f,h,b){function m(a){void 0===a.K&&(a.K=b.ca);void 0===
a.a&&(a.a=h.a);void 0!==a.mesh&&(a.mesh.actionManager=new BABYLON.ActionManager(a.a),a.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(){3===h.b.g&&a.K()})))}Object.defineProperty(a,"__esModule",{value:!0});var l=[],p=[],d=[];a.C=function(c){a.s=c};a.c=function(){l.push(h.b.j)};a.ya=function(a){l.push(a);p.push(a);f.Y(a);m({mesh:a,K:function(){a.v()}})};a.za=function(a){l.push(a);d.push(a);f.Y(a);m({mesh:a})};a.fa=function(a){return a.id===
h.b.j.id?!0:a.isVisible?-1!==l.indexOf(a):!1};a.Fa=function(){return void 0===a.s?1:a.s===h.b.j?2:-1!==p.indexOf(a.s)?3:-1!==d.indexOf(a.s)?4:a.s===a.w?5:1};a.la=m;a.La=function(){a.w=BABYLON.Mesh.CreateSphere("padNavSphereAroundCamera",4,h.$-1,h.a);a.w.flipFaces(!0);var b=new BABYLON.StandardMaterial("padNavSphereAroundCameraMat",h.a);b.diffuseColor=new BABYLON.Color3(1,1,1);b.specularColor=new BABYLON.Color3(0,0,0);b.i=null;a.w.material=b;a.w.visibility=0;h.a.registerBeforeRender(function(){a.w.position=
g.m()});l.push(a.w)}});n("Cameras/VRControllers","require exports ../Navigation/Navigation ../Navigation/Pickables ../Navigation/Points ../Vars ./CommonCamera ./VRCamera".split(" "),function(n,a,g,f,h,b,m,l){function p(a){a.onTriggerStateChangedObservable.add(function(a){a.pressed&&(a=(new Date).getTime(),a-c>b.xa&&(c=a,g.ca()))})}function d(a){a.onPadStateChangedObservable.add(function(a){(u=a.pressed)&&Math.abs(r)<b.J&&Math.abs(k)<b.J&&console.log("Would reset camera view if you didn't get an error below...")});
a.onPadValuesChangedObservable.add(function(a){r=a.y;k=a.x;Math.abs(k)<b.J&&Math.abs(r)<b.J?k=r=0:.5>Math.abs(k)?k=0:(k+=0<k?-.5:.5,k=2*k)});b.a.registerBeforeRender(function(){if(u){if(!h.h.equals(h.H)){var a=m.m(),e=h.h.subtract(a);e.normalize();e=e.scale(r*b.ua*b.a.getAnimationRatio());m.pa(a.subtract(e))}0!==k&&(a=(new Date).getTime(),a-q<b.wa||(q=a,a=b.f.webVRCamera.rotationQuaternion.toEulerAngles(),a.y+=.25*Math.sign(k)*Math.PI,b.f.webVRCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a)))}})}
Object.defineProperty(a,"__esModule",{value:!0});var c=0,q=0,r=0,k=0,u=!1;a.c=function(){f.La();b.f.webVRCamera.onControllerMeshLoadedObservable.add(function(a){b.b.g=1;console.log("controller loaded");l.Ra();console.log("Isnt there on pickable or something");p(a);d(a)})}});n("Cameras/VRCamera","require exports ../Navigation/Pickables ../Scene/Optimizations ../Vars ./VRControllers".split(" "),function(n,a,g,f,h,b){function m(){h.f.onEnteringVRObservable.add(function(){h.b.g=2;p();g.C(void 0);f.I();
window.vrHelper=h.f});h.f.onExitingVRObservable.add(function(){h.b.g=3;g.C(void 0);f.I()})}function l(){var a=new BABYLON.Mesh("vrNavTargetMesh",h.a),b=new BABYLON.VertexData;b.A=[0,0,0];b.i=[0];b.applyToMesh(a);a.isVisible=!1;return a}function p(){h.f.raySelectionPredicate=function(a){return g.fa(a)};h.f.gazeTrackerMesh=l();h.f.updateGazeTrackerScale=!1;h.f.displayGaze=!0;h.f.enableInteractions()}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m();b.c()};a.Ra=p});n("Mols/CommonLoader",
"require exports ../Navigation/Pickables ../Scene/LoadAndSetup ../Scene/Optimizations ../Vars ./Shadows".split(" "),function(n,a,g,f,h,b,m){Object.defineProperty(a,"__esModule",{value:!0});a.Ba=function(){m.Ua();BABYLON.OBJFileLoader.OPTIMIZE_WITH_UV=!0};a.Aa=function(a){m.Ta();void 0!==a.transparentGround&&!0===a.transparentGround&&(b.b.j?(b.b.j.visibility=1,a=new BABYLON.StandardMaterial("transparentGround",b.a),a.diffuseColor=new BABYLON.Color3(1,1,1),a.specularColor=new BABYLON.Color3(0,0,0),
a.emissiveColor=new BABYLON.Color3(0,0,0),a.alpha=b.va,b.b.j.material=a):console.log("Warning: Vars.vrVars.groundMesh not defined."));f.Ka()};a.Sa=function(a){if(void 0!==a.material&&null!==a.material){var b=m.Ea();b=.95<b.N?.05:.4>b.N?.0025:.013636363636363637*b.N-.0029545454545454545;a.material.emissiveColor=new BABYLON.Color3(b,b,b);h.ha(a)}a.scaling.z=-1;a.scaling.x=-1;m.o&&m.o.getShadowMap().renderList.push(a);g.za(a)}});n("Mols/3DMol/VRMLParserWebWorker",["require","exports"],function(n,a){function g(a){var k=
[];a=a.split("geometry IndexedFaceSet {").splice(1);for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];k.push({colors:h(m("color [","]",e)),coors:f(m("point [","]",e)),norms:f(m("vector [","]",e)),trisIdxs:b(m("coordIndex [","]",e))})}void 0===c&&(c=l(k));d=c;a=k.length;for(e=0;e<a;e++)for(var r=k[e].coors.length,g=0;g<r;g+=3)k[e].coors[g]-=d[0],k[e].coors[g+1]-=d[1],k[e].coors[g+2]-=d[2];if(q){p=[];d=["colors","coors","norms","trisIdxs"];for(var n in k)if(k.hasOwnProperty(n))for(var x in d)if(d.hasOwnProperty(x)){a=
d[x];e=k[n][a];r=[];g=0;for(var v=e.length;g<v;)r.push(e.slice(g,g+=1E7));e=r;for(var t in e)e.hasOwnProperty(t)&&p.push([+n,a,e[t]])}return[]}return k}function f(a){a=a.match(d);for(var b=a.length,c=new Float32Array(b),e=0;e<b;e+=3)c[e]=+a[e+2],c[e+1]=+a[e+1],c[e+2]=+a[e];return c}function h(a){a=a.match(d);for(var b=new Float32Array(4*a.length/3),c=b.length,e=0;e<c;e+=4){var f=3*e/4;b[e]=+a[f];b[e+1]=+a[f+1];b[e+2]=+a[f+2];b[e+3]=1}return b}function b(a){a=a.match(d);for(var b=3*a.length/4,c=new Uint32Array(b),
e=0;e<b;e+=3){var f=4*e/3;c[e]=+a[f];c[e+1]=+a[f+1];c[e+2]=+a[f+2]}return c}function m(a,b,c){a=c.split(a,2);if(1>=a.length)return"";a=a[1].split(b,2);return a[0]}function l(a){if(0===a.length)return new Float32Array([0,0,0]);var b=a.map(function(a){return a.coors.length}).reduce(function(a,b){return a+b});if(0===b)return new Float32Array([0,0,0]);for(var c=0,e=0,d=0,f=a.length,g=0;g<f;g++)for(var h=a[g].coors,l=h.length,m=0;m<l;m+=3)c+=h[m],e+=h[m+1],d+=h[m+2];a=b/3;return new Float32Array([c/a,
e/a,d/a])}Object.defineProperty(a,"__esModule",{value:!0});var p=void 0,d=/(^|-| )[0-9.]{1,8}/g,c=void 0,q=!1;"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&(q=!0);q&&(self.onmessage=function(a){var b=a.data.cmd;a=a.data.data;"start"===b&&(g(a),b="sendDataChunk");"sendDataChunk"===b&&(b=p.shift(),postMessage({chunk:b,status:0===p.length?"done":"more"}))});a.Ja=g});n("Mols/3DMol/VRML","require exports ../../Scene/Optimizations ../../Vars ../CommonLoader ./VRMLParserWebWorker".split(" "),
function(n,a,g,f,h,b){function m(a){d=[];"undefined"!==typeof Worker?("undefined"===typeof k&&(k=new Worker("VRMLParserWebWorker.js")),k.onmessage=function(b){b=b.data;var e=b.chunk;b=b.status;var c=e[0],f=e[1],h=e[2];d.length===c&&d.push({coors:new Float32Array(0),norms:new Float32Array(0),colors:new Float32Array(0),trisIdxs:new Uint32Array(0)});e=d[c];c=[d[c][f],h];for(var g=0,l=0;l<c.length;l++)h=c[l],g+=h.length;g=new ("trisIdxs"===f?Uint32Array:Float32Array)(g);for(var m=l=0;m<c.length;m++)h=
c[m],g.set(h,l),l+=h.length;e[f]=g;switch(b){case "more":k.postMessage({cmd:"sendDataChunk",data:void 0});break;case "done":a();break;default:console.log("Error here!")}},k.postMessage({cmd:"start",data:r})):(d=b.Ja(r),a())}function l(){var a=[],b;for(b in d)if(d.hasOwnProperty(b)){var c=d[b];BABYLON.VertexData.ComputeNormals(c.coors,c.trisIdxs,c.norms);var k=new BABYLON.VertexData;k.positions=c.coors;k.indices=c.trisIdxs;k.normals=c.norms;k.colors=c.colors;c=new BABYLON.Mesh("mesh_3dmol_tmp"+b,f.a);
k.applyToMesh(c);k=new BABYLON.StandardMaterial("Material",f.a);k.diffuseColor=new BABYLON.Color3(1,1,1);k.emissiveColor=new BABYLON.Color3(0,0,0);k.specularColor=new BABYLON.Color3(0,0,0);c.material=k;a.push(c)}if(0<a.length){var g=BABYLON.Mesh.MergeMeshes(a,!0,!0);g.name="MeshFrom3DMol"+Math.random().toString();g.id=g.name;h.Sa(g)}return g}function p(a,b){if(void 0!==a){a.scaling=new BABYLON.Vector3(1,1,1);a.position=new BABYLON.Vector3(0,0,0);f.a.render();if(void 0===c){var e=b.getBoundingInfo().boundingBox;
b=Object.keys(e.maximumWorld).map(function(a){return e.maximumWorld[a]-e.minimumWorld[a]});var d=a.getBoundingInfo().boundingBox,k=Object.keys(d.maximumWorld).map(function(a){return d.maximumWorld[a]-d.minimumWorld[a]});b=b.map(function(a,b){return a/k[b]});b=Math.min.apply(null,b);c=new BABYLON.Vector3(b,b,b);a.scaling=c;f.a.render();q=d.centerWorld.subtract(e.centerWorld)}else a.scaling=c;a.position=a.position.subtract(q);g.I()}}Object.defineProperty(a,"__esModule",{value:!0});var d=[],c,q,r,k;
a.c=function(){jQuery("body").append('<div\n        id="mol-container"\n        class="mol-container"\n        style="display:none;"></div>');var b=jQuery("#mol-container");a.u=$3Dmol.createViewer(b,{backgroundColor:"white"});window.viewer=a.u};a.Ia=function(b){jQuery.ajax("https://files.rcsb.org/view/1XDN.pdb",{success:function(c){a.u.addModel(c,"pdb");b()},error:function(a,b,c){console.error("Failed to load PDB https://files.rcsb.org/view/1XDN.pdb: "+c)}})};a.render=function(b,c){void 0===b&&(b=
!0);void 0===c&&(c=function(){});f.l.hideLoadingUI();a.u.render();b&&(r=a.u.exportVRML(),m(function(){var a=l();p(a,f.a.getMeshByName("protein_box"));c(a);d=[]}))};a.bb=l;a.eb=p});n("Mols/3DMol/Visualize",["require","exports","../../Scene/Optimizations","./VRML"],function(n,a,g,f){function h(a){f.render(!0,function(b){for(var c in l)if(l.hasOwnProperty(c)){var d=l[c];d.B===a.B&&(g.Oa(d.mesh),delete l[c],console.log("deleting old mesh..."))}l[a.V]={B:a.B,mesh:b};console.log("added new mesh");console.log(l)})}
function b(a,b,d){a.sort();return{B:a.join("-")+"-"+b,V:a.join("-")+"-"+b+"-"+d}}function m(a){var b=a.map(function(a){return a}),c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(d.toUpperCase());b.push(d.toLowerCase())}return b=b.filter(function(a,c){return b.indexOf(a)>=c})}Object.defineProperty(a,"__esModule",{value:!0});var l={},p={All:{},Protein:{resn:m("ALA ARG ASP ASN ASX CYS GLN GLU GLX GLY HIS HSP HYP ILE LEU LYS MET PCA PHE PRO TRP TYR VAL GLU SER THR MSE".split(" "))},Acidic:{resn:m(["ASP",
"GLU"])},Cyclic:{resn:m(["HIS","PHE","PRO","TRP","TYR"])},Aliphatic:{resn:m(["ALA","GLY","ILE","LEU","VAL"])},Aromatic:{resn:m(["HIS","PHE","TRP","TYR"])},Basic:{resn:m(["ARG","HIS","LYS","HSP"])},Charged:{resn:m("ASP GLU ARG HIS LYS HSP".split(" "))},Hydrophobic:{resn:m("ALA LEU VAL ILE PRO PHE MET TRP".split(" "))},Neutral:{resn:m("VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP".split(" "))},Nucleic:{resn:m("ADE A GUA G CYT C THY T URA U".split(" "))},Purine:{resn:m(["ADE","A","GUA","G"])},Pyrimidine:{resn:m("CYT C THY T URA U".split(" "))},
Ions:{resn:m("AL BA CA CAL CD CES CLA CL CO CS CU CU1 CUA HG IN IOD K MG MN3 MO3 MO4 MO5 MO6 NA NAW OC7 PB POT PT RB SOD TB TL WO4 YB ZN ZN1 ZN2".split(" "))},Water:{resn:m(["WAT","HOH","TIP","TIP3"])}};p.Ligand={not:{or:[p.Protein,p.Nucleic,p.Ions,p.Water]}};var d={Element:{colorscheme:"default"},Red:{color:"red"},Blue:{color:"blue"},Green:{color:"green"},Orange:{color:"orange"},Yellow:{color:"yellow"},Purple:{color:"purple"},Spectrum:{color:"spectrum"}};a.Ya=function(a,g,m){var c=b(a,g,m);if("Hide"===
m)for(var n in l)l.hasOwnProperty(n)&&(g=l[n],g.B===c.B&&(g.mesh.isVisible=!1,console.log("Hiding existing mesh...")));else void 0!==l[c.V]?(l[c.V].mesh.isVisible=!0,console.log("showing existing mesh...")):(f.u.setStyle({}),n=d[m],a={and:a.map(function(a){return p[a]})},"surface"===g.toLowerCase()?f.u.addSurface($3Dmol.SurfaceType.MS,n,a,void 0,void 0,function(){h(c)}):(m={},m[g.toLowerCase()]=n,f.u.addStyle(a,m),h(c)))}});n("UI/Menu3D","require exports ../Cameras/CommonCamera ../Mols/3DMol/Visualize ../Navigation/Pickables ../Navigation/Points ../Vars".split(" "),
function(n,a,g,f,h,b,m){function l(){function a(a){if(b.hasOwnProperty(a)){e[a]=new BABYLON.GUI.SpherePanel;u.addControl(e[a]);e[a].blockLayout=!0;b[a].reverse();var c=function(c){if(b[a].hasOwnProperty(c)){c=b[a][c];var d=c.D,f=c.P;k.push(new C({v:function(){f()},default:!1,O:d,ka:function(a){a.isVisible(!1)},level:+a,name:"menu-visible-button-"+d,oa:e[a],R:d,color:c.color}));e[a].columns=4;window.panels=e;e[a].blockLayout=!1;e[a].linkToTransformNode(v);setInterval(function(){e[a].radius=m.ta;e[a].margin=
m.sa},1E3)}},d;for(d in b[a])c(d)}}var b=p();b=d(b);v=new BABYLON.TransformNode("");u=new BABYLON.GUI.GUI3DManager(m.a);for(var c in b)a(c)}function p(){function a(e,f,g){function k(d){if(h.hasOwnProperty(d)){d=h[d];var k=e[d];c[f]=void 0===c[f]?[]:c[f];switch(typeof k){case "function":c[f].push({P:k,D:d,F:g});break;case "object":var l=b(f+1);c[f].push({color:x,P:function(){q(l)},D:d+" \u21e8",F:g});a(k,l,f);break;default:alert("error!")}}}d.push(f);var h=Object.keys(e),l;for(l in h)k(l)}function b(a){for(;-1!==
d.indexOf(a);)a++;return a}var c={},d=[];a(r,1,void 0);return c}function d(a){function b(b){if(a.hasOwnProperty(b)){a[b].sort(function(a,b){return(""+a.D).localeCompare(b.D)});var c=+b;1<c&&a[b].push({color:B,P:function(){q(a[b][0].F)},D:"Back \u21e6",F:a[b][0].F});0<c&&a[b].push({color:G,P:function(){w.Z()},D:"Close Menu \u00d7",F:a[b][0].F})}}for(var c in a)b(c);console.log(a);return a}function c(){var a=new BABYLON.GUI.StackPanel3D;u.addControl(a);w=new C({v:function(a){a.value?q(1):q(0);v.position.copyFrom(g.m());
v.rotation.y=g.ia()},default:!1,O:"Show Menu",level:0,name:"menu-visible-button",oa:a,R:"Hide Menu"});var c=new BABYLON.TransformNode("");a.linkToTransformNode(c);c.rotation.x=.5*Math.PI;m.a.registerBeforeRender(function(){c.position.copyFrom(b.W);c.position.y+=.1;c.rotation.y=g.ia()})}function q(a){for(var b in k)if(k.hasOwnProperty(b)){var c=k[b];0===c.level?c.isVisible(!0):c.level===a?c.isVisible(!0):c.isVisible(!1)}}Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function a(a){if(b.hasOwnProperty(a)){var d=
b[a];g[d]={};a=function(a){if(c[d].hasOwnProperty(a)){var b=c[d][a];g[d][b]={};a=function(a){if(e[d].hasOwnProperty(a)){var c=e[d][a];g[d][b][c]={};a=function(a){if(k.hasOwnProperty(a)){var e=k[a];g[d][b][c][e]=function(){f.Ya([d,b],c,e);w.Z()}}};for(var h in k)a(h)}};for(var h in e[d])a(h)}};for(var h in c[d])a(h)}}var b=["Protein","Ligand","Water","Nucleic"],c={Ligand:["All"],Nucleic:["All"],Protein:["All","Hydrophobic","Hydrophilic","Charged","Aromatic"],Water:["All"]},d=["Stick","Sphere","Surface"],
e={Ligand:d,Nucleic:d,Protein:["Cartoon"].concat(d),Water:d},k="Element Red Blue Green Orange Yellow Purple Spectrum Hide".split(" "),g={},h;for(h in b)a(h);return g}(),k=[],u,e={},v,t,w,x=new BABYLON.Color3(.3,.35+.1,.4),B=new BABYLON.Color3(.4,.35+.1,.4),G=new BABYLON.Color3(.4,.35,.4);a.c=function(a){l(a);c();t=new BABYLON.Sound("click-button","assets/staple-public-domain.mp3",m.a,null,{loop:!1,autoplay:!1,ib:!0,volume:.1})};var C=function(){function a(a){var b=this;this.button=new BABYLON.GUI.HolographicButton(a.name);
a.oa.addControl(this.button);if(void 0!==a.color){var c=this.button.mesh.material.clone();c.albedoColor=a.color;this.button.mesh.material=c}this.level=a.level;this.A=new BABYLON.GUI.TextBlock;this.A.color="white";this.A.i=!0;this.value=a.default;this.R=a.R;this.O=a.O;this.v=a.v;this.ea();this.i=BABYLON.Mesh.CreateSphere(a.name+"-container-mesh",2,m.S,m.a);this.i.position=this.button.node.absolutePosition;this.i.visibility=0;this.i.v=function(){b.Z()};h.ya(this.i);void 0!==a.ka&&a.ka(this)}a.prototype.isVisible=
function(a){if(void 0===a)return this.button.isVisible;this.button.isVisible=a;this.i.isVisible=a};a.prototype.Z=function(){t.setPosition(this.i.position.clone());t.play();this.value=!this.value;this.v(this);this.ea()};a.prototype.ea=function(){this.A.text=this.value?this.R:this.O;this.button.content.dispose();this.button.content=this.A};return a}()});n("Mols/3DMol/ThreeDMol",["require","exports","../CommonLoader","./VRML"],function(n,a,g,f){function h(a){f.c();f.Ia(function(){f.u.setStyle({},{cartoon:{color:"spectrum"}});
f.render();g.Aa(a)})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(a){try{jQuery.getScript("https://3Dmol.csb.pitt.edu/build/3Dmol-min.js",function(){h(a)})}catch(m){h(a)}}});n("Mols/Load","require exports ../Scene/Optimizations ../UI/Menu3D ../Vars ./3DMol/ThreeDMol ./CommonLoader".split(" "),function(n,a,g,f,h,b,m){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m.Ba();jQuery.getJSON("scene_info.json",function(a){!1===a.menuActive&&(h.b.ma=!1);b.c(a);h.b.ma&&f.c(a);
g.I()})}});n("UI/LoadingScreens",["require","exports","../Vars"],function(n,a,g){function f(){clearInterval(h)}Object.defineProperty(a,"__esModule",{value:!0});var h;a.Na=function(){document.getElementById("loading-container").outerHTML=""};a.da=function(a){f();g.l.displayLoadingUI();g.l.loadingUIText=a};a.Wa=function(){var a=90;clearInterval(h);h=setInterval(function(){a+=.02*(99-a);g.l.displayLoadingUI();g.l.loadingUIText="Loading the main scene... "+a.toFixed(0)+"%"},100)};a.Xa=f});n("UI/UI2D",
["require","exports","../Vars"],function(n,a,g){function f(){jQuery("body").append('\n        <button\n          title="Click to switch to full screen"\n          id="fullscreen-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:80px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n            <svg\n              style="position:relative; left:0.5px;"\n              width="48" height="48"\n              xmlns="http://www.w3.org/2000/svg"\n              xmlns:svg="http://www.w3.org/2000/svg"\n              clip-rule="evenodd">\n                <g class="layer">\n                    <path d="m47.799999,43.649999l-47.699999,0l0,-39.749999l47.699999,0l0,39.749999zm-1.9875,-37.762499l-43.724999,0l0,35.774999l43.724999,0l0,-35.774999zm-7.95,13.9125l-1.9875,0l0,-6.441487l-22.341487,22.341487l6.441487,0l0,1.9875l-9.9375,0l0,-9.9375l1.9875,0l0,6.441487l22.341487,-22.341487l-6.441487,0l0,-1.9875l9.9375,0l0,9.9375z" fill="#ffffff" id="svg_1"/>\n                </g>\n            </svg>\n        </button>\n\n        <button\n          title="Click for help"\n          id="help-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:140px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n                 <svg version="1.2" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" xml:space="preserve">\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="\n\tM35.5,9.8c1.7,5.4-0.6,8-1.6,8.9c-1.9,1.9-4.5,4.7-5.8,7c-1.5,2.7-4.1,12-6.8,4.4c-3.2-9.1,1.3-11.6,3.5-13.4\n\tc1.5-1.3,3.4-4.3,0.5-5.3c-4-1.3-6.1,5.3-10.7,4c-3-0.8-3.2-4.1-2.2-6.6C15.4,1.7,32.5,0.6,35.5,9.8L35.5,9.8z"/>\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" d="M28.3,39.6c0-5.5-8.5-5.5-8.5,0S28.3,45.1,28.3,39.6\n\t"/>\n</svg>\n\n        </button>\n    ');
jQuery("#fullscreen-button").click(function(){g.l.switchFullscreen(!0);jQuery("#renderCanvas").focus()});jQuery("#help-button").click(function(){window.open("help/index.html","_blank")});document.getElementById("babylonVRiconbtn").style.opacity="1.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=1.0)"}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){f()};window.debugMode=function(){g.a.debugLayer.show();setTimeout(function(){document.getElementById("inspector-host").style.zIndex=
"15";document.getElementById("scene-explorer-host").style.zIndex="15"},500)}});n("Scene/LoadAndSetup","require exports ../Cameras/Setup ../Cameras/VRCamera ../Mols/Load ../Navigation/Navigation ../Navigation/Pickables ../UI/LoadingScreens ../UI/UI2D ../Vars ./Optimizations".split(" "),function(n,a,g,f,h,b,m,l,p,d,c){function q(){var a=BABYLON.Mesh.CreateSphere("navTargetMesh",4,.1,d.a),b=new BABYLON.StandardMaterial("myMaterial",d.a);b.diffuseColor=new BABYLON.Color3(1,0,1);a.material=b;d.Va({ja:"ground",
na:a});f.c();c.c();window.i=d}function r(a){l.da("Loading the main scene...");BABYLON.SceneLoader.LoadAssetContainer("scene/","scene.babylon",d.a,function(b){l.Wa();d.a.executeWhenReady(function(){b.addAllToScene();d.a.activeCamera=d.a.cameras[0];for(var e=!1,f=0;1<d.a.lights.length;){var g=d.a.lights[f].name.toLowerCase();-1===g.indexOf("shadowlight")&&-1===g.indexOf("shadow_light")?d.a.lights[f].dispose():e?d.a.lights[f].dispose():(e=!0,f++)}for(var k in d.a.meshes)"protein_box"===d.a.meshes[k].name&&
(d.a.getMeshByName("protein_box").isVisible=!1);for(var h in d.a.meshes)if(d.a.meshes[h].material){e=d.a.meshes[h];if(void 0===e.material.emissiveTexture||null===e.material.emissiveTexture)e.material.emissiveTexture=e.material.diffuseTexture,e.material.diffuseColor=new BABYLON.Color3(0,0,0),e.material.specularColor=new BABYLON.Color3(0,0,0),e.material.emissiveColor=new BABYLON.Color3(0,0,0);c.ha(e,!1);m.la({mesh:e,a:d.a})}a()})},function(a){a.lengthComputable&&l.da("ALoading the main scene... "+Math.round(90*
a.loaded/a.total).toString()+"%")})}Object.defineProperty(a,"__esModule",{value:!0});a.load=function(){d.c();l.Na();q();r(function(){g.c();b.c();m.c();p.c();h.c()});window.addEventListener("resize",function(){d.l.resize()})};a.Ka=function(){setTimeout(c.I,1E3);l.Xa();d.a.activeCamera.maxZ=250;d.a.activeCamera.minZ=0;d.l.runRenderLoop(function(){d.a.render()})}});t.M({urlArgs:"bust="+(new Date).getTime()});t(["Scene/LoadAndSetup"],function(n){n.load()});n("Start",function(){})})();
