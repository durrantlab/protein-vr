/*
 almond 0.3.3 Copyright jQuery Foundation and other contributors.
 Released under MIT license, http://github.com/requirejs/almond/LICENSE
*/
var D="function"==typeof Object.defineProperties?Object.defineProperty:function(y,u,l){y!=Array.prototype&&y!=Object.prototype&&(y[u]=l.value)},E="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function F(y){if(y){for(var u=E,l=["Math","sign"],r=0;r<l.length-1;r++){var a=l[r];a in u||(u[a]={});u=u[a]}l=l[l.length-1];r=u[l];y=y(r);y!=r&&null!=y&&D(u,l,{configurable:!0,writable:!0,value:y})}}
F(function(y){return y?y:function(u){u=Number(u);return 0===u||isNaN(u)?u:0<u?1:-1}});
(function(){var y,u,l;(function(r){function a(a,b){var g,w;b=b&&b.split("/");var d=p.map,k=d&&d["*"]||{};if(a){a=a.split("/");var c=a.length-1;p.eb&&t.test(a[c])&&(a[c]=a[c].replace(t,""));"."===a[0].charAt(0)&&b&&(c=b.slice(0,b.length-1),a=c.concat(a));for(c=0;c<a.length;c++){var q=a[c];"."===q?(a.splice(c,1),--c):".."===q&&0!==c&&(1!==c||".."!==a[2])&&".."!==a[c-1]&&0<c&&(a.splice(c-1,2),c-=2)}a=a.join("/")}if((b||k)&&d){q=a.split("/");for(c=q.length;0<c;--c){var f=q.slice(0,c).join("/");if(b)for(w=
b.length;0<w;--w)if(g=d[b.slice(0,w).join("/")])if(g=g[f]){var e=g;var h=c;break}if(e)break;if(!v&&k&&k[f]){var v=k[f];var z=c}}!e&&v&&(e=v,h=z);e&&(q.splice(0,h,e),a=q.join("/"))}return a}function e(a,b){return function(){var g=v.call(arguments,0);"string"!==typeof g[0]&&1===g.length&&g.push(null);return n.apply(r,g.concat([a,b]))}}function f(b){return function(g){return a(g,b)}}function c(a){return function(g){b[a]=g}}function d(a){if(k.call(g,a)){var c=g[a];delete g[a];q[a]=!0;B.apply(r,c)}if(!k.call(b,
a)&&!k.call(q,a))throw Error("No "+a);return b[a]}function m(a){var b=a?a.indexOf("!"):-1;if(-1<b){var g=a.substring(0,b);a=a.substring(b+1,a.length)}return[g,a]}function h(a){return function(){return p&&p.M&&p.M[a]||{}}}var n,b={},g={},p={},q={},k=Object.prototype.hasOwnProperty,v=[].slice,t=/\.js$/;var A=function(b,g){b=m(b);var c=b[0];g=g[1];b=b[1];if(c){c=a(c,g);var k=d(c)}c?k&&k.normalize?b=k.normalize(b,f(g)):b=a(b,g):(b=a(b,g),b=m(b),c=b[0],b=b[1],c&&(k=d(c)));return{fa:c?c+"!"+b:b,n:b,gb:c,
p:k}};var x={Pa:function(a){return e(a)},G:function(a){var g=b[a];return"undefined"!==typeof g?g:b[a]={}},Ma:function(a){return{id:a,uri:"",G:b[a],M:h(a)}}};var B=function(a,f,h,t){var v,n=[];var w=typeof h;var B=(t=t||a)?m(t):[];if("undefined"===w||"function"===w){f=!f.length&&h.length?["require","exports","module"]:f;for(v=0;v<f.length;v+=1){var z=A(f[v],B);w=z.fa;if("require"===w)n[v]=x.Pa(a);else if("exports"===w){n[v]=x.G(a);var p=!0}else if("module"===w)var l=n[v]=x.Ma(a);else if(k.call(b,w)||
k.call(g,w)||k.call(q,w))n[v]=d(w);else if(z.p)z.p.load(z.n,e(t,!0),c(w),{}),n[v]=b[w];else throw Error(a+" missing "+w);}f=h?h.apply(b[a],n):void 0;a&&(l&&l.G!==r&&l.G!==b[a]?b[a]=l.G:f===r&&p||(b[a]=f))}else a&&(b[a]=h)};y=u=n=function(a,b,g,c,k){if("string"===typeof a)return x[a]?x[a](b):d(A(a,b?m(b):[]).fa);if(!a.splice){p=a;p.Ca&&n(p.Ca,p.ab);if(!b)return;b.splice?(a=b,b=g,g=null):a=r}b=b||function(){};"function"===typeof g&&(g=c,c=k);c?B(r,a,b,g):setTimeout(function(){B(r,a,b,g)},4);return n};
n.M=function(a){return n(a)};y.i=b;l=function(a,c,d){if("string"!==typeof a)throw Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]);k.call(b,a)||k.call(g,a)||(g[a]=[a,c,d])};l.i={jQuery:!0}})();l("external/almond",function(){});l("Vars",["require","exports"],function(l,a){Object.defineProperty(a,"__esModule",{value:!0});a.aa=11;a.T=1.5;a.$=1;a.qa=2E3;a.S=1.2;a.sa=2.5;a.ra=.1;a.ta=.01;a.wa=500;a.va=750;a.J=.1;a.Z=15;a.ua=.05;a.pa=/iPad|iPhone|iPod/.test(navigator.userAgent)&&
!window.MSStream;a.c=function(){a.canvas=document.getElementById("renderCanvas");a.m=new BABYLON.Engine(a.canvas,!0);BABYLON.Database.IDBStorageEnabled=!0;a.a=new BABYLON.Scene(a.m);window.scene=a.a};a.Da=function(){if(void 0===a.L){var e=new BABYLON.Ray(a.a.activeCamera.position,new BABYLON.Vector3(0,-1,0),50);e=a.a.pickWithRay(e,function(a){return"ground"===a.name});a.L=e.distance}};a.Ra=function(e){a.L=e};a.Wa=function(e){var f={createDeviceOrientationCamera:!0};a.a.getEngine().getCaps().multiview&&
(f.useMultiview=!0);a.f=a.a.createDefaultVRExperience(f);document.getElementById("babylonVRiconbtn").style.opacity="0.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=0)";window.vrHelper=a.f;a.b=e;a.b.la=!0}});l("Cameras/NonVRCamera",["require","exports","../Vars"],function(l,a,e){function f(){c.ellipsoid=new BABYLON.Vector3(1,.5*e.L,1)}Object.defineProperty(a,"__esModule",{value:!0});var c;new BABYLON.Vector3(0,0,0);a.c=function(){c=e.a.activeCamera;c.keysUp=[87,38];c.keysDown=
[83,40];c.keysLeft=[65,37];c.keysRight=[68,39];f();e.a.collisionsEnabled=!0;c.checkCollisions=!0;c.speed=.1;c.attachControl(e.canvas,!0);c._updatePosition()};a.Qa=f});l("Cameras/Setup",["require","exports","../Vars","./NonVRCamera"],function(l,a,e,f){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){a.U=e.a.cameras.filter(function(a){return-1===a.name.indexOf("VR")})[0];var c=new BABYLON.DeviceOrientationCamera("DevOr_camera",a.U.position.clone(),e.a,!0);c.rotation=a.U.rotation;e.a.activeCamera=
c;e.a.activeCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.U.rotation);e.Da();f.c()}});l("Navigation/Points",["require","exports","../Cameras/CommonCamera","../Vars","./Pickables"],function(l,a,e,f,c){function d(b){a.h.copyFrom(b)}function m(){if(3===f.b.g)var b=f.a.activeCamera.getForwardRay();else if(2===f.b.g||1===f.b.g){b=void 0;1===f.b.g?(b=f.f.rightControllerGazeTrackerMesh,b||(b=f.f.leftControllerGazeTrackerMesh)):2===f.b.g&&(b=f.f.gazeTrackerMesh);if(!b){console.log("error!");
return}b.isVisible?d(b.absolutePosition):d(a.H);b=e.o();b=new BABYLON.Ray(b,a.h.subtract(b))}else console.log("Unexpected error.");h(b)}function h(b,g){void 0===g&&(g=!0);b=f.a.pickWithRay(b,function(a){return c.ea(a)});b.hit&&b.distance<f.Z?(g&&d(b.pickedPoint),c.C(b.pickedMesh)):(d(a.H),c.C(void 0))}function n(a){a=new BABYLON.Ray(a,new BABYLON.Vector3(0,-1,0),50);return f.a.pickWithRay(a,function(a){return a.id===f.b.j.id})}Object.defineProperty(a,"__esModule",{value:!0});a.H=new BABYLON.Vector3(-1E3,
1E3,1E3);a.V=new BABYLON.Vector3(0,0,0);a.W=new BABYLON.Vector3(0,0,0);a.h=new BABYLON.Vector3(0,0,0);a.hb=d;a.c=function(){f.a.registerBeforeRender(function(){m();void 0===a.h?(d(a.H),c.C(void 0)):10<BABYLON.Vector3.Distance(e.o(),a.h)&&(d(a.H),c.C(void 0));f.b.ma.position.copyFrom(a.h);void 0!==c.u&&(f.b.ma.isVisible=c.u!==c.w);var b=n(e.o()).pickedPoint;b&&(a.V=b);if(b=n(a.h).pickedPoint)a.W=b})};a.ib=m;a.Ha=n});l("Cameras/CommonCamera",["require","exports","../Navigation/Points","../Vars"],function(l,
a,e,f){function c(){if(3===f.b.g)return new BABYLON.Vector3(0,0,0);var a=f.f.webVRCamera,c;a.leftCamera?c=a.leftCamera.globalPosition.subtract(a.position):c=new BABYLON.Vector3(0,0,0);return c}Object.defineProperty(a,"__esModule",{value:!0});var d=new BABYLON.Vector3(1,0,0),m=new BABYLON.Vector3(1,0,0);a.o=function(){var a=f.a.activeCamera,c=a.position.clone();if(2===f.b.g||1===f.b.g)a.leftCamera?c.copyFrom(a.leftCamera.globalPosition):console.log("Prob here");return c};a.oa=function(a){if(3===f.b.g){var d=
f.a.activeCamera;d.position.copyFrom(a)}else if(2===f.b.g||1===f.b.g)d=f.f.webVRCamera,d.position.copyFrom(a.subtract(c()))};a.ha=function(){if(2===f.b.g||1===f.b.g){var a=e.W.subtract(e.V),c=BABYLON.Vector3.GetAngleBetweenVectors(a,d,m);for(0>a.z&&(c=-c);0>c;)c+=2*Math.PI;for(;c>2*Math.PI;)c-=2*Math.PI;return c+=.5*Math.PI}return f.a.activeCamera.rotation.clone().y};a.Ga=c});l("Mols/Shadows",["require","exports","../Vars"],function(l,a,e){function f(){var a=e.a.lights[0],d=64,f=.9625,h=a.name.match(/blur_([0-9\.]+)/g);
null!==h&&(d=parseFloat(h[0].substr(5)));a=a.name.match(/dark_([0-9\.]+)/g);null!==a&&(f=parseFloat(a[0].substr(5)));return{blur:d,N:f}}Object.defineProperty(a,"__esModule",{value:!0});a.Va=function(){var c=e.a.lights[0],d=f();d.$a=0;d.blur=2;console.log(d);e.pa?console.log("iOS, so not generating shadows... causes an error... See https://forum.babylonjs.com/t/issues-between-shadowgenerator-and-ios-osx/795"):(a.s=new BABYLON.ShadowGenerator(4096,c),a.s.useBlurExponentialShadowMap=!0,a.s.setDarkness(d.N),
a.s.B=!0,a.s.i=d.blur,window.s=a.s)};a.Ea=f;a.Ua=function(){for(var a in e.a.meshes)if(e.a.meshes.hasOwnProperty(a)){var d=e.a.meshes[a];if(-1!==d.name.toLowerCase().indexOf("shadowcatcher")||-1!==d.name.toLowerCase().indexOf("shadow_catcher"))d.material=new BABYLON.ShadowOnlyMaterial("shadow_catch"+a.toString(),e.a),d.material.activeLight=e.a.lights[0],d.receiveShadows=!0}}});l("Scene/Optimizations",["require","exports","../Mols/Shadows","../Vars"],function(l,a,e,f){function c(a){if(void 0!==a){a=
a.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(null===a)return null;a=a.length/3}else a=0;return a}function d(){var a=new BABYLON.SceneOptimizerOptions(25,2E3),g=0;a.optimizations.push(new BABYLON.ShadowsOptimization(g));a.optimizations.push(new BABYLON.LensFlaresOptimization(g));a.optimizations.push(new BABYLON.PostProcessesOptimization(g));a.optimizations.push(new BABYLON.ParticlesOptimization(g));a.optimizations.push(new m(g));g++;a.optimizations.push(new h(g));a.optimizations.push(new m(g));
g++;a.optimizations.push(new BABYLON.TextureOptimization(g,512));a.optimizations.push(new m(g));g++;a.optimizations.push(new BABYLON.RenderTargetsOptimization(g));a.optimizations.push(new BABYLON.TextureOptimization(g,256));a.optimizations.push(new m(g));g++;a.optimizations.push(new BABYLON.HardwareScalingOptimization(g,4));a.optimizations.push(new n(g,500));a.optimizations.push(new m(g));return a}function m(a){var b=this;"undefined"===typeof a&&(a=0);this.priority=a;this.apply=function(){console.log("Optimization priority:",
b.priority);console.log("FPS:",f.m.getFps());console.log("");return!0};this.getDescription=function(){return"Reports the current priority. For debugging."}}function h(a){"undefined"===typeof a&&(a=0);this.priority=a;this.apply=function(){var a=f.a.getMeshByName("surfaces.wrl");null!==a&&a.dispose();return!0};this.getDescription=function(){return"Removes surface representations."}}function n(a,g,d){void 0===d&&(d=void 0);"undefined"===typeof a&&(a=0);this.priority=a;this.apply=function(){var a=[],
b;for(b in f.a.meshes)if(f.a.meshes.hasOwnProperty(b)){var e=f.a.meshes[b];if(-1===e.name.indexOf("Decimated")){var t=c(e);null!==t&&(t<g||a.push([t,e,void 0===d?1-g/t:d]))}}a.sort(function(a,b){return b[0]-a[0]});for(b in a)if(a.hasOwnProperty(b)){e=a[b][1];for(t=a[b][2];0<e.getLODLevels().length;){var h=e.getLODLevels()[0].mesh;e.removeLODLevel(h);null!==h&&h.dispose()}e.simplify([{quality:t,distance:.001}],!1,BABYLON.SimplificationType.QUADRATIC,function(){})}return!0};this.getDescription=function(){return"Simplifies the geometry of complex objects in the scene."}}
Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){BABYLON.SceneOptimizer.OptimizeAsync(f.a,d());f.a.autoClear=!1;f.a.autoClearDepthAndStencil=!1;for(var a in f.a.meshes)if(f.a.meshes.hasOwnProperty(a)){var c=f.a.meshes[a];-1!==c.name.indexOf("baked")&&void 0!==c.material&&(c.material.diffuseColor=new BABYLON.Color3(0,0,0),c.material.specularColor=new BABYLON.Color3(0,0,0),c.material.emissiveTexture=c.material.diffuseTexture,c.material.diffuseTexture=null,c.freezeWorldMatrix())}};a.X=
function(a){var b=c(a);null===b||100>b||(b=1+Math.floor(b/f.qa),1<b&&a.subdivide(b))};a.ga=function(a,c){void 0===c&&(c=!0);c&&a.material.freeze()};a.I=function(){e.s&&(f.a.lights[0].autoUpdateExtends=!0,e.s.getShadowMap().refreshRate=BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE,f.a.lights[0].autoUpdateExtends=!1)}});l("Navigation/Navigation","require exports ../Cameras/CommonCamera ../Cameras/NonVRCamera ../Scene/Optimizations ../Vars ./Pickables ./Points".split(" "),function(l,a,e,f,c,d,
m,h){function n(){v=e.o();d.a.registerBeforeRender(function(){var a=e.o();null===h.Ha(a).pickedMesh?e.oa(v):v=a})}function b(){jQuery("body").keypress(function(a){32===a.charCode&&g()})}function g(){var a=(new Date).getTime();if(!(250>a-t))switch(t=a,console.log("hi"),m.Fa()){case 2:console.log("teleport");p();break;case 4:q();break;case 3:m.u.v()}}function p(a,b){void 0===a&&(a=void 0);void 0===b&&(b=void 0);void 0===b&&(b=function(){});d.f.gazeTrackerMesh.isVisible=!1;var c=new BABYLON.Animation("animationCameraTeleportation",
"position",90,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),g=e.o();void 0===a&&(a=new BABYLON.Vector3(h.h.x,h.h.y+d.L,h.h.z));var f=e.Ga();a=a.subtract(f);g=g.subtract(f);c.setKeys([{frame:0,value:g},{frame:d.aa,value:a}]);var k=d.a.activeCamera;k.animations=[];k.animations.push(c);d.a.beginAnimation(k,0,d.aa,!1,1,function(){d.f.gazeTrackerMesh.isVisible=!0;k.animations=[];b()})}function q(){var a=h.W,b=e.o(),c=h.h.subtract(b),g=c.length(),k;.1*g<d.$?k=h.h.subtract(c.normalize().scale(d.$)):
.1*g>d.T?k=h.h.subtract(c.normalize().scale(d.T)):.1*g<d.T&&(k=b.add(c.scale(.9)));k.y=h.h.y;k.y-a.y<.5*d.S+.1&&(k.y=a.y+.5*d.S+.1);d.Ra(h.h.y-a.y);p(k,function(){f.Qa()})}function k(){A=jQuery("#capture-clicks");A.click(function(){console.log("clicked!");g()});d.a.registerBeforeRender(function(){var a=d.a.activeCamera.inputs.attached.deviceOrientation;(a=a?0!==a._alpha||0!==a._beta||0!==a._gamma:!1)&&!x?(x=!0,A.show()):!a&&x&&(x=!1,A.bb())})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){d.b.j=
d.a.getMeshByID(d.b.ia);null===d.b.j&&alert("No mesh named "+d.b.ia);d.b.j.checkCollisions=!0;d.b.j.visibility=0;c.X(d.b.j);m.ka({K:g,mesh:d.b.j});d.b.g=3;b();h.c();k();n()};var v,t=0;a.ba=g;var A=void 0,x=!1});l("Navigation/Pickables","require exports ../Cameras/CommonCamera ../Scene/Optimizations ../Vars ./Navigation".split(" "),function(l,a,e,f,c,d){function m(a){void 0===a.K&&(a.K=d.ba);void 0===a.a&&(a.a=c.a);void 0!==a.mesh&&(a.mesh.actionManager=new BABYLON.ActionManager(a.a),a.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,
function(){3===c.b.g&&a.K()})))}Object.defineProperty(a,"__esModule",{value:!0});var h=[],n=[],b=[];a.C=function(b){a.u=b};a.c=function(){h.push(c.b.j)};a.xa=function(a){h.push(a);n.push(a);f.X(a);m({mesh:a,K:function(){a.v()}})};a.ya=function(a){h.push(a);b.push(a);f.X(a);m({mesh:a})};a.ea=function(a){return a.id===c.b.j.id?!0:a.isVisible?-1!==h.indexOf(a):!1};a.Fa=function(){return void 0===a.u?1:a.u===c.b.j?2:-1!==n.indexOf(a.u)?3:-1!==b.indexOf(a.u)?4:a.u===a.w?5:1};a.ka=m;a.La=function(){a.w=
BABYLON.Mesh.CreateSphere("padNavSphereAroundCamera",4,c.Z-1,c.a);a.w.flipFaces(!0);var b=new BABYLON.StandardMaterial("padNavSphereAroundCameraMat",c.a);b.diffuseColor=new BABYLON.Color3(1,1,1);b.specularColor=new BABYLON.Color3(0,0,0);b.i=null;a.w.material=b;a.w.visibility=0;c.a.registerBeforeRender(function(){a.w.position=e.o()});h.push(a.w)}});l("Cameras/VRControllers","require exports ../Navigation/Navigation ../Navigation/Pickables ../Navigation/Points ../Vars ./CommonCamera ./VRCamera".split(" "),
function(l,a,e,f,c,d,m,h){function n(a){a.onTriggerStateChangedObservable.add(function(a){a.pressed&&(a=(new Date).getTime(),a-g>d.wa&&(g=a,e.ba()))})}function b(a){a.onPadStateChangedObservable.add(function(a){(v=a.pressed)&&Math.abs(q)<d.J&&Math.abs(k)<d.J&&console.log("Would reset camera view if you didn't get an error below...")});a.onPadValuesChangedObservable.add(function(a){q=a.y;k=a.x;Math.abs(k)<d.J&&Math.abs(q)<d.J?k=q=0:.5>Math.abs(k)?k=0:(k+=0<k?-.5:.5,k=2*k)});d.a.registerBeforeRender(function(){if(v){if(!c.h.equals(c.H)){var a=
m.o(),b=c.h.subtract(a);b.normalize();b=b.scale(q*d.ta*d.a.getAnimationRatio());m.oa(a.subtract(b))}0!==k&&(a=(new Date).getTime(),a-p<d.va||(p=a,a=d.f.webVRCamera.rotationQuaternion.toEulerAngles(),a.y+=.25*Math.sign(k)*Math.PI,d.f.webVRCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a)))}})}Object.defineProperty(a,"__esModule",{value:!0});var g=0,p=0,q=0,k=0,v=!1;a.c=function(){f.La();d.f.webVRCamera.onControllerMeshLoadedObservable.add(function(a){d.b.g=1;console.log("controller loaded");
h.Sa();console.log("Isnt there on pickable or something");n(a);b(a)})}});l("Cameras/VRCamera","require exports ../Navigation/Pickables ../Scene/Optimizations ../Vars ./VRControllers".split(" "),function(l,a,e,f,c,d){function m(){c.f.onEnteringVRObservable.add(function(){c.b.g=2;n();e.C(void 0);f.I();window.vrHelper=c.f});c.f.onExitingVRObservable.add(function(){c.b.g=3;e.C(void 0);f.I()})}function h(){var a=new BABYLON.Mesh("vrNavTargetMesh",c.a),d=new BABYLON.VertexData;d.B=[0,0,0];d.i=[0];d.applyToMesh(a);
a.isVisible=!1;return a}function n(){c.f.raySelectionPredicate=function(a){return e.ea(a)};c.f.gazeTrackerMesh=h();c.f.updateGazeTrackerScale=!1;c.f.displayGaze=!0;c.f.enableInteractions()}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m();d.c()};a.Sa=n});l("Mols/CommonLoader","require exports ../Navigation/Pickables ../Scene/LoadAndSetup ../Scene/Optimizations ../Vars ./Shadows".split(" "),function(l,a,e,f,c,d,m){Object.defineProperty(a,"__esModule",{value:!0});a.Aa=function(){m.Va();
BABYLON.OBJFileLoader.OPTIMIZE_WITH_UV=!0};a.za=function(a){m.Ua();void 0!==a.transparentGround&&!0===a.transparentGround&&(d.b.j?(d.b.j.visibility=1,a=new BABYLON.StandardMaterial("transparentGround",d.a),a.diffuseColor=new BABYLON.Color3(1,1,1),a.specularColor=new BABYLON.Color3(0,0,0),a.emissiveColor=new BABYLON.Color3(0,0,0),a.alpha=d.ua,d.b.j.material=a):console.log("Warning: Vars.vrVars.groundMesh not defined."));f.Ka()};a.Ta=function(a){if(void 0!==a.material&&null!==a.material){var d=m.Ea();
d=.95<d.N?.05:.4>d.N?.0025:.013636363636363637*d.N-.0029545454545454545;a.material.emissiveColor=new BABYLON.Color3(d,d,d);c.ga(a)}a.scaling.z=-1;a.scaling.x=-1;m.s&&m.s.getShadowMap().renderList.push(a);e.ya(a)}});l("Mols/3DMol/VRMLParserWebWorker",["require","exports"],function(l,a){function e(a){var k=[];a=a.split("geometry IndexedFaceSet {").splice(1);for(var e in a)if(a.hasOwnProperty(e)){var q=a[e],l=void 0,x=void 0,r=void 0,w=void 0;x=c(d("point [","]",q));x=x.map(function(a){return[a[2],a[1],
a[0]]});x=m(x);x=h(x);r=c(d("vector [","]",q));r=r.map(function(a){return[a[2],a[1],a[0]]});r=m(r);r=h(r);l=c(d("color [","]",q));l=l.map(function(a){return[a[0],a[1],a[2],1]});l=m(l);l=h(l);w=d("coordIndex [","]",q).split(",").map(function(a){return parseInt(a,10)}).filter(function(a){return-1!==a&&!isNaN(a)&&void 0!==a});k.push({colorsFlat:l,coorsFlat:x,normsFlat:r,trisIdxs:w})}k=n(b(k).map(function(a){return-a}),k);if(p){g=[];e=["colorsFlat","coorsFlat","normsFlat","trisIdxs"];for(var z in k)if(k.hasOwnProperty(z))for(var u in e)if(e.hasOwnProperty(u)){a=
e[u];q=f(k[z][a]);for(var y in q)q.hasOwnProperty(y)&&g.push([parseInt(z,10),a,q[y]])}return[]}return k}function f(a){for(var b=[],c=0,d=a.length;c<d;)b.push(a.slice(c,c+=1E5));return b}function c(a){return a.split(",").map(function(a){a=a.replace(/\n/g,"").replace(/^ +/gm,"");return a.split(" ").map(function(a){return parseFloat(a)})})}function d(a,b,c){a=c.split(a,2);if(1>=a.length)return"";a=a[1].split(b,2);return a[0]}function m(a){if(6E4>=a.length)return[].concat.apply([],a);console.log("large array");
var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c],f;for(f in d)d.hasOwnProperty(f)&&b.push(d[f])}return b}function h(a){return a.filter(function(a){return!isNaN(a)&&void 0!==a})}function n(a,b){for(var c in b)b.hasOwnProperty(c)&&(b[c].coorsFlat=b[c].coorsFlat.map(function(b,c){return b+a[c%3]}));return b}function b(a){if(0===a.length)return[0,0,0];var b=a.map(function(a){return a.coorsFlat.length}).reduce(function(a,b){return a+b});if(0===b)return[0,0,0];var c=0,d=0,f=0,g;for(g in a)if(a.hasOwnProperty(g)){var e=
a[g];c+=e.coorsFlat.map(function(a,b){return 0===b%3?a:0}).reduce(function(a,b){return a+b});d+=e.coorsFlat.map(function(a,b){return 1===b%3?a:0}).reduce(function(a,b){return a+b});f+=e.coorsFlat.map(function(a,b){return 2===b%3?a:0}).reduce(function(a,b){return a+b})}a=b/3;return[c/a,d/a,f/a]}Object.defineProperty(a,"__esModule",{value:!0});var g=void 0,p=!1;"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&(p=!0);p&&(self.onmessage=function(a){var b=a.data.cmd;a=a.data.data;
"start"===b&&(e(a),b="sendDataChunk");"sendDataChunk"===b&&(b=g.shift(),postMessage({chunk:b,status:0===g.length?"done":"more"}))});a.Ja=e});l("Mols/3DMol/VRML","require exports ../../Scene/Optimizations ../../Vars ../CommonLoader ./VRMLParserWebWorker".split(" "),function(l,a,e,f,c,d){function m(a){b=[];"undefined"!==typeof Worker?("undefined"===typeof p&&(p=new Worker("VRMLParserWebWorker.js")),p.onmessage=function(c){var d=c.data;c=d.chunk;d=d.status;var f=c[0],g=c[1];c=c[2];b.length===f&&b.push({coorsFlat:[],
normsFlat:[],colorsFlat:[],trisIdxs:[]});b[f][g].push.apply(b[f][g],c);switch(d){case "more":p.postMessage({cmd:"sendDataChunk",data:void 0});break;case "done":console.log(b);a();break;default:console.log("Error here!")}},p.postMessage({cmd:"start",data:g})):(b=d.Ja(g),a())}function h(){var d=[],g;for(g in b)if(b.hasOwnProperty(g)){var e=b[g],h=new BABYLON.VertexData;h.positions=e.coorsFlat;h.indices=e.trisIdxs;h.normals=e.normsFlat;h.colors=e.colorsFlat;null!==f.a.getMeshByName("MeshFrom3DMol")&&
f.a.getMeshByName("MeshFrom3DMol").dispose();e=new BABYLON.Mesh("mesh_3dmol_tmp"+g,f.a);h.applyToMesh(e);h=new BABYLON.StandardMaterial("Material",f.a);h.diffuseColor=new BABYLON.Color3(1,1,1);h.emissiveColor=new BABYLON.Color3(0,0,0);h.specularColor=new BABYLON.Color3(0,0,0);e.material=h;d.push(e)}0<d.length&&(a.l=BABYLON.Mesh.MergeMeshes(d,!0,!0),a.l.name="MeshFrom3DMol",a.l.id="MeshFrom3DMol",c.Ta(a.l))}function n(b){if(void 0!==a.l){a.l.scaling=new BABYLON.Vector3(1,1,1);a.l.position=new BABYLON.Vector3(0,
0,0);f.a.render();var c=b.getBoundingInfo().boundingBox;b=Object.keys(c.maximumWorld).map(function(a){return c.maximumWorld[a]-c.minimumWorld[a]});var d=a.l.getBoundingInfo().boundingBox,g=Object.keys(d.maximumWorld).map(function(a){return d.maximumWorld[a]-d.minimumWorld[a]});b=b.map(function(a,b){return a/g[b]});b=Math.min.apply(null,b);a.l.scaling=new BABYLON.Vector3(b,b,b);f.a.render();b=d.centerWorld.subtract(c.centerWorld);a.l.position=a.l.position.subtract(b);e.I()}}Object.defineProperty(a,
"__esModule",{value:!0});var b=[],g,p;a.c=function(){jQuery("body").append('<div\n        id="mol-container"\n        class="mol-container"\n        style="display:none;"></div>');var b=jQuery("#mol-container");a.A=$3Dmol.createViewer(b,{backgroundColor:"white"});window.viewer=a.A};a.Ia=function(b){jQuery.ajax("https://files.rcsb.org/view/1XDN.pdb",{success:function(c){a.A.addModel(c,"pdb");b()},error:function(a,b,c){console.error("Failed to load PDB https://files.rcsb.org/view/1XDN.pdb: "+c)}})};
a.render=function(b){void 0===b&&(b=!0);f.m.hideLoadingUI();a.A.render();b&&(g=a.A.exportVRML(),m(function(){h();n(f.a.getMeshByName("protein_box"))}))};a.cb=h;a.fb=n});l("Mols/3DMol/Visualize",["require","exports","./VRML"],function(l,a,e){function f(a,b,c){a.sort();return a.join("-")+"-"+b+"-"+c}function c(a){var b=a.map(function(a){return a}),c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(d.toUpperCase());b.push(d.toLowerCase())}return b=b.filter(function(a,c){return b.indexOf(a)>=c})}
Object.defineProperty(a,"__esModule",{value:!0});var d=[],m={All:{},Protein:{resn:c("ALA ARG ASP ASN ASX CYS GLN GLU GLX GLY HIS HSP HYP ILE LEU LYS MET PCA PHE PRO TRP TYR VAL GLU SER THR MSE".split(" "))},Acidic:{resn:c(["ASP","GLU"])},Cyclic:{resn:c(["HIS","PHE","PRO","TRP","TYR"])},Aliphatic:{resn:c(["ALA","GLY","ILE","LEU","VAL"])},Aromatic:{resn:c(["HIS","PHE","TRP","TYR"])},Basic:{resn:c(["ARG","HIS","LYS","HSP"])},Charged:{resn:c("ASP GLU ARG HIS LYS HSP".split(" "))},Hydrophobic:{resn:c("ALA LEU VAL ILE PRO PHE MET TRP".split(" "))},
Neutral:{resn:c("VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP".split(" "))},Nucleic:{resn:c("ADE A GUA G CYT C THY T URA U".split(" "))},Purine:{resn:c(["ADE","A","GUA","G"])},Pyrimidine:{resn:c("CYT C THY T URA U".split(" "))},Ions:{resn:c("AL BA CA CAL CD CES CLA CL CO CS CU CU1 CUA HG IN IOD K MG MN3 MO3 MO4 MO5 MO6 NA NAW OC7 PB POT PT RB SOD TB TL WO4 YB ZN ZN1 ZN2".split(" "))},Water:{resn:c(["WAT","HOH","TIP","TIP3"])}};m.Ligand={not:{or:[m.Protein,m.Nucleic,m.Ions,m.Water]}};var h={Element:{colorscheme:"default"},
Red:{color:"red"},Blue:{color:"blue"},Green:{color:"green"},Orange:{color:"orange"},Yellow:{color:"yellow"},Purple:{color:"purple"},Spectrum:{color:"spectrum"}};a.Za=function(a,b,c){var g=f(a,b,c);-1!==d.map(function(a){return a[0]}).indexOf(g)?d=d.filter(function(a){return a[0]!==g}):d.push([g,{filters:a,Oa:b,Ba:c}]);e.A.setStyle({});for(var l in d)d.hasOwnProperty(l)&&(b=d[parseInt(l,10)],c=b[1].filters,a={},a[b[1].Oa.toLowerCase()]=h[b[1].Ba],b={and:c.map(function(a){return m[a]})},e.A.addStyle(b,
a));e.render()}});l("UI/Menu3D","require exports ../Cameras/CommonCamera ../Mols/3DMol/Visualize ../Navigation/Pickables ../Navigation/Points ../Vars".split(" "),function(l,a,e,f,c,d,m){function h(){function a(a){if(c.hasOwnProperty(a)){t[a]=new BABYLON.GUI.SpherePanel;v.addControl(t[a]);t[a].blockLayout=!0;c[a].reverse();var b=function(b){if(c[a].hasOwnProperty(b)){b=c[a][b];var d=b.D,f=b.P;k.push(new C({v:function(){f()},default:!1,O:d,ja:function(a){a.isVisible(!1)},level:parseInt(a,10),name:"menu-visible-button-"+
d,na:t[a],R:d,color:b.color}));t[a].columns=4;window.panels=t;t[a].blockLayout=!1;t[a].linkToTransformNode(r);setInterval(function(){t[a].radius=m.sa;t[a].margin=m.ra},1E3)}},d;for(d in c[a])b(d)}}var c=n();c=b(c);r=new BABYLON.TransformNode("");v=new BABYLON.GUI.GUI3DManager(m.a);for(var d in c)a(d)}function n(){function a(f,e,g){function h(d){if(l.hasOwnProperty(d)){d=l[d];var h=f[d];c[e]=void 0===c[e]?[]:c[e];switch(typeof h){case "function":c[e].push({P:h,D:d,F:g});break;case "object":var k=b(e+
1);c[e].push({color:w,P:function(){p(k)},D:d+" \u21e8",F:g});a(h,k,e);break;default:alert("error!")}}}d.push(e);var l=Object.keys(f),k;for(k in l)h(k)}function b(a){for(;-1!==d.indexOf(a);)a++;return a}var c={},d=[];a(q,1,void 0);return c}function b(a){function b(b){if(a.hasOwnProperty(b)){a[b].sort(function(a,b){return(""+a.D).localeCompare(b.D)});var c=parseInt(b,10);1<c&&a[b].push({color:y,P:function(){p(a[b][0].F)},D:"Back \u21e6",F:a[b][0].F});0<c&&a[b].push({color:G,P:function(){u.Y()},D:"Close Menu \u00d7",
F:a[b][0].F})}}for(var c in a)b(c);console.log(a);return a}function g(){var a=new BABYLON.GUI.StackPanel3D;v.addControl(a);u=new C({v:function(a){a.value?p(1):p(0);r.position.copyFrom(e.o());r.rotation.y=e.ha()},default:!1,O:"Show Menu",level:0,name:"menu-visible-button",na:a,R:"Hide Menu"});var b=new BABYLON.TransformNode("");a.linkToTransformNode(b);b.rotation.x=.5*Math.PI;m.a.registerBeforeRender(function(){b.position.copyFrom(d.V);b.position.y+=.1;b.rotation.y=e.ha()})}function p(a){for(var b in k)if(k.hasOwnProperty(b)){var c=
k[b];0===c.level?c.isVisible(!0):c.level===a?c.isVisible(!0):c.isVisible(!1)}}Object.defineProperty(a,"__esModule",{value:!0});var q=function(){function a(a){if(b.hasOwnProperty(a)){var d=b[a];h[d]={};a=function(a){if(c[d].hasOwnProperty(a)){var b=c[d][a];h[d][b]={};a=function(a){if(e[d].hasOwnProperty(a)){var c=e[d][a];h[d][b][c]={};a=function(a){if(g.hasOwnProperty(a)){var e=g[a];h[d][b][c][e]=function(){f.Za([d,b],c,e);u.Y()}}};for(var k in g)a(k)}};for(var k in e[d])a(k)}};for(var k in c[d])a(k)}}
var b=["Protein","Ligand","Water","Nucleic"],c={Ligand:["All"],Nucleic:["All"],Protein:["All","Hydrophobic","Hydrophilic","Charged","Aromatic"],Water:["All"]},d=["Stick","Sphere","Surface"],e={Ligand:d,Nucleic:d,Protein:["Cartoon"].concat(d),Water:d},g="Element Red Blue Green Orange Yellow Purple Spectrum".split(" "),h={},k;for(k in b)a(k);return h}(),k=[],v,t={},r,x,u,w=new BABYLON.Color3(.3,.35+.1,.4),y=new BABYLON.Color3(.4,.35+.1,.4),G=new BABYLON.Color3(.4,.35,.4);a.c=function(a){h(a);g();x=
new BABYLON.Sound("click-button","assets/staple-public-domain.mp3",m.a,null,{loop:!1,autoplay:!1,jb:!0,volume:.1})};var C=function(){function a(a){var b=this;this.button=new BABYLON.GUI.HolographicButton(a.name);a.na.addControl(this.button);if(void 0!==a.color){var d=this.button.mesh.material.clone();d.albedoColor=a.color;this.button.mesh.material=d}this.level=a.level;this.B=new BABYLON.GUI.TextBlock;this.B.color="white";this.B.i=!0;this.value=a.default;this.R=a.R;this.O=a.O;this.v=a.v;this.da();
this.i=BABYLON.Mesh.CreateSphere(a.name+"-container-mesh",2,m.S,m.a);this.i.position=this.button.node.absolutePosition;this.i.visibility=0;this.i.v=function(){b.Y()};c.xa(this.i);void 0!==a.ja&&a.ja(this)}a.prototype.isVisible=function(a){if(void 0===a)return this.button.isVisible;this.button.isVisible=a;this.i.isVisible=a};a.prototype.Y=function(){x.setPosition(this.i.position.clone());x.play();this.value=!this.value;this.v(this);this.da()};a.prototype.da=function(){this.B.text=this.value?this.R:
this.O;this.button.content.dispose();this.button.content=this.B};return a}()});l("Mols/3DMol/ThreeDMol",["require","exports","../CommonLoader","./VRML"],function(l,a,e,f){function c(a){f.c();f.Ia(function(){f.A.setStyle({},{cartoon:{color:"spectrum"}});f.render();e.za(a)})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(a){try{jQuery.getScript("https://3Dmol.csb.pitt.edu/build/3Dmol-min.js",function(){c(a)})}catch(m){c(a)}}});l("Mols/Load","require exports ../Scene/Optimizations ../UI/Menu3D ../Vars ./3DMol/ThreeDMol ./CommonLoader".split(" "),
function(l,a,e,f,c,d,m){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m.Aa();jQuery.getJSON("scene_info.json",function(a){!1===a.menuActive&&(c.b.la=!1);d.c(a);c.b.la&&f.c(a);e.I()})}});l("UI/LoadingScreens",["require","exports","../Vars"],function(l,a,e){function f(){clearInterval(c)}Object.defineProperty(a,"__esModule",{value:!0});var c;a.Na=function(){document.getElementById("loading-container").outerHTML=""};a.ca=function(a){f();e.m.displayLoadingUI();e.m.loadingUIText=a};a.Xa=
function(){var a=90;clearInterval(c);c=setInterval(function(){a+=.02*(99-a);e.m.displayLoadingUI();e.m.loadingUIText="Loading the main scene... "+a.toFixed(0)+"%"},100)};a.Ya=f});l("UI/UI2D",["require","exports","../Vars"],function(l,a,e){function f(){jQuery("body").append('\n        <button\n          title="Click to switch to full screen"\n          id="fullscreen-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:80px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n            <svg\n              style="position:relative; left:0.5px;"\n              width="48" height="48"\n              xmlns="http://www.w3.org/2000/svg"\n              xmlns:svg="http://www.w3.org/2000/svg"\n              clip-rule="evenodd">\n                <g class="layer">\n                    <path d="m47.799999,43.649999l-47.699999,0l0,-39.749999l47.699999,0l0,39.749999zm-1.9875,-37.762499l-43.724999,0l0,35.774999l43.724999,0l0,-35.774999zm-7.95,13.9125l-1.9875,0l0,-6.441487l-22.341487,22.341487l6.441487,0l0,1.9875l-9.9375,0l0,-9.9375l1.9875,0l0,6.441487l22.341487,-22.341487l-6.441487,0l0,-1.9875l9.9375,0l0,9.9375z" fill="#ffffff" id="svg_1"/>\n                </g>\n            </svg>\n        </button>\n\n        <button\n          title="Click for help"\n          id="help-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:140px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n                 <svg version="1.2" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" xml:space="preserve">\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="\n\tM35.5,9.8c1.7,5.4-0.6,8-1.6,8.9c-1.9,1.9-4.5,4.7-5.8,7c-1.5,2.7-4.1,12-6.8,4.4c-3.2-9.1,1.3-11.6,3.5-13.4\n\tc1.5-1.3,3.4-4.3,0.5-5.3c-4-1.3-6.1,5.3-10.7,4c-3-0.8-3.2-4.1-2.2-6.6C15.4,1.7,32.5,0.6,35.5,9.8L35.5,9.8z"/>\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" d="M28.3,39.6c0-5.5-8.5-5.5-8.5,0S28.3,45.1,28.3,39.6\n\t"/>\n</svg>\n\n        </button>\n    ');
jQuery("#fullscreen-button").click(function(){e.m.switchFullscreen(!0);jQuery("#renderCanvas").focus()});jQuery("#help-button").click(function(){window.open("help/index.html","_blank")});document.getElementById("babylonVRiconbtn").style.opacity="1.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=1.0)"}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){f()};window.debugMode=function(){e.a.debugLayer.show();setTimeout(function(){document.getElementById("inspector-host").style.zIndex=
"15";document.getElementById("scene-explorer-host").style.zIndex="15"},500)}});l("Scene/LoadAndSetup","require exports ../Cameras/Setup ../Cameras/VRCamera ../Mols/Load ../Navigation/Navigation ../Navigation/Pickables ../UI/LoadingScreens ../UI/UI2D ../Vars ./Optimizations".split(" "),function(l,a,e,f,c,d,m,h,n,b,g){function p(){var a=BABYLON.Mesh.CreateSphere("navTargetMesh",4,.1,b.a),c=new BABYLON.StandardMaterial("myMaterial",b.a);c.diffuseColor=new BABYLON.Color3(1,0,1);a.material=c;b.Wa({ia:"ground",
ma:a});f.c();g.c();window.i=b}function q(a){h.ca("Loading the main scene...");BABYLON.SceneLoader.LoadAssetContainer("scene/","scene.babylon",b.a,function(c){h.Xa();b.a.executeWhenReady(function(){c.addAllToScene();b.a.activeCamera=b.a.cameras[0];for(var d=!1,e=0;1<b.a.lights.length;){var f=b.a.lights[e].name.toLowerCase();-1===f.indexOf("shadowlight")&&-1===f.indexOf("shadow_light")?b.a.lights[e].dispose():d?b.a.lights[e].dispose():(d=!0,e++)}for(var h in b.a.meshes)"protein_box"===b.a.meshes[h].name&&
(b.a.getMeshByName("protein_box").isVisible=!1);for(var k in b.a.meshes)if(b.a.meshes[k].material){d=b.a.meshes[k];if(void 0===d.material.emissiveTexture||null===d.material.emissiveTexture)d.material.emissiveTexture=d.material.diffuseTexture,d.material.diffuseColor=new BABYLON.Color3(0,0,0),d.material.specularColor=new BABYLON.Color3(0,0,0),d.material.emissiveColor=new BABYLON.Color3(0,0,0);g.ga(d,!1);m.ka({mesh:d,a:b.a})}a()})},function(a){a.lengthComputable&&h.ca("ALoading the main scene... "+Math.round(90*
a.loaded/a.total).toString()+"%")})}Object.defineProperty(a,"__esModule",{value:!0});a.load=function(){b.c();h.Na();p();q(function(){e.c();d.c();m.c();n.c();c.c()});window.addEventListener("resize",function(){b.m.resize()})};a.Ka=function(){setTimeout(g.I,1E3);h.Ya();b.a.activeCamera.maxZ=250;b.a.activeCamera.minZ=0;b.m.runRenderLoop(function(){b.a.render()})}});u.M({urlArgs:"bust="+(new Date).getTime()});u(["Scene/LoadAndSetup"],function(l){l.load()});l("Start",function(){})})();
