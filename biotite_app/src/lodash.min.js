/*
 almond 0.3.3 Copyright jQuery Foundation and other contributors.
 Released under MIT license, http://github.com/requirejs/almond/LICENSE
*/
var E="function"==typeof Object.defineProperties?Object.defineProperty:function(u,t,n){u!=Array.prototype&&u!=Object.prototype&&(u[t]=n.value)},F="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function G(u){if(u){for(var t=F,n=["Math","sign"],v=0;v<n.length-1;v++){var a=n[v];a in t||(t[a]={});t=t[a]}n=n[n.length-1];v=t[n];u=u(v);u!=v&&null!=u&&E(t,n,{configurable:!0,writable:!0,value:u})}}
G(function(u){return u?u:function(t){t=Number(t);return 0===t||isNaN(t)?t:0<t?1:-1}});
(function(){var u,t,n;(function(v){function a(a,d){var x,c;d=d&&d.split("/");var e=r.map,l=e&&e["*"]||{};if(a){a=a.split("/");var b=a.length-1;r.cb&&p.test(a[b])&&(a[b]=a[b].replace(p,""));"."===a[0].charAt(0)&&d&&(b=d.slice(0,d.length-1),a=b.concat(a));for(b=0;b<a.length;b++){var h=a[b];"."===h?(a.splice(b,1),--b):".."===h&&0!==b&&(1!==b||".."!==a[2])&&".."!==a[b-1]&&0<b&&(a.splice(b-1,2),b-=2)}a=a.join("/")}if((d||l)&&e){h=a.split("/");for(b=h.length;0<b;--b){var k=h.slice(0,b).join("/");if(d)for(c=
d.length;0<c;--c)if(x=e[d.slice(0,c).join("/")])if(x=x[k]){var g=x;var f=b;break}if(g)break;if(!w&&l&&l[k]){var w=l[k];var m=b}}!g&&w&&(g=w,f=m);g&&(h.splice(0,f,g),a=h.join("/"))}return a}function f(a,d){return function(){var b=w.call(arguments,0);"string"!==typeof b[0]&&1===b.length&&b.push(null);return q.apply(v,b.concat([a,d]))}}function e(d){return function(b){return a(b,d)}}function g(a){return function(d){b[a]=d}}function c(a){if(h.call(d,a)){var c=d[a];delete d[a];l[a]=!0;C.apply(v,c)}if(!h.call(b,
a)&&!h.call(l,a))throw Error("No "+a);return b[a]}function m(a){var d=a?a.indexOf("!"):-1;if(-1<d){var b=a.substring(0,d);a=a.substring(d+1,a.length)}return[b,a]}function k(a){return function(){return r&&r.L&&r.L[a]||{}}}var q,b={},d={},r={},l={},h=Object.prototype.hasOwnProperty,w=[].slice,p=/\.js$/;var A=function(d,b){d=m(d);var h=d[0];b=b[1];d=d[1];if(h){h=a(h,b);var l=c(h)}h?l&&l.normalize?d=l.normalize(d,e(b)):d=a(d,b):(d=a(d,b),d=m(d),h=d[0],d=d[1],h&&(l=c(h)));return{fa:h?h+"!"+d:d,n:d,fb:h,
p:l}};var y={require:function(a){return f(a)},F:function(a){var d=b[a];return"undefined"!==typeof d?d:b[a]={}},La:function(a){return{id:a,uri:"",F:b[a],L:k(a)}}};var C=function(a,e,p,k){var r,w=[];var q=typeof p;var D=(k=k||a)?m(k):[];if("undefined"===q||"function"===q){e=!e.length&&p.length?["require","exports","module"]:e;for(r=0;r<e.length;r+=1){var x=A(e[r],D);q=x.fa;if("require"===q)w[r]=y.require(a);else if("exports"===q){w[r]=y.F(a);var C=!0}else if("module"===q)var n=w[r]=y.La(a);else if(h.call(b,
q)||h.call(d,q)||h.call(l,q))w[r]=c(q);else if(x.p)x.p.load(x.n,f(k,!0),g(q),{}),w[r]=b[q];else throw Error(a+" missing "+q);}e=p?p.apply(b[a],w):void 0;a&&(n&&n.F!==v&&n.F!==b[a]?b[a]=n.F:e===v&&C||(b[a]=e))}else a&&(b[a]=p)};u=t=q=function(a,d,b,h,e){if("string"===typeof a)return y[a]?y[a](d):c(A(a,d?m(d):[]).fa);if(!a.splice){r=a;r.Ba&&q(r.Ba,r.$a);if(!d)return;d.splice?(a=d,d=b,b=null):a=v}d=d||function(){};"function"===typeof b&&(b=h,h=e);h?C(v,a,d,b):setTimeout(function(){C(v,a,d,b)},4);return q};
q.L=function(a){return q(a)};u.i=b;n=function(a,e,c){if("string"!==typeof a)throw Error("See almond README: incorrect module build, no module name");e.splice||(c=e,e=[]);h.call(b,a)||h.call(d,a)||(d[a]=[a,e,c])};n.i={jQuery:!0}})();n("external/almond",function(){});n("Vars",["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.aa=11;a.S=1.5;a.$=1;a.qa=2E3;a.R=1.2;a.sa=2.5;a.ra=.1;a.ta=.01;a.wa=500;a.va=750;a.I=.1;a.Z=15;a.ua=.05;a.pa=/iPad|iPhone|iPod/.test(navigator.userAgent)&&
!window.MSStream;a.c=function(){a.canvas=document.getElementById("renderCanvas");a.l=new BABYLON.Engine(a.canvas,!0);BABYLON.Database.IDBStorageEnabled=!0;a.a=new BABYLON.Scene(a.l);window.scene=a.a};a.Ca=function(){if(void 0===a.K){var f=new BABYLON.Ray(a.a.activeCamera.position,new BABYLON.Vector3(0,-1,0),50);f=a.a.pickWithRay(f,function(a){return"ground"===a.name});a.K=f.distance}};a.Qa=function(f){a.K=f};a.Va=function(f){var e={createDeviceOrientationCamera:!0};a.a.getEngine().getCaps().multiview&&
(e.useMultiview=!0);a.f=a.a.createDefaultVRExperience(e);document.getElementById("babylonVRiconbtn").style.opacity="0.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=0)";window.vrHelper=a.f;a.b=f;a.b.la=!0}});n("Cameras/NonVRCamera",["require","exports","../Vars"],function(n,a,f){function e(){g.ellipsoid=new BABYLON.Vector3(1,.5*f.K,1)}Object.defineProperty(a,"__esModule",{value:!0});var g;new BABYLON.Vector3(0,0,0);a.c=function(){g=f.a.activeCamera;g.keysUp=[87,38];g.keysDown=
[83,40];g.keysLeft=[65,37];g.keysRight=[68,39];e();f.a.collisionsEnabled=!0;g.checkCollisions=!0;g.speed=.1;g.attachControl(f.canvas,!0);g._updatePosition()};a.Pa=e});n("Cameras/Setup",["require","exports","../Vars","./NonVRCamera"],function(n,a,f,e){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){a.T=f.a.cameras.filter(function(a){return-1===a.name.indexOf("VR")})[0];var g=new BABYLON.DeviceOrientationCamera("DevOr_camera",a.T.position.clone(),f.a,!0);g.rotation=a.T.rotation;f.a.activeCamera=
g;f.a.activeCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.T.rotation);f.Ca();e.c()}});n("Navigation/Points",["require","exports","../Cameras/CommonCamera","../Vars","./Pickables"],function(n,a,f,e,g){function c(b){a.h.copyFrom(b)}function m(){if(3===e.b.g)var b=e.a.activeCamera.getForwardRay();else if(2===e.b.g||1===e.b.g){b=void 0;1===e.b.g?(b=e.f.rightControllerGazeTrackerMesh,b||(b=e.f.leftControllerGazeTrackerMesh)):2===e.b.g&&(b=e.f.gazeTrackerMesh);if(!b){console.log("error!");
return}b.isVisible?c(b.absolutePosition):c(a.G);b=f.m();b=new BABYLON.Ray(b,a.h.subtract(b))}else console.log("Unexpected error.");k(b)}function k(b,d){void 0===d&&(d=!0);b=e.a.pickWithRay(b,function(a){return g.ea(a)});b.hit&&b.distance<e.Z?(d&&c(b.pickedPoint),g.B(b.pickedMesh)):(c(a.G),g.B(void 0))}function q(a){a=new BABYLON.Ray(a,new BABYLON.Vector3(0,-1,0),50);return e.a.pickWithRay(a,function(a){return a.id===e.b.j.id})}Object.defineProperty(a,"__esModule",{value:!0});a.G=new BABYLON.Vector3(-1E3,
1E3,1E3);a.V=new BABYLON.Vector3(0,0,0);a.W=new BABYLON.Vector3(0,0,0);a.h=new BABYLON.Vector3(0,0,0);a.gb=c;a.c=function(){e.a.registerBeforeRender(function(){m();void 0===a.h?(c(a.G),g.B(void 0)):10<BABYLON.Vector3.Distance(f.m(),a.h)&&(c(a.G),g.B(void 0));e.b.ma.position.copyFrom(a.h);void 0!==g.s&&(e.b.ma.isVisible=g.s!==g.v);var b=q(f.m()).pickedPoint;b&&(a.V=b);if(b=q(a.h).pickedPoint)a.W=b})};a.hb=m;a.Ga=q});n("Cameras/CommonCamera",["require","exports","../Navigation/Points","../Vars"],function(n,
a,f,e){function g(){if(3===e.b.g)return new BABYLON.Vector3(0,0,0);var a=e.f.webVRCamera,c;a.leftCamera?c=a.leftCamera.globalPosition.subtract(a.position):c=new BABYLON.Vector3(0,0,0);return c}Object.defineProperty(a,"__esModule",{value:!0});var c=new BABYLON.Vector3(1,0,0),m=new BABYLON.Vector3(1,0,0);a.m=function(){var a=e.a.activeCamera,c=a.position.clone();if(2===e.b.g||1===e.b.g)a.leftCamera?c.copyFrom(a.leftCamera.globalPosition):console.log("Prob here");return c};a.oa=function(a){if(3===e.b.g){var c=
e.a.activeCamera;c.position.copyFrom(a)}else if(2===e.b.g||1===e.b.g)c=e.f.webVRCamera,c.position.copyFrom(a.subtract(g()))};a.ha=function(){if(2===e.b.g||1===e.b.g){var a=f.W.subtract(f.V),g=BABYLON.Vector3.GetAngleBetweenVectors(a,c,m);for(0>a.z&&(g=-g);0>g;)g+=2*Math.PI;for(;g>2*Math.PI;)g-=2*Math.PI;return g+=.5*Math.PI}return e.a.activeCamera.rotation.clone().y};a.Fa=g});n("Mols/Shadows",["require","exports","../Vars"],function(n,a,f){function e(){var a=f.a.lights[0],c=64,e=.9625,k=a.name.match(/blur_([0-9\.]+)/g);
null!==k&&(c=parseFloat(k[0].substr(5)));a=a.name.match(/dark_([0-9\.]+)/g);null!==a&&(e=parseFloat(a[0].substr(5)));return{blur:c,M:e}}Object.defineProperty(a,"__esModule",{value:!0});a.Ua=function(){var g=f.a.lights[0],c=e();c.Za=0;c.blur=2;console.log(c);f.pa?console.log("iOS, so not generating shadows... causes an error... See https://forum.babylonjs.com/t/issues-between-shadowgenerator-and-ios-osx/795"):(a.o=new BABYLON.ShadowGenerator(4096,g),a.o.useBlurExponentialShadowMap=!0,a.o.setDarkness(c.M),
a.o.w=!0,a.o.i=c.blur,window.o=a.o)};a.Da=e;a.Ta=function(){for(var a in f.a.meshes)if(f.a.meshes.hasOwnProperty(a)){var c=f.a.meshes[a];if(-1!==c.name.toLowerCase().indexOf("shadowcatcher")||-1!==c.name.toLowerCase().indexOf("shadow_catcher"))c.material=new BABYLON.ShadowOnlyMaterial("shadow_catch"+a.toString(),f.a),c.material.activeLight=f.a.lights[0],c.receiveShadows=!0}}});n("Scene/Optimizations",["require","exports","../Mols/Shadows","../Vars"],function(n,a,f,e){function g(a){if(void 0!==a){a=
a.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(null===a)return null;a=a.length/3}else a=0;return a}function c(){var a=new BABYLON.SceneOptimizerOptions(25,2E3),c=0;a.optimizations.push(new BABYLON.ShadowsOptimization(c));a.optimizations.push(new BABYLON.LensFlaresOptimization(c));a.optimizations.push(new BABYLON.PostProcessesOptimization(c));a.optimizations.push(new BABYLON.ParticlesOptimization(c));a.optimizations.push(new k(c));c++;a.optimizations.push(new q(c));a.optimizations.push(new k(c));
c++;a.optimizations.push(new BABYLON.TextureOptimization(c,512));a.optimizations.push(new k(c));c++;a.optimizations.push(new BABYLON.RenderTargetsOptimization(c));a.optimizations.push(new BABYLON.TextureOptimization(c,256));a.optimizations.push(new k(c));c++;a.optimizations.push(new BABYLON.HardwareScalingOptimization(c,4));a.optimizations.push(new b(c,500));a.optimizations.push(new k(c));return a}function m(a){null!==a&&a.dispose()}function k(a){var d=this;"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){console.log("Optimization priority:",d.priority);console.log("FPS:",e.l.getFps());console.log("");return!0};this.getDescription=function(){return"Reports the current priority. For debugging."}}function q(a){"undefined"===typeof a&&(a=0);this.priority=a;this.apply=function(){var a=e.a.getMeshByName("surfaces.wrl");m(a);return!0};this.getDescription=function(){return"Removes surface representations."}}function b(a,c,b){void 0===b&&(b=void 0);"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){var a=[],d;for(d in e.a.meshes)if(e.a.meshes.hasOwnProperty(d)){var p=e.a.meshes[d];if(-1===p.name.indexOf("Decimated")){var l=g(p);null!==l&&(l<c||a.push([l,p,void 0===b?1-c/l:b]))}}a.sort(function(a,d){return d[0]-a[0]});for(d in a)if(a.hasOwnProperty(d)){p=a[d][1];for(l=a[d][2];0<p.getLODLevels().length;){var k=p.getLODLevels()[0].mesh;p.removeLODLevel(k);m(k)}p.simplify([{quality:l,distance:.001}],!1,BABYLON.SimplificationType.QUADRATIC,function(){})}return!0};this.getDescription=
function(){return"Simplifies the geometry of complex objects in the scene."}}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){BABYLON.SceneOptimizer.OptimizeAsync(e.a,c());e.a.autoClear=!1;e.a.autoClearDepthAndStencil=!1;for(var a in e.a.meshes)if(e.a.meshes.hasOwnProperty(a)){var b=e.a.meshes[a];-1!==b.name.indexOf("baked")&&void 0!==b.material&&(b.material.diffuseColor=new BABYLON.Color3(0,0,0),b.material.specularColor=new BABYLON.Color3(0,0,0),b.material.emissiveTexture=b.material.diffuseTexture,
b.material.diffuseTexture=null,b.freezeWorldMatrix())}};a.X=function(a){var d=g(a);null===d||100>d||(d=1+Math.floor(d/e.qa),1<d&&a.subdivide(d))};a.ga=function(a,b){void 0===b&&(b=!0);b&&a.material.freeze()};a.H=function(){f.o&&(e.a.lights[0].autoUpdateExtends=!0,f.o.getShadowMap().refreshRate=BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE,e.a.lights[0].autoUpdateExtends=!1)};a.Na=m});n("Navigation/Navigation","require exports ../Cameras/CommonCamera ../Cameras/NonVRCamera ../Scene/Optimizations ../Vars ./Pickables ./Points".split(" "),
function(n,a,f,e,g,c,m,k){function q(){w=f.m();c.a.registerBeforeRender(function(){var a=f.m();null===k.Ga(a).pickedMesh?f.oa(w):w=a})}function b(){jQuery("body").keypress(function(a){32===a.charCode&&d()})}function d(){var a=(new Date).getTime();if(!(250>a-p))switch(p=a,console.log("hi"),m.Ea()){case 2:console.log("teleport");r();break;case 4:l();break;case 3:m.s.u()}}function r(a,d){void 0===a&&(a=void 0);void 0===d&&(d=void 0);void 0===d&&(d=function(){});c.f.gazeTrackerMesh.isVisible=!1;var b=
new BABYLON.Animation("animationCameraTeleportation","position",90,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),e=f.m();void 0===a&&(a=new BABYLON.Vector3(k.h.x,k.h.y+c.K,k.h.z));var h=f.Fa();a=a.subtract(h);e=e.subtract(h);b.setKeys([{frame:0,value:e},{frame:c.aa,value:a}]);var l=c.a.activeCamera;l.animations=[];l.animations.push(b);c.a.beginAnimation(l,0,c.aa,!1,1,function(){c.f.gazeTrackerMesh.isVisible=!0;l.animations=[];d()})}function l(){var a=k.W,d=
f.m(),b=k.h.subtract(d),l=b.length(),h;.1*l<c.$?h=k.h.subtract(b.normalize().scale(c.$)):.1*l>c.S?h=k.h.subtract(b.normalize().scale(c.S)):.1*l<c.S&&(h=d.add(b.scale(.9)));h.y=k.h.y;h.y-a.y<.5*c.R+.1&&(h.y=a.y+.5*c.R+.1);c.Qa(k.h.y-a.y);r(h,function(){e.Pa()})}function h(){A=jQuery("#capture-clicks");A.click(function(){console.log("clicked!");d()});c.a.registerBeforeRender(function(){var a=c.a.activeCamera.inputs.attached.deviceOrientation;(a=a?0!==a._alpha||0!==a._beta||0!==a._gamma:!1)&&!y?(y=!0,
A.show()):!a&&y&&(y=!1,A.ab())})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){c.b.j=c.a.getMeshByID(c.b.ia);null===c.b.j&&alert("No mesh named "+c.b.ia);c.b.j.checkCollisions=!0;c.b.j.visibility=0;g.X(c.b.j);m.ka({J:d,mesh:c.b.j});c.b.g=3;b();k.c();h();q()};var w,p=0;a.ba=d;var A=void 0,y=!1});n("Navigation/Pickables","require exports ../Cameras/CommonCamera ../Scene/Optimizations ../Vars ./Navigation".split(" "),function(n,a,f,e,g,c){function m(a){void 0===a.J&&(a.J=c.ba);void 0===
a.a&&(a.a=g.a);void 0!==a.mesh&&(a.mesh.actionManager=new BABYLON.ActionManager(a.a),a.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(){3===g.b.g&&a.J()})))}Object.defineProperty(a,"__esModule",{value:!0});var k=[],q=[],b=[];a.B=function(b){a.s=b};a.c=function(){k.push(g.b.j)};a.xa=function(a){k.push(a);q.push(a);e.X(a);m({mesh:a,J:function(){a.u()}})};a.ya=function(a){k.push(a);b.push(a);e.X(a);m({mesh:a})};a.ea=function(a){return a.id===
g.b.j.id?!0:a.isVisible?-1!==k.indexOf(a):!1};a.Ea=function(){return void 0===a.s?1:a.s===g.b.j?2:-1!==q.indexOf(a.s)?3:-1!==b.indexOf(a.s)?4:a.s===a.v?5:1};a.ka=m;a.Ka=function(){a.v=BABYLON.Mesh.CreateSphere("padNavSphereAroundCamera",4,g.Z-1,g.a);a.v.flipFaces(!0);var b=new BABYLON.StandardMaterial("padNavSphereAroundCameraMat",g.a);b.diffuseColor=new BABYLON.Color3(1,1,1);b.specularColor=new BABYLON.Color3(0,0,0);b.i=null;a.v.material=b;a.v.visibility=0;g.a.registerBeforeRender(function(){a.v.position=
f.m()});k.push(a.v)}});n("Cameras/VRControllers","require exports ../Navigation/Navigation ../Navigation/Pickables ../Navigation/Points ../Vars ./CommonCamera ./VRCamera".split(" "),function(n,a,f,e,g,c,m,k){function q(a){a.onTriggerStateChangedObservable.add(function(a){a.pressed&&(a=(new Date).getTime(),a-d>c.wa&&(d=a,f.ba()))})}function b(a){a.onPadStateChangedObservable.add(function(a){(w=a.pressed)&&Math.abs(l)<c.I&&Math.abs(h)<c.I&&console.log("Would reset camera view if you didn't get an error below...")});
a.onPadValuesChangedObservable.add(function(a){l=a.y;h=a.x;Math.abs(h)<c.I&&Math.abs(l)<c.I?h=l=0:.5>Math.abs(h)?h=0:(h+=0<h?-.5:.5,h=2*h)});c.a.registerBeforeRender(function(){if(w){if(!g.h.equals(g.G)){var a=m.m(),b=g.h.subtract(a);b.normalize();b=b.scale(l*c.ta*c.a.getAnimationRatio());m.oa(a.subtract(b))}0!==h&&(a=(new Date).getTime(),a-r<c.va||(r=a,a=c.f.webVRCamera.rotationQuaternion.toEulerAngles(),a.y+=.25*Math.sign(h)*Math.PI,c.f.webVRCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a)))}})}
Object.defineProperty(a,"__esModule",{value:!0});var d=0,r=0,l=0,h=0,w=!1;a.c=function(){e.Ka();c.f.webVRCamera.onControllerMeshLoadedObservable.add(function(a){c.b.g=1;console.log("controller loaded");k.Ra();console.log("Isnt there on pickable or something");q(a);b(a)})}});n("Cameras/VRCamera","require exports ../Navigation/Pickables ../Scene/Optimizations ../Vars ./VRControllers".split(" "),function(n,a,f,e,g,c){function m(){g.f.onEnteringVRObservable.add(function(){g.b.g=2;q();f.B(void 0);e.H();
window.vrHelper=g.f});g.f.onExitingVRObservable.add(function(){g.b.g=3;f.B(void 0);e.H()})}function k(){var a=new BABYLON.Mesh("vrNavTargetMesh",g.a),c=new BABYLON.VertexData;c.w=[0,0,0];c.i=[0];c.applyToMesh(a);a.isVisible=!1;return a}function q(){g.f.raySelectionPredicate=function(a){return f.ea(a)};g.f.gazeTrackerMesh=k();g.f.updateGazeTrackerScale=!1;g.f.displayGaze=!0;g.f.enableInteractions()}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m();c.c()};a.Ra=q});n("Mols/CommonLoader",
"require exports ../Navigation/Pickables ../Scene/LoadAndSetup ../Scene/Optimizations ../Vars ./Shadows".split(" "),function(n,a,f,e,g,c,m){Object.defineProperty(a,"__esModule",{value:!0});a.Aa=function(){m.Ua();BABYLON.OBJFileLoader.OPTIMIZE_WITH_UV=!0};a.za=function(a){m.Ta();void 0!==a.transparentGround&&!0===a.transparentGround&&(c.b.j?(c.b.j.visibility=1,a=new BABYLON.StandardMaterial("transparentGround",c.a),a.diffuseColor=new BABYLON.Color3(1,1,1),a.specularColor=new BABYLON.Color3(0,0,0),
a.emissiveColor=new BABYLON.Color3(0,0,0),a.alpha=c.ua,c.b.j.material=a):console.log("Warning: Vars.vrVars.groundMesh not defined."));e.Ja()};a.Sa=function(a){if(void 0!==a.material&&null!==a.material){var c=m.Da();c=.95<c.M?.05:.4>c.M?.0025:.013636363636363637*c.M-.0029545454545454545;a.material.emissiveColor=new BABYLON.Color3(c,c,c);g.ga(a)}a.scaling.z=-1;a.scaling.x=-1;m.o&&m.o.getShadowMap().renderList.push(a);f.ya(a)}});n("Mols/3DMol/VRMLParserWebWorker",["require","exports"],function(n,a){function f(a){var b=
[];a=a.split("geometry IndexedFaceSet {").splice(1);for(var l in a)if(a.hasOwnProperty(l)){var p=a[l];b.push({colors:g(m("color [","]",p)),coors:e(m("point [","]",p)),trisIdxs:c(m("coordIndex [","]",p))})}void 0===d&&(d=k(b));l=d;a=b.length;for(p=0;p<a;p++)for(var f=b[p].coors.length,n=0;n<f;n+=3)b[p].coors[n]-=l[0],b[p].coors[n+1]-=l[1],b[p].coors[n+2]-=l[2];if(r){q=[];l=["colors","coors","trisIdxs"];for(var v in b)if(b.hasOwnProperty(v))for(var x in l)if(l.hasOwnProperty(x)){a=l[x];p=b[v][a];f=
[];n=0;for(var t=p.length;n<t;)f.push(p.slice(n,n+=1E7));p=f;for(var u in p)p.hasOwnProperty(u)&&q.push([+v,a,p[u]])}return[]}return b}function e(a){a=a.match(b);for(var c=a.length,d=new Float32Array(c),e=0;e<c;e+=3)d[e]=+a[e+2],d[e+1]=+a[e+1],d[e+2]=+a[e];return d}function g(a){a=a.match(b);for(var c=new Float32Array(4*a.length/3),d=c.length,e=0;e<d;e+=4){var l=3*e/4;c[e]=+a[l];c[e+1]=+a[l+1];c[e+2]=+a[l+2];c[e+3]=1}return c}function c(a){a=a.match(b);for(var c=3*a.length/4,e=new Uint32Array(c),
d=0;d<c;d+=3){var l=4*d/3;e[d]=+a[l];e[d+1]=+a[l+1];e[d+2]=+a[l+2]}return e}function m(a,b,c){a=c.split(a,2);if(1>=a.length)return"";a=a[1].split(b,2);return a[0]}function k(a){if(0===a.length)return new Float32Array([0,0,0]);var b=a.map(function(a){return a.coors.length}).reduce(function(a,b){return a+b});if(0===b)return new Float32Array([0,0,0]);for(var c=0,d=0,e=0,g=a.length,l=0;l<g;l++)for(var f=a[l].coors,k=f.length,m=0;m<k;m+=3)c+=f[m],d+=f[m+1],e+=f[m+2];a=b/3;return new Float32Array([c/a,
d/a,e/a])}Object.defineProperty(a,"__esModule",{value:!0});var q=void 0,b=/(^|-| )[0-9.]{1,8}/g,d=void 0,r=!1;"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&(r=!0);r&&(self.onmessage=function(a){var b=a.data.cmd;a=a.data.data;"start"===b&&(f(a),b="sendDataChunk");"sendDataChunk"===b&&(b=q.shift(),postMessage({chunk:b,status:0===q.length?"done":"more"}))});a.Ia=f});n("Mols/3DMol/VRML","require exports ../../Scene/Optimizations ../../Vars ../CommonLoader ./VRMLParserWebWorker".split(" "),
function(n,a,f,e,g,c){function m(a){console.log("MAIN: Msg from iframe:");console.log(a.data);switch(a.data){case "3DMolLoaded":v();v=void 0;break;case "addPDBTxtDone":t();t=void 0;break;case "exportVRMLDone":B=p.vrmlStr;u();u=void 0;break;case "addSurfaceDone":x(),x=void 0}}function k(a){console.log("MAIN: Msg to iframe:");console.log(a);p.postMessage(a,window.origin)}function q(a){k(["exportVRML",void 0]);u=a}function b(a){l=[];"undefined"!==typeof Worker?("undefined"===typeof z&&(z=new Worker("VRMLParserWebWorker.js")),
z.onmessage=function(b){b=b.data;var c=b.chunk;b=b.status;var d=c[0],e=c[1],g=c[2];l.length===d&&l.push({coors:new Float32Array(0),colors:new Float32Array(0),trisIdxs:new Uint32Array(0)});c=l[d];d=[l[d][e],g];for(var f=0,h=0;h<d.length;h++)g=d[h],f+=g.length;f=new ("trisIdxs"===e?Uint32Array:Float32Array)(f);for(var k=h=0;k<d.length;k++)g=d[k],f.set(g,h),h+=g.length;c[e]=f;switch(b){case "more":z.postMessage({cmd:"sendDataChunk",data:void 0});break;case "done":a();break;default:console.log("Error here!")}},
z.postMessage({cmd:"start",data:B})):(l=c.Ia(B),a())}function d(){var a=[],b;for(b in l)if(l.hasOwnProperty(b)){var c=l[b],d=[];BABYLON.VertexData.ComputeNormals(c.coors,c.trisIdxs,d);var f=new BABYLON.VertexData;f.positions=c.coors;f.indices=c.trisIdxs;f.normals=d;f.colors=c.colors;c=new BABYLON.Mesh("mesh_3dmol_tmp"+b,e.a);f.applyToMesh(c);f=new BABYLON.StandardMaterial("Material",e.a);f.diffuseColor=new BABYLON.Color3(1,1,1);f.emissiveColor=new BABYLON.Color3(0,0,0);f.specularColor=new BABYLON.Color3(0,
0,0);c.material=f;a.push(c)}if(0<a.length){var h=BABYLON.Mesh.MergeMeshes(a,!0,!0);h.name="MeshFrom3DMol"+Math.random().toString();h.id=h.name;g.Sa(h)}return h}function r(a,b){if(void 0!==a){a.scaling=new BABYLON.Vector3(1,1,1);a.position=new BABYLON.Vector3(0,0,0);e.a.render();if(void 0===h){var c=b.getBoundingInfo().boundingBox;b=Object.keys(c.maximumWorld).map(function(a){return c.maximumWorld[a]-c.minimumWorld[a]});var d=a.getBoundingInfo().boundingBox,g=Object.keys(d.maximumWorld).map(function(a){return d.maximumWorld[a]-
d.minimumWorld[a]});b=b.map(function(a,b){return a/g[b]});b=Math.min.apply(null,b);h=new BABYLON.Vector3(b,b,b);a.scaling=h;e.a.render();w=d.centerWorld.subtract(c.centerWorld);a.position=a.position.subtract(w)}else a.scaling=h,a.position=a.position.subtract(w);f.H()}}Object.defineProperty(a,"__esModule",{value:!0});var l=[],h=void 0,w=void 0,p=void 0,v,t,u,x,B,z;a.c=function(a){v=a;window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m);jQuery("body").append('<iframe\n        id="mol-container"\n        class="mol-container"\n        src="3dmol.html"\n        style="width:150px; height:150px; z-index:150; position:fixed; top:0; left:0;"></iframe>');
p=document.getElementById("mol-container").contentWindow};a.Oa=function(){p.resetAll()};a.Ha=function(a){t=a;jQuery.ajax("https://files.rcsb.org/view/1XDN.pdb",{success:function(a){k(["addPDBTxt",a])},error:function(a,b,c){console.error("Failed to load PDB https://files.rcsb.org/view/1XDN.pdb: "+c)}})};a.setStyle=function(a,b){k(["setStyle",{sels:a,rep:b}])};a.addSurface=function(a,b,c){x=c;k(["addSurface",{colorScheme:a,sels:b}])};a.removeAllSurfaces=function(){k(["removeAllSurfaces",void 0])};a.render=
function(a,c){void 0===a&&(a=!0);void 0===c&&(c=function(){});e.l.hideLoadingUI();a&&q(function(){b(function(){var a=d();r(a,e.a.getMeshByName("protein_box"));c(a);l=[]})})};a.bb=d;a.eb=r});n("Mols/3DMol/Visualize",["require","exports","../../Scene/Optimizations","./VRML"],function(n,a,f,e){function g(a,b){e.render(!0,function(c){for(var d in k)if(k.hasOwnProperty(d)){var e=k[d];e.A===a.A&&(f.Na(e.mesh),delete k[d],console.log("deleting old mesh..."))}"Surface"===b&&(c.material.backFaceCulling=!1);
k[a.U]={A:a.A,mesh:c};console.log("added new mesh")})}function c(a,b,c){a.sort();return{A:a.join("-")+"-"+b,U:a.join("-")+"-"+b+"-"+c}}function m(a){var b=a.map(function(a){return a}),c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(d.toUpperCase());b.push(d.toLowerCase())}return b=b.filter(function(a,c){return b.indexOf(a)>=c})}Object.defineProperty(a,"__esModule",{value:!0});var k={},q={All:{},Protein:{resn:m("ALA ARG ASP ASN ASX CYS GLN GLU GLX GLY HIS HSP HYP ILE LEU LYS MET PCA PHE PRO TRP TYR VAL GLU SER THR MSE".split(" "))},
Acidic:{resn:m(["ASP","GLU"])},Cyclic:{resn:m(["HIS","PHE","PRO","TRP","TYR"])},Aliphatic:{resn:m(["ALA","GLY","ILE","LEU","VAL"])},Aromatic:{resn:m(["HIS","PHE","TRP","TYR"])},Basic:{resn:m(["ARG","HIS","LYS","HSP"])},Charged:{resn:m("ASP GLU ARG HIS LYS HSP".split(" "))},Hydrophobic:{resn:m("ALA LEU VAL ILE PRO PHE MET TRP".split(" "))},Neutral:{resn:m("VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP".split(" "))},Nucleic:{resn:m("ADE A GUA G CYT C THY T URA U".split(" "))},Purine:{resn:m(["ADE",
"A","GUA","G"])},Pyrimidine:{resn:m("CYT C THY T URA U".split(" "))},Ions:{resn:m("AL BA CA CAL CD CES CLA CL CO CS CU CU1 CUA HG IN IOD K MG MN3 MO3 MO4 MO5 MO6 NA NAW OC7 PB POT PT RB SOD TB TL WO4 YB ZN ZN1 ZN2".split(" "))},Water:{resn:m(["WAT","HOH","TIP","TIP3"])}};q.Ligand={not:{or:[q.Protein,q.Nucleic,q.Ions,q.Water]}};var b={Element:{colorscheme:"default"},Red:{color:"red"},Blue:{color:"blue"},Green:{color:"green"},Orange:{color:"orange"},Yellow:{color:"yellow"},Purple:{color:"purple"},Spectrum:{color:"spectrum"}};
a.Ya=function(a,f,l){var d=c(a,f,l);if("Hide"===l)for(var m in k)k.hasOwnProperty(m)&&(a=k[m],a.A===d.A&&(a.mesh.isVisible=!1,console.log("Hiding existing mesh...")));else void 0!==k[d.U]?(k[d.U].mesh.isVisible=!0,console.log("showing existing mesh...")):(e.Oa(),m=b[l],a={and:a.map(function(a){return q[a]})},"surface"===f.toLowerCase()?e.addSurface(m,a,function(){g(d,f)}):(l={},l[f.toLowerCase()]=m,e.setStyle(a,l),g(d,f)))}});n("UI/Menu3D","require exports ../Cameras/CommonCamera ../Mols/3DMol/Visualize ../Navigation/Pickables ../Navigation/Points ../Vars".split(" "),
function(n,a,f,e,g,c,m){function k(){function a(a){if(c.hasOwnProperty(a)){p[a]=new BABYLON.GUI.SpherePanel;w.addControl(p[a]);p[a].blockLayout=!0;c[a].reverse();var b=function(b){if(c[a].hasOwnProperty(b)){b=c[a][b];var d=b.C,e=b.O;h.push(new D({u:function(){e()},default:!1,N:d,ja:function(a){a.isVisible(!1)},level:+a,name:"menu-visible-button-"+d,na:p[a],P:d,color:b.color}));p[a].columns=4;window.panels=p;p[a].blockLayout=!1;p[a].linkToTransformNode(v);setInterval(function(){p[a].radius=m.sa;p[a].margin=
m.ra},1E3)}},d;for(d in c[a])b(d)}}var c=q();c=b(c);v=new BABYLON.TransformNode("");w=new BABYLON.GUI.GUI3DManager(m.a);for(var d in c)a(d)}function q(){function a(e,f,g){function h(d){if(l.hasOwnProperty(d)){d=l[d];var h=e[d];c[f]=void 0===c[f]?[]:c[f];switch(typeof h){case "function":c[f].push({O:h,C:d,D:g});break;case "object":var k=b(f+1);c[f].push({color:x,O:function(){r(k)},C:d+" \u21e8",D:g});a(h,k,f);break;default:alert("error!")}}}d.push(f);var l=Object.keys(e),k;for(k in l)h(k)}function b(a){for(;-1!==
d.indexOf(a);)a++;return a}var c={},d=[];a(l,1,void 0);return c}function b(a){function b(b){if(a.hasOwnProperty(b)){a[b].sort(function(a,b){return(""+a.C).localeCompare(b.C)});var c=+b;1<c&&a[b].push({color:B,O:function(){r(a[b][0].D)},C:"Back \u21e6",D:a[b][0].D});0<c&&a[b].push({color:z,O:function(){u.Y()},C:"Close Menu \u00d7",D:a[b][0].D})}}for(var c in a)b(c);console.log(a);return a}function d(){var a=new BABYLON.GUI.StackPanel3D;w.addControl(a);u=new D({u:function(a){a.value?r(1):r(0);v.position.copyFrom(f.m());
v.rotation.y=f.ha()},default:!1,N:"Show Menu",level:0,name:"menu-visible-button",na:a,P:"Hide Menu"});var b=new BABYLON.TransformNode("");a.linkToTransformNode(b);b.rotation.x=.5*Math.PI;m.a.registerBeforeRender(function(){b.position.copyFrom(c.V);b.position.y+=.1;b.rotation.y=f.ha()})}function r(a){for(var b in h)if(h.hasOwnProperty(b)){var c=h[b];0===c.level?c.isVisible(!0):c.level===a?c.isVisible(!0):c.isVisible(!1)}}Object.defineProperty(a,"__esModule",{value:!0});var l=function(){function a(a){if(b.hasOwnProperty(a)){var d=
b[a];h[d]={};a=function(a){if(c[d].hasOwnProperty(a)){var b=c[d][a];h[d][b]={};a=function(a){if(f[d].hasOwnProperty(a)){var c=f[d][a];h[d][b][c]={};a=function(a){if(g.hasOwnProperty(a)){var f=g[a];h[d][b][c][f]=function(){e.Ya([d,b],c,f);u.Y()}}};for(var k in g)a(k)}};for(var k in f[d])a(k)}};for(var k in c[d])a(k)}}var b=["Protein","Ligand","Water","Nucleic"],c={Ligand:["All"],Nucleic:["All"],Protein:["All","Hydrophobic","Hydrophilic","Charged","Aromatic"],Water:["All"]},d=["Stick","Sphere","Surface"],
f={Ligand:d,Nucleic:d,Protein:["Cartoon"].concat(d),Water:d},g="Element Red Blue Green Orange Yellow Purple Spectrum Hide".split(" "),h={},k;for(k in b)a(k);return h}(),h=[],w,p={},v,t,u,x=new BABYLON.Color3(.3,.35+.1,.4),B=new BABYLON.Color3(.4,.35+.1,.4),z=new BABYLON.Color3(.4,.35,.4);a.c=function(a){k(a);d();t=new BABYLON.Sound("click-button","assets/staple-public-domain.mp3",m.a,null,{loop:!1,autoplay:!1,ib:!0,volume:.1})};var D=function(){function a(a){var b=this;this.button=new BABYLON.GUI.HolographicButton(a.name);
a.na.addControl(this.button);if(void 0!==a.color){var c=this.button.mesh.material.clone();c.albedoColor=a.color;this.button.mesh.material=c}this.level=a.level;this.w=new BABYLON.GUI.TextBlock;this.w.color="white";this.w.i=!0;this.value=a.default;this.P=a.P;this.N=a.N;this.u=a.u;this.da();this.i=BABYLON.Mesh.CreateSphere(a.name+"-container-mesh",2,m.R,m.a);this.i.position=this.button.node.absolutePosition;this.i.visibility=0;this.i.u=function(){b.Y()};g.xa(this.i);void 0!==a.ja&&a.ja(this)}a.prototype.isVisible=
function(a){if(void 0===a)return this.button.isVisible;this.button.isVisible=a;this.i.isVisible=a};a.prototype.Y=function(){t.setPosition(this.i.position.clone());t.play();this.value=!this.value;this.u(this);this.da()};a.prototype.da=function(){this.w.text=this.value?this.P:this.N;this.button.content.dispose();this.button.content=this.w};return a}()});n("Mols/3DMol/ThreeDMol",["require","exports","../CommonLoader","./VRML"],function(n,a,f,e){function g(a){e.c(function(){e.Ha(function(){e.setStyle({},
{cartoon:{color:"spectrum"}});e.render(!0,function(){f.za(a)})})})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(a){g(a)}});n("Mols/Load","require exports ../Scene/Optimizations ../UI/Menu3D ../Vars ./3DMol/ThreeDMol ./CommonLoader".split(" "),function(n,a,f,e,g,c,m){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){m.Aa();jQuery.getJSON("scene_info.json",function(a){!1===a.menuActive&&(g.b.la=!1);c.c(a);g.b.la&&e.c(a);f.H()})}});n("UI/LoadingScreens",["require","exports",
"../Vars"],function(n,a,f){function e(){clearInterval(g)}Object.defineProperty(a,"__esModule",{value:!0});var g;a.Ma=function(){document.getElementById("loading-container").outerHTML=""};a.ca=function(a){e();f.l.displayLoadingUI();f.l.loadingUIText=a};a.Wa=function(){var a=90;clearInterval(g);g=setInterval(function(){a+=.02*(99-a);f.l.displayLoadingUI();f.l.loadingUIText="Loading the main scene... "+a.toFixed(0)+"%"},100)};a.Xa=e});n("UI/UI2D",["require","exports","../Vars"],function(n,a,f){function e(){jQuery("body").append('\n        <button\n          title="Click to switch to full screen"\n          id="fullscreen-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:80px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n            <svg\n              style="position:relative; left:0.5px;"\n              width="48" height="48"\n              xmlns="http://www.w3.org/2000/svg"\n              xmlns:svg="http://www.w3.org/2000/svg"\n              clip-rule="evenodd">\n                <g class="layer">\n                    <path d="m47.799999,43.649999l-47.699999,0l0,-39.749999l47.699999,0l0,39.749999zm-1.9875,-37.762499l-43.724999,0l0,35.774999l43.724999,0l0,-35.774999zm-7.95,13.9125l-1.9875,0l0,-6.441487l-22.341487,22.341487l6.441487,0l0,1.9875l-9.9375,0l0,-9.9375l1.9875,0l0,6.441487l22.341487,-22.341487l-6.441487,0l0,-1.9875l9.9375,0l0,9.9375z" fill="#ffffff" id="svg_1"/>\n                </g>\n            </svg>\n        </button>\n\n        <button\n          title="Click for help"\n          id="help-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:140px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n                 <svg version="1.2" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" xml:space="preserve">\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="\n\tM35.5,9.8c1.7,5.4-0.6,8-1.6,8.9c-1.9,1.9-4.5,4.7-5.8,7c-1.5,2.7-4.1,12-6.8,4.4c-3.2-9.1,1.3-11.6,3.5-13.4\n\tc1.5-1.3,3.4-4.3,0.5-5.3c-4-1.3-6.1,5.3-10.7,4c-3-0.8-3.2-4.1-2.2-6.6C15.4,1.7,32.5,0.6,35.5,9.8L35.5,9.8z"/>\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" d="M28.3,39.6c0-5.5-8.5-5.5-8.5,0S28.3,45.1,28.3,39.6\n\t"/>\n</svg>\n\n        </button>\n    ');
jQuery("#fullscreen-button").click(function(){f.l.switchFullscreen(!0);jQuery("#renderCanvas").focus()});jQuery("#help-button").click(function(){window.open("help/index.html","_blank")});document.getElementById("babylonVRiconbtn").style.opacity="1.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=1.0)"}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){e()};window.debugMode=function(){f.a.debugLayer.show();setTimeout(function(){document.getElementById("inspector-host").style.zIndex=
"15";document.getElementById("scene-explorer-host").style.zIndex="15"},500)}});n("Scene/LoadAndSetup","require exports ../Cameras/Setup ../Cameras/VRCamera ../Mols/Load ../Navigation/Navigation ../Navigation/Pickables ../UI/LoadingScreens ../UI/UI2D ../Vars ./Optimizations".split(" "),function(n,a,f,e,g,c,m,k,q,b,d){function r(){var a=BABYLON.Mesh.CreateSphere("navTargetMesh",4,.1,b.a),c=new BABYLON.StandardMaterial("myMaterial",b.a);c.diffuseColor=new BABYLON.Color3(1,0,1);a.material=c;b.Va({ia:"ground",
ma:a});e.c();d.c();window.i=b}function l(a){k.ca("Loading the main scene...");BABYLON.SceneLoader.LoadAssetContainer("scene/","scene.babylon",b.a,function(c){k.Wa();b.a.executeWhenReady(function(){c.addAllToScene();b.a.activeCamera=b.a.cameras[0];for(var e=!1,f=0;1<b.a.lights.length;){var g=b.a.lights[f].name.toLowerCase();-1===g.indexOf("shadowlight")&&-1===g.indexOf("shadow_light")?b.a.lights[f].dispose():e?b.a.lights[f].dispose():(e=!0,f++)}for(var k in b.a.meshes)"protein_box"===b.a.meshes[k].name&&
(b.a.getMeshByName("protein_box").isVisible=!1);for(var h in b.a.meshes)if(b.a.meshes[h].material){e=b.a.meshes[h];if(void 0===e.material.emissiveTexture||null===e.material.emissiveTexture)e.material.emissiveTexture=e.material.diffuseTexture,e.material.diffuseColor=new BABYLON.Color3(0,0,0),e.material.specularColor=new BABYLON.Color3(0,0,0),e.material.emissiveColor=new BABYLON.Color3(0,0,0);d.ga(e,!1);m.ka({mesh:e,a:b.a})}a()})},function(a){a.lengthComputable&&k.ca("ALoading the main scene... "+Math.round(90*
a.loaded/a.total).toString()+"%")})}Object.defineProperty(a,"__esModule",{value:!0});a.load=function(){b.c();k.Ma();r();l(function(){f.c();c.c();m.c();q.c();g.c()});window.addEventListener("resize",function(){b.l.resize()})};a.Ja=function(){setTimeout(d.H,1E3);k.Xa();b.a.activeCamera.maxZ=250;b.a.activeCamera.minZ=0;b.l.runRenderLoop(function(){b.a.render()})}});t.L({urlArgs:"bust="+(new Date).getTime()});t(["Scene/LoadAndSetup"],function(n){n.load()});n("Start",function(){})})();
