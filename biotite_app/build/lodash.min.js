/*
 almond 0.3.3 Copyright jQuery Foundation and other contributors.
 Released under MIT license, http://github.com/requirejs/almond/LICENSE
*/
var E="function"==typeof Object.defineProperties?Object.defineProperty:function(v,u,q){v!=Array.prototype&&v!=Object.prototype&&(v[u]=q.value)},F="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function G(v){if(v){for(var u=F,q=["Math","sign"],t=0;t<q.length-1;t++){var a=q[t];a in u||(u[a]={});u=u[a]}q=q[q.length-1];t=u[q];v=v(t);v!=t&&null!=v&&E(u,q,{configurable:!0,writable:!0,value:v})}}
G(function(v){return v?v:function(u){u=Number(u);return 0===u||isNaN(u)?u:0<u?1:-1}});
(function(){var v,u,q;(function(t){function a(a,c){var A,b;c=c&&c.split("/");var e=n.map,d=e&&e["*"]||{};if(a){a=a.split("/");var g=a.length-1;n.eb&&l.test(a[g])&&(a[g]=a[g].replace(l,""));"."===a[0].charAt(0)&&c&&(g=c.slice(0,c.length-1),a=g.concat(a));for(g=0;g<a.length;g++){var r=a[g];"."===r?(a.splice(g,1),--g):".."===r&&0!==g&&(1!==g||".."!==a[2])&&".."!==a[g-1]&&0<g&&(a.splice(g-1,2),g-=2)}a=a.join("/")}if((c||d)&&e){r=a.split("/");for(g=r.length;0<g;--g){var y=r.slice(0,g).join("/");if(c)for(b=
c.length;0<b;--b)if(A=e[c.slice(0,b).join("/")])if(A=A[y]){var h=A;var m=g;break}if(h)break;if(!f&&d&&d[y]){var f=d[y];var w=g}}!h&&f&&(h=f,m=w);h&&(r.splice(0,m,h),a=r.join("/"))}return a}function f(a,c){return function(){var g=w.call(arguments,0);"string"!==typeof g[0]&&1===g.length&&g.push(null);return p.apply(t,g.concat([a,c]))}}function e(c){return function(g){return a(g,c)}}function h(a){return function(c){d[a]=c}}function b(a){if(g.call(c,a)){var b=c[a];delete c[a];r[a]=!0;B.apply(t,b)}if(!g.call(d,
a)&&!g.call(r,a))throw Error("No "+a);return d[a]}function k(a){var c=a?a.indexOf("!"):-1;if(-1<c){var g=a.substring(0,c);a=a.substring(c+1,a.length)}return[g,a]}function m(a){return function(){return n&&n.M&&n.M[a]||{}}}var p,d={},c={},n={},r={},g=Object.prototype.hasOwnProperty,w=[].slice,l=/\.js$/;var C=function(c,g){c=k(c);var d=c[0];g=g[1];c=c[1];if(d){d=a(d,g);var n=b(d)}d?n&&n.normalize?c=n.normalize(c,e(g)):c=a(c,g):(c=a(c,g),c=k(c),d=c[0],c=c[1],d&&(n=b(d)));return{ga:d?d+"!"+c:c,n:c,gb:d,
p:n}};var x={require:function(a){return f(a)},G:function(a){var c=d[a];return"undefined"!==typeof c?c:d[a]={}},Ma:function(a){return{id:a,uri:"",G:d[a],M:m(a)}}};var B=function(a,n,e,l){var m,w=[];var p=typeof e;var y=(l=l||a)?k(l):[];if("undefined"===p||"function"===p){n=!n.length&&e.length?["require","exports","module"]:n;for(m=0;m<n.length;m+=1){var z=C(n[m],y);p=z.ga;if("require"===p)w[m]=x.require(a);else if("exports"===p){w[m]=x.G(a);var A=!0}else if("module"===p)var B=w[m]=x.Ma(a);else if(g.call(d,
p)||g.call(c,p)||g.call(r,p))w[m]=b(p);else if(z.p)z.p.load(z.n,f(l,!0),h(p),{}),w[m]=d[p];else throw Error(a+" missing "+p);}n=e?e.apply(d[a],w):void 0;a&&(B&&B.G!==t&&B.G!==d[a]?d[a]=B.G:n===t&&A||(d[a]=n))}else a&&(d[a]=e)};v=u=p=function(a,c,g,d,e){if("string"===typeof a)return x[a]?x[a](c):b(C(a,c?k(c):[]).ga);if(!a.splice){n=a;n.Ca&&p(n.Ca,n.ab);if(!c)return;c.splice?(a=c,c=g,g=null):a=t}c=c||function(){};"function"===typeof g&&(g=d,d=e);d?B(t,a,c,g):setTimeout(function(){B(t,a,c,g)},4);return p};
p.M=function(a){return p(a)};v.i=d;q=function(a,n,b){if("string"!==typeof a)throw Error("See almond README: incorrect module build, no module name");n.splice||(b=n,n=[]);g.call(d,a)||g.call(c,a)||(c[a]=[a,n,b])};q.i={jQuery:!0}})();q("external/almond",function(){});q("Vars",["require","exports"],function(t,a){Object.defineProperty(a,"__esModule",{value:!0});a.ba=11;a.T=1.5;a.aa=1;a.ra=2E3;a.S=1.2;a.ta=2.5;a.sa=.1;a.ua=.01;a.xa=500;a.wa=750;a.J=.1;a.$=15;a.va=.05;a.qa=/iPad|iPhone|iPod/.test(navigator.userAgent)&&
!window.MSStream;a.c=function(){a.canvas=document.getElementById("renderCanvas");a.l=new BABYLON.Engine(a.canvas,!0);BABYLON.Database.IDBStorageEnabled=!0;a.a=new BABYLON.Scene(a.l);window.scene=a.a};a.Da=function(){if(void 0===a.L){var f=new BABYLON.Ray(a.a.activeCamera.position,new BABYLON.Vector3(0,-1,0),50);f=a.a.pickWithRay(f,function(a){return"ground"===a.name});a.L=f.distance}};a.Ra=function(f){a.L=f};a.Wa=function(f){var e={createDeviceOrientationCamera:!0};a.a.getEngine().getCaps().multiview&&
(e.useMultiview=!0);a.f=a.a.createDefaultVRExperience(e);document.getElementById("babylonVRiconbtn").style.opacity="0.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=0)";window.vrHelper=a.f;a.b=f;a.b.ma=!0}});q("Cameras/NonVRCamera",["require","exports","../Vars"],function(t,a,f){function e(){h.ellipsoid=new BABYLON.Vector3(1,.5*f.L,1)}Object.defineProperty(a,"__esModule",{value:!0});var h;new BABYLON.Vector3(0,0,0);a.c=function(){h=f.a.activeCamera;h.keysUp=[87,38];h.keysDown=
[83,40];h.keysLeft=[65,37];h.keysRight=[68,39];e();f.a.collisionsEnabled=!0;h.checkCollisions=!0;h.speed=.1;h.attachControl(f.canvas,!0);h._updatePosition()};a.Qa=e});q("Cameras/Setup",["require","exports","../Vars","./NonVRCamera"],function(t,a,f,e){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){a.U=f.a.cameras.filter(function(a){return-1===a.name.indexOf("VR")})[0];var h=new BABYLON.DeviceOrientationCamera("DevOr_camera",a.U.position.clone(),f.a,!0);h.rotation=a.U.rotation;f.a.activeCamera=
h;f.a.activeCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a.U.rotation);f.Da();e.c()}});q("Navigation/Points",["require","exports","../Cameras/CommonCamera","../Vars","./Pickables"],function(t,a,f,e,h){function b(d){a.h.copyFrom(d)}function k(){if(3===e.b.g)var d=e.a.activeCamera.getForwardRay();else if(2===e.b.g||1===e.b.g){d=void 0;1===e.b.g?(d=e.f.rightControllerGazeTrackerMesh,d||(d=e.f.leftControllerGazeTrackerMesh)):2===e.b.g&&(d=e.f.gazeTrackerMesh);if(!d){console.log("error!");
return}d.isVisible?b(d.absolutePosition):b(a.H);d=f.m();d=new BABYLON.Ray(d,a.h.subtract(d))}else console.log("Unexpected error.");m(d)}function m(d,c){void 0===c&&(c=!0);d=e.a.pickWithRay(d,function(a){return h.fa(a)});d.hit&&d.distance<e.$?(c&&b(d.pickedPoint),h.C(d.pickedMesh)):(b(a.H),h.C(void 0))}function p(a){a=new BABYLON.Ray(a,new BABYLON.Vector3(0,-1,0),50);return e.a.pickWithRay(a,function(a){return a.id===e.b.j.id})}Object.defineProperty(a,"__esModule",{value:!0});a.H=new BABYLON.Vector3(-1E3,
1E3,1E3);a.W=new BABYLON.Vector3(0,0,0);a.X=new BABYLON.Vector3(0,0,0);a.h=new BABYLON.Vector3(0,0,0);a.hb=b;a.c=function(){e.a.registerBeforeRender(function(){k();void 0===a.h?(b(a.H),h.C(void 0)):10<BABYLON.Vector3.Distance(f.m(),a.h)&&(b(a.H),h.C(void 0));e.b.na.position.copyFrom(a.h);void 0!==h.u&&(e.b.na.isVisible=h.u!==h.w);var d=p(f.m()).pickedPoint;d&&(a.W=d);if(d=p(a.h).pickedPoint)a.X=d})};a.ib=k;a.Ha=p});q("Cameras/CommonCamera",["require","exports","../Navigation/Points","../Vars"],function(t,
a,f,e){function h(){if(3===e.b.g)return new BABYLON.Vector3(0,0,0);var a=e.f.webVRCamera,b;a.leftCamera?b=a.leftCamera.globalPosition.subtract(a.position):b=new BABYLON.Vector3(0,0,0);return b}Object.defineProperty(a,"__esModule",{value:!0});var b=new BABYLON.Vector3(1,0,0),k=new BABYLON.Vector3(1,0,0);a.m=function(){var a=e.a.activeCamera,b=a.position.clone();if(2===e.b.g||1===e.b.g)a.leftCamera?b.copyFrom(a.leftCamera.globalPosition):console.log("Prob here");return b};a.pa=function(a){if(3===e.b.g){var b=
e.a.activeCamera;b.position.copyFrom(a)}else if(2===e.b.g||1===e.b.g)b=e.f.webVRCamera,b.position.copyFrom(a.subtract(h()))};a.ia=function(){if(2===e.b.g||1===e.b.g){var a=f.X.subtract(f.W),h=BABYLON.Vector3.GetAngleBetweenVectors(a,b,k);for(0>a.z&&(h=-h);0>h;)h+=2*Math.PI;for(;h>2*Math.PI;)h-=2*Math.PI;return h+=.5*Math.PI}return e.a.activeCamera.rotation.clone().y};a.Ga=h});q("Mols/Shadows",["require","exports","../Vars"],function(t,a,f){function e(){var a=f.a.lights[0],b=64,e=.9625,m=a.name.match(/blur_([0-9\.]+)/g);
null!==m&&(b=parseFloat(m[0].substr(5)));a=a.name.match(/dark_([0-9\.]+)/g);null!==a&&(e=parseFloat(a[0].substr(5)));return{blur:b,N:e}}Object.defineProperty(a,"__esModule",{value:!0});a.Va=function(){var h=f.a.lights[0],b=e();b.$a=0;b.blur=2;console.log(b);f.qa?console.log("iOS, so not generating shadows... causes an error... See https://forum.babylonjs.com/t/issues-between-shadowgenerator-and-ios-osx/795"):(a.o=new BABYLON.ShadowGenerator(4096,h),a.o.useBlurExponentialShadowMap=!0,a.o.setDarkness(b.N),
a.o.A=!0,a.o.i=b.blur,window.o=a.o)};a.Ea=e;a.Ua=function(){for(var a in f.a.meshes)if(f.a.meshes.hasOwnProperty(a)){var b=f.a.meshes[a];if(-1!==b.name.toLowerCase().indexOf("shadowcatcher")||-1!==b.name.toLowerCase().indexOf("shadow_catcher"))b.material=new BABYLON.ShadowOnlyMaterial("shadow_catch"+a.toString(),f.a),b.material.activeLight=f.a.lights[0],b.receiveShadows=!0}}});q("Scene/Optimizations",["require","exports","../Mols/Shadows","../Vars"],function(t,a,f,e){function h(a){if(void 0!==a){a=
a.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(null===a)return null;a=a.length/3}else a=0;return a}function b(){var a=new BABYLON.SceneOptimizerOptions(25,2E3),b=0;a.optimizations.push(new BABYLON.ShadowsOptimization(b));a.optimizations.push(new BABYLON.LensFlaresOptimization(b));a.optimizations.push(new BABYLON.PostProcessesOptimization(b));a.optimizations.push(new BABYLON.ParticlesOptimization(b));a.optimizations.push(new m(b));b++;a.optimizations.push(new p(b));a.optimizations.push(new m(b));
b++;a.optimizations.push(new BABYLON.TextureOptimization(b,512));a.optimizations.push(new m(b));b++;a.optimizations.push(new BABYLON.RenderTargetsOptimization(b));a.optimizations.push(new BABYLON.TextureOptimization(b,256));a.optimizations.push(new m(b));b++;a.optimizations.push(new BABYLON.HardwareScalingOptimization(b,4));a.optimizations.push(new d(b,500));a.optimizations.push(new m(b));return a}function k(a){null!==a&&a.dispose()}function m(a){var c=this;"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){console.log("Optimization priority:",c.priority);console.log("FPS:",e.l.getFps());console.log("");return!0};this.getDescription=function(){return"Reports the current priority. For debugging."}}function p(a){"undefined"===typeof a&&(a=0);this.priority=a;this.apply=function(){var a=e.a.getMeshByName("surfaces.wrl");k(a);return!0};this.getDescription=function(){return"Removes surface representations."}}function d(a,b,d){void 0===d&&(d=void 0);"undefined"===typeof a&&(a=0);this.priority=
a;this.apply=function(){var a=[],c;for(c in e.a.meshes)if(e.a.meshes.hasOwnProperty(c)){var l=e.a.meshes[c];if(-1===l.name.indexOf("Decimated")){var r=h(l);null!==r&&(r<b||a.push([r,l,void 0===d?1-b/r:d]))}}a.sort(function(a,c){return c[0]-a[0]});for(c in a)if(a.hasOwnProperty(c)){l=a[c][1];for(r=a[c][2];0<l.getLODLevels().length;){var n=l.getLODLevels()[0].mesh;l.removeLODLevel(n);k(n)}l.simplify([{quality:r,distance:.001}],!1,BABYLON.SimplificationType.QUADRATIC,function(){})}return!0};this.getDescription=
function(){return"Simplifies the geometry of complex objects in the scene."}}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){BABYLON.SceneOptimizer.OptimizeAsync(e.a,b());e.a.autoClear=!1;e.a.autoClearDepthAndStencil=!1;for(var a in e.a.meshes)if(e.a.meshes.hasOwnProperty(a)){var d=e.a.meshes[a];-1!==d.name.indexOf("baked")&&void 0!==d.material&&(d.material.diffuseColor=new BABYLON.Color3(0,0,0),d.material.specularColor=new BABYLON.Color3(0,0,0),d.material.emissiveTexture=d.material.diffuseTexture,
d.material.diffuseTexture=null,d.freezeWorldMatrix())}};a.Y=function(a){var c=h(a);null===c||100>c||(c=1+Math.floor(c/e.ra),1<c&&a.subdivide(c))};a.ha=function(a,b){void 0===b&&(b=!0);b&&a.material.freeze()};a.I=function(){f.o&&(e.a.lights[0].autoUpdateExtends=!0,f.o.getShadowMap().refreshRate=BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE,e.a.lights[0].autoUpdateExtends=!1)};a.Oa=k});q("Navigation/Navigation","require exports ../Cameras/CommonCamera ../Cameras/NonVRCamera ../Scene/Optimizations ../Vars ./Pickables ./Points".split(" "),
function(t,a,f,e,h,b,k,m){function p(){w=f.m();b.a.registerBeforeRender(function(){var a=f.m();null===m.Ha(a).pickedMesh?f.pa(w):w=a})}function d(){jQuery("body").keypress(function(a){32===a.charCode&&c()})}function c(){var a=(new Date).getTime();if(!(250>a-l))switch(l=a,console.log("hi"),k.Fa()){case 2:console.log("teleport");n();break;case 4:r();break;case 3:k.u.v()}}function n(a,c){void 0===a&&(a=void 0);void 0===c&&(c=void 0);void 0===c&&(c=function(){});b.f.gazeTrackerMesh.isVisible=!1;var g=
new BABYLON.Animation("animationCameraTeleportation","position",90,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),d=f.m();void 0===a&&(a=new BABYLON.Vector3(m.h.x,m.h.y+b.L,m.h.z));var e=f.Ga();a=a.subtract(e);d=d.subtract(e);g.setKeys([{frame:0,value:d},{frame:b.ba,value:a}]);var l=b.a.activeCamera;l.animations=[];l.animations.push(g);b.a.beginAnimation(l,0,b.ba,!1,1,function(){b.f.gazeTrackerMesh.isVisible=!0;l.animations=[];c()})}function r(){var a=m.X,c=
f.m(),g=m.h.subtract(c),d=g.length(),l;.1*d<b.aa?l=m.h.subtract(g.normalize().scale(b.aa)):.1*d>b.T?l=m.h.subtract(g.normalize().scale(b.T)):.1*d<b.T&&(l=c.add(g.scale(.9)));l.y=m.h.y;l.y-a.y<.5*b.S+.1&&(l.y=a.y+.5*b.S+.1);b.Ra(m.h.y-a.y);n(l,function(){e.Qa()})}function g(){C=jQuery("#capture-clicks");C.click(function(){console.log("clicked!");c()});b.a.registerBeforeRender(function(){var a=b.a.activeCamera.inputs.attached.deviceOrientation;(a=a?0!==a._alpha||0!==a._beta||0!==a._gamma:!1)&&!x?(x=
!0,C.show()):!a&&x&&(x=!1,C.bb())})}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){b.b.j=b.a.getMeshByID(b.b.ja);null===b.b.j&&alert("No mesh named "+b.b.ja);b.b.j.checkCollisions=!0;b.b.j.visibility=0;h.Y(b.b.j);k.la({K:c,mesh:b.b.j});b.b.g=3;d();m.c();g();p()};var w,l=0;a.ca=c;var C=void 0,x=!1});q("Navigation/Pickables","require exports ../Cameras/CommonCamera ../Scene/Optimizations ../Vars ./Navigation".split(" "),function(t,a,f,e,h,b){function k(a){void 0===a.K&&(a.K=b.ca);void 0===
a.a&&(a.a=h.a);void 0!==a.mesh&&(a.mesh.actionManager=new BABYLON.ActionManager(a.a),a.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(){3===h.b.g&&a.K()})))}Object.defineProperty(a,"__esModule",{value:!0});var m=[],p=[],d=[];a.C=function(c){a.u=c};a.c=function(){m.push(h.b.j)};a.ya=function(a){m.push(a);p.push(a);e.Y(a);k({mesh:a,K:function(){a.v()}})};a.za=function(a){m.push(a);d.push(a);e.Y(a);k({mesh:a})};a.fa=function(a){return a.id===
h.b.j.id?!0:a.isVisible?-1!==m.indexOf(a):!1};a.Fa=function(){return void 0===a.u?1:a.u===h.b.j?2:-1!==p.indexOf(a.u)?3:-1!==d.indexOf(a.u)?4:a.u===a.w?5:1};a.la=k;a.La=function(){a.w=BABYLON.Mesh.CreateSphere("padNavSphereAroundCamera",4,h.$-1,h.a);a.w.flipFaces(!0);var b=new BABYLON.StandardMaterial("padNavSphereAroundCameraMat",h.a);b.diffuseColor=new BABYLON.Color3(1,1,1);b.specularColor=new BABYLON.Color3(0,0,0);b.i=null;a.w.material=b;a.w.visibility=0;h.a.registerBeforeRender(function(){a.w.position=
f.m()});m.push(a.w)}});q("Cameras/VRControllers","require exports ../Navigation/Navigation ../Navigation/Pickables ../Navigation/Points ../Vars ./CommonCamera ./VRCamera".split(" "),function(t,a,f,e,h,b,k,m){function p(a){a.onTriggerStateChangedObservable.add(function(a){a.pressed&&(a=(new Date).getTime(),a-c>b.xa&&(c=a,f.ca()))})}function d(a){a.onPadStateChangedObservable.add(function(a){(w=a.pressed)&&Math.abs(r)<b.J&&Math.abs(g)<b.J&&console.log("Would reset camera view if you didn't get an error below...")});
a.onPadValuesChangedObservable.add(function(a){r=a.y;g=a.x;Math.abs(g)<b.J&&Math.abs(r)<b.J?g=r=0:.5>Math.abs(g)?g=0:(g+=0<g?-.5:.5,g=2*g)});b.a.registerBeforeRender(function(){if(w){if(!h.h.equals(h.H)){var a=k.m(),c=h.h.subtract(a);c.normalize();c=c.scale(r*b.ua*b.a.getAnimationRatio());k.pa(a.subtract(c))}0!==g&&(a=(new Date).getTime(),a-n<b.wa||(n=a,a=b.f.webVRCamera.rotationQuaternion.toEulerAngles(),a.y+=.25*Math.sign(g)*Math.PI,b.f.webVRCamera.rotationQuaternion=BABYLON.Quaternion.FromEulerVector(a)))}})}
Object.defineProperty(a,"__esModule",{value:!0});var c=0,n=0,r=0,g=0,w=!1;a.c=function(){e.La();b.f.webVRCamera.onControllerMeshLoadedObservable.add(function(a){b.b.g=1;console.log("controller loaded");m.Sa();console.log("Isnt there on pickable or something");p(a);d(a)})}});q("Cameras/VRCamera","require exports ../Navigation/Pickables ../Scene/Optimizations ../Vars ./VRControllers".split(" "),function(t,a,f,e,h,b){function k(){h.f.onEnteringVRObservable.add(function(){h.b.g=2;p();f.C(void 0);e.I();
window.vrHelper=h.f});h.f.onExitingVRObservable.add(function(){h.b.g=3;f.C(void 0);e.I()})}function m(){var a=new BABYLON.Mesh("vrNavTargetMesh",h.a),b=new BABYLON.VertexData;b.A=[0,0,0];b.i=[0];b.applyToMesh(a);a.isVisible=!1;return a}function p(){h.f.raySelectionPredicate=function(a){return f.fa(a)};h.f.gazeTrackerMesh=m();h.f.updateGazeTrackerScale=!1;h.f.displayGaze=!0;h.f.enableInteractions()}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){k();b.c()};a.Sa=p});q("Mols/CommonLoader",
"require exports ../Navigation/Pickables ../Scene/LoadAndSetup ../Scene/Optimizations ../Vars ./Shadows".split(" "),function(t,a,f,e,h,b,k){Object.defineProperty(a,"__esModule",{value:!0});a.Ba=function(){k.Va();BABYLON.OBJFileLoader.OPTIMIZE_WITH_UV=!0};a.Aa=function(a){k.Ua();void 0!==a.transparentGround&&!0===a.transparentGround&&(b.b.j?(b.b.j.visibility=1,a=new BABYLON.StandardMaterial("transparentGround",b.a),a.diffuseColor=new BABYLON.Color3(1,1,1),a.specularColor=new BABYLON.Color3(0,0,0),
a.emissiveColor=new BABYLON.Color3(0,0,0),a.alpha=b.va,b.b.j.material=a):console.log("Warning: Vars.vrVars.groundMesh not defined."));e.Ka()};a.Ta=function(a){if(void 0!==a.material&&null!==a.material){var b=k.Ea();b=.95<b.N?.05:.4>b.N?.0025:.013636363636363637*b.N-.0029545454545454545;a.material.emissiveColor=new BABYLON.Color3(b,b,b);h.ha(a)}a.scaling.z=-1;a.scaling.x=-1;k.o&&k.o.getShadowMap().renderList.push(a);f.za(a)}});q("Mols/3DMol/VRMLParserWebWorker",["require","exports"],function(t,a){function f(a){var g=
[];a=a.split("geometry IndexedFaceSet {").splice(1);for(var d in a)if(a.hasOwnProperty(d)){var l=a[d];g.push({colors:h(k("color [","]",l)),coors:e(k("point [","]",l)),trisIdxs:b(k("coordIndex [","]",l))})}void 0===c&&(c=m(g));d=c;a=g.length;for(l=0;l<a;l++)for(var r=g[l].coors.length,f=0;f<r;f+=3)g[l].coors[f]-=d[0],g[l].coors[f+1]-=d[1],g[l].coors[f+2]-=d[2];if(n){p=[];d=["colors","coors","trisIdxs"];for(var t in g)if(g.hasOwnProperty(t))for(var q in d)if(d.hasOwnProperty(q)){a=d[q];l=g[t][a];r=
[];f=0;for(var y=l.length;f<y;)r.push(l.slice(f,f+=1E7));l=r;for(var z in l)l.hasOwnProperty(z)&&p.push([+t,a,l[z]])}return[]}return g}function e(a){a=a.match(d);for(var b=a.length,c=new Float32Array(b),e=0;e<b;e+=3)c[e]=+a[e+2],c[e+1]=+a[e+1],c[e+2]=+a[e];return c}function h(a){a=a.match(d);for(var b=new Float32Array(4*a.length/3),c=b.length,e=0;e<c;e+=4){var f=3*e/4;b[e]=+a[f];b[e+1]=+a[f+1];b[e+2]=+a[f+2];b[e+3]=1}return b}function b(a){a=a.match(d);for(var b=3*a.length/4,c=new Uint32Array(b),
e=0;e<b;e+=3){var f=4*e/3;c[e]=+a[f];c[e+1]=+a[f+1];c[e+2]=+a[f+2]}return c}function k(a,b,c){a=c.split(a,2);if(1>=a.length)return"";a=a[1].split(b,2);return a[0]}function m(a){if(0===a.length)return new Float32Array([0,0,0]);var b=a.map(function(a){return a.coors.length}).reduce(function(a,b){return a+b});if(0===b)return new Float32Array([0,0,0]);for(var c=0,e=0,d=0,f=a.length,h=0;h<f;h++)for(var n=a[h].coors,m=n.length,k=0;k<m;k+=3)c+=n[k],e+=n[k+1],d+=n[k+2];a=b/3;return new Float32Array([c/a,
e/a,d/a])}Object.defineProperty(a,"__esModule",{value:!0});var p=void 0,d=/(^|-| )[0-9.]{1,8}/g,c=void 0,n=!1;"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&(n=!0);n&&(self.onmessage=function(a){var b=a.data.cmd;a=a.data.data;"start"===b&&(f(a),b="sendDataChunk");"sendDataChunk"===b&&(b=p.shift(),postMessage({chunk:b,status:0===p.length?"done":"more"}))});a.Ja=f});q("Mols/3DMol/VRML","require exports ../../Scene/Optimizations ../../Vars ../CommonLoader ./VRMLParserWebWorker".split(" "),
function(t,a,f,e,h,b){function k(b){var c=jQuery("#mol-container");c&&c.remove();jQuery("body").append('<div\n        id="mol-container"\n        class="mol-container"\n        style="display:none;"></div>');w=jQuery("#mol-container");l={backgroundColor:"white"};a.s=$3Dmol.createViewer(w,l);window.viewer=a.s;b()}function m(b){q=a.s.exportVRML();b()}function p(a){n=[];"undefined"!==typeof Worker?("undefined"===typeof x&&(x=new Worker("VRMLParserWebWorker.js")),x.onmessage=function(b){b=b.data;var c=
b.chunk;b=b.status;var e=c[0],d=c[1],g=c[2];n.length===e&&n.push({coors:new Float32Array(0),colors:new Float32Array(0),trisIdxs:new Uint32Array(0)});c=n[e];e=[n[e][d],g];for(var f=0,h=0;h<e.length;h++)g=e[h],f+=g.length;f=new ("trisIdxs"===d?Uint32Array:Float32Array)(f);for(var l=h=0;l<e.length;l++)g=e[l],f.set(g,h),h+=g.length;c[d]=f;switch(b){case "more":x.postMessage({cmd:"sendDataChunk",data:void 0});break;case "done":a();break;default:console.log("Error here!")}},x.postMessage({cmd:"start",data:q})):
(n=b.Ja(q),a())}function d(){var a=[],b;for(b in n)if(n.hasOwnProperty(b)){var c=n[b],d=[];BABYLON.VertexData.ComputeNormals(c.coors,c.trisIdxs,d);var g=new BABYLON.VertexData;g.positions=c.coors;g.indices=c.trisIdxs;g.normals=d;g.colors=c.colors;c=new BABYLON.Mesh("mesh_3dmol_tmp"+b,e.a);g.applyToMesh(c);g=new BABYLON.StandardMaterial("Material",e.a);g.diffuseColor=new BABYLON.Color3(1,1,1);g.emissiveColor=new BABYLON.Color3(0,0,0);g.specularColor=new BABYLON.Color3(0,0,0);c.material=g;a.push(c)}if(0<
a.length){var f=BABYLON.Mesh.MergeMeshes(a,!0,!0);f.name="MeshFrom3DMol"+Math.random().toString();f.id=f.name;h.Ta(f)}return f}function c(a,b){if(void 0!==a){a.scaling=new BABYLON.Vector3(1,1,1);a.position=new BABYLON.Vector3(0,0,0);e.a.render();if(void 0===r){var c=b.getBoundingInfo().boundingBox;b=Object.keys(c.maximumWorld).map(function(a){return c.maximumWorld[a]-c.minimumWorld[a]});var d=a.getBoundingInfo().boundingBox,h=Object.keys(d.maximumWorld).map(function(a){return d.maximumWorld[a]-d.minimumWorld[a]});
b=b.map(function(a,b){return a/h[b]});b=Math.min.apply(null,b);r=new BABYLON.Vector3(b,b,b);a.scaling=r;e.a.render();g=d.centerWorld.subtract(c.centerWorld);a.position=a.position.subtract(g)}else a.scaling=r,a.position=a.position.subtract(g);f.I()}}Object.defineProperty(a,"__esModule",{value:!0});var n=[],r=void 0,g=void 0,w,l,q,x,u="",v=!1;a.c=k;a.Pa=function(){v&&(v=!1,a.s=null,k(function(){a.s.addModel(u,"pdb")}));a.s.setStyle({},{})};a.Ia=function(b){jQuery.ajax("https://files.rcsb.org/view/1XDN.pdb",
{success:function(c){u=c;a.s.addModel(c,"pdb");b()},error:function(a,b,c){console.error("Failed to load PDB https://files.rcsb.org/view/1XDN.pdb: "+c)}})};a.setStyle=function(b,c){a.s.setStyle(b,c);a.s.render()};a.addSurface=function(b,c,d){v=!0;a.s.addSurface($3Dmol.SurfaceType.MS,b,c,void 0,void 0,function(){d()})};a.render=function(a,b){void 0===a&&(a=!0);void 0===b&&(b=function(){});e.l.hideLoadingUI();a&&m(function(){p(function(){var a=d();c(a,e.a.getMeshByName("protein_box"));b(a);n=[]})})};
a.cb=d;a.fb=c});q("Mols/3DMol/Visualize",["require","exports","../../Scene/Optimizations","./VRML"],function(q,a,f,e){function h(a,b){e.render(!0,function(c){for(var d in m)if(m.hasOwnProperty(d)){var e=m[d];e.B===a.B&&(f.Oa(e.mesh),delete m[d],console.log("deleting old mesh..."))}"Surface"===b&&(c.material.backFaceCulling=!1);m[a.V]={B:a.B,mesh:c};console.log("added new mesh")})}function b(a,b,d){a.sort();return{B:a.join("-")+"-"+b,V:a.join("-")+"-"+b+"-"+d}}function k(a){var b=a.map(function(a){return a}),
c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(d.toUpperCase());b.push(d.toLowerCase())}return b=b.filter(function(a,c){return b.indexOf(a)>=c})}Object.defineProperty(a,"__esModule",{value:!0});var m={},p={All:{},Protein:{resn:k("ALA ARG ASP ASN ASX CYS GLN GLU GLX GLY HIS HSP HYP ILE LEU LYS MET PCA PHE PRO TRP TYR VAL GLU SER THR MSE".split(" "))},Acidic:{resn:k(["ASP","GLU"])},Cyclic:{resn:k(["HIS","PHE","PRO","TRP","TYR"])},Aliphatic:{resn:k(["ALA","GLY","ILE","LEU","VAL"])},Aromatic:{resn:k(["HIS",
"PHE","TRP","TYR"])},Basic:{resn:k(["ARG","HIS","LYS","HSP"])},Charged:{resn:k("ASP GLU ARG HIS LYS HSP".split(" "))},Hydrophobic:{resn:k("ALA LEU VAL ILE PRO PHE MET TRP".split(" "))},Neutral:{resn:k("VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP".split(" "))},Nucleic:{resn:k("ADE A GUA G CYT C THY T URA U".split(" "))},Purine:{resn:k(["ADE","A","GUA","G"])},Pyrimidine:{resn:k("CYT C THY T URA U".split(" "))},Ions:{resn:k("AL BA CA CAL CD CES CLA CL CO CS CU CU1 CUA HG IN IOD K MG MN3 MO3 MO4 MO5 MO6 NA NAW OC7 PB POT PT RB SOD TB TL WO4 YB ZN ZN1 ZN2".split(" "))},
Water:{resn:k(["WAT","HOH","TIP","TIP3"])}};p.Ligand={not:{or:[p.Protein,p.Nucleic,p.Ions,p.Water]}};var d={Element:{colorscheme:"default"},Red:{color:"red"},Blue:{color:"blue"},Green:{color:"green"},Orange:{color:"orange"},Yellow:{color:"yellow"},Purple:{color:"purple"},Spectrum:{color:"spectrum"}};a.Za=function(a,f,k){var c=b(a,f,k);if("Hide"===k)for(var n in m)m.hasOwnProperty(n)&&(a=m[n],a.B===c.B&&(a.mesh.isVisible=!1,console.log("Hiding existing mesh...")));else void 0!==m[c.V]?(m[c.V].mesh.isVisible=
!0,console.log("showing existing mesh...")):(e.Pa(),n=d[k],a={and:a.map(function(a){return p[a]})},"surface"===f.toLowerCase()?e.addSurface(n,a,function(){h(c,f)}):(k={},k[f.toLowerCase()]=n,e.setStyle(a,k),h(c,f)))}});q("UI/Menu3D","require exports ../Cameras/CommonCamera ../Mols/3DMol/Visualize ../Navigation/Pickables ../Navigation/Points ../Vars".split(" "),function(q,a,f,e,h,b,k){function m(){function a(a){if(b.hasOwnProperty(a)){l[a]=new BABYLON.GUI.SpherePanel;t.addControl(l[a]);l[a].blockLayout=
!0;b[a].reverse();var c=function(c){if(b[a].hasOwnProperty(c)){c=b[a][c];var d=c.D,e=c.P;g.push(new D({v:function(){e()},default:!1,O:d,ka:function(a){a.isVisible(!1)},level:+a,name:"menu-visible-button-"+d,oa:l[a],R:d,color:c.color}));l[a].columns=4;window.panels=l;l[a].blockLayout=!1;l[a].linkToTransformNode(u);setInterval(function(){l[a].radius=k.ta;l[a].margin=k.sa},1E3)}},d;for(d in b[a])c(d)}}var b=p();b=d(b);u=new BABYLON.TransformNode("");t=new BABYLON.GUI.GUI3DManager(k.a);for(var c in b)a(c)}
function p(){function a(e,f,g){function h(d){if(l.hasOwnProperty(d)){d=l[d];var h=e[d];c[f]=void 0===c[f]?[]:c[f];switch(typeof h){case "function":c[f].push({P:h,D:d,F:g});break;case "object":var k=b(f+1);c[f].push({color:A,P:function(){n(k)},D:d+" \u21e8",F:g});a(h,k,f);break;default:alert("error!")}}}d.push(f);var l=Object.keys(e),k;for(k in l)h(k)}function b(a){for(;-1!==d.indexOf(a);)a++;return a}var c={},d=[];a(r,1,void 0);return c}function d(a){function b(b){if(a.hasOwnProperty(b)){a[b].sort(function(a,
b){return(""+a.D).localeCompare(b.D)});var c=+b;1<c&&a[b].push({color:y,P:function(){n(a[b][0].F)},D:"Back \u21e6",F:a[b][0].F});0<c&&a[b].push({color:z,P:function(){v.Z()},D:"Close Menu \u00d7",F:a[b][0].F})}}for(var c in a)b(c);console.log(a);return a}function c(){var a=new BABYLON.GUI.StackPanel3D;t.addControl(a);v=new D({v:function(a){a.value?n(1):n(0);u.position.copyFrom(f.m());u.rotation.y=f.ia()},default:!1,O:"Show Menu",level:0,name:"menu-visible-button",oa:a,R:"Hide Menu"});var c=new BABYLON.TransformNode("");
a.linkToTransformNode(c);c.rotation.x=.5*Math.PI;k.a.registerBeforeRender(function(){c.position.copyFrom(b.W);c.position.y+=.1;c.rotation.y=f.ia()})}function n(a){for(var b in g)if(g.hasOwnProperty(b)){var c=g[b];0===c.level?c.isVisible(!0):c.level===a?c.isVisible(!0):c.isVisible(!1)}}Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function a(a){if(b.hasOwnProperty(a)){var d=b[a];h[d]={};a=function(a){if(c[d].hasOwnProperty(a)){var b=c[d][a];h[d][b]={};a=function(a){if(f[d].hasOwnProperty(a)){var c=
f[d][a];h[d][b][c]={};a=function(a){if(g.hasOwnProperty(a)){var f=g[a];h[d][b][c][f]=function(){e.Za([d,b],c,f);v.Z()}}};for(var l in g)a(l)}};for(var l in f[d])a(l)}};for(var l in c[d])a(l)}}var b=["Protein","Ligand","Water","Nucleic"],c={Ligand:["All"],Nucleic:["All"],Protein:["All","Hydrophobic","Hydrophilic","Charged","Aromatic"],Water:["All"]},d=["Stick","Sphere","Surface"],f={Ligand:d,Nucleic:d,Protein:["Cartoon"].concat(d),Water:d},g="Element Red Blue Green Orange Yellow Purple Spectrum Hide".split(" "),
h={},l;for(l in b)a(l);return h}(),g=[],t,l={},u,x,v,A=new BABYLON.Color3(.3,.35+.1,.4),y=new BABYLON.Color3(.4,.35+.1,.4),z=new BABYLON.Color3(.4,.35,.4);a.c=function(a){m(a);c();x=new BABYLON.Sound("click-button","assets/staple-public-domain.mp3",k.a,null,{loop:!1,autoplay:!1,jb:!0,volume:.1})};var D=function(){function a(a){var b=this;this.button=new BABYLON.GUI.HolographicButton(a.name);a.oa.addControl(this.button);if(void 0!==a.color){var c=this.button.mesh.material.clone();c.albedoColor=a.color;
this.button.mesh.material=c}this.level=a.level;this.A=new BABYLON.GUI.TextBlock;this.A.color="white";this.A.i=!0;this.value=a.default;this.R=a.R;this.O=a.O;this.v=a.v;this.ea();this.i=BABYLON.Mesh.CreateSphere(a.name+"-container-mesh",2,k.S,k.a);this.i.position=this.button.node.absolutePosition;this.i.visibility=0;this.i.v=function(){b.Z()};h.ya(this.i);void 0!==a.ka&&a.ka(this)}a.prototype.isVisible=function(a){if(void 0===a)return this.button.isVisible;this.button.isVisible=a;this.i.isVisible=a};
a.prototype.Z=function(){x.setPosition(this.i.position.clone());x.play();this.value=!this.value;this.v(this);this.ea()};a.prototype.ea=function(){this.A.text=this.value?this.R:this.O;this.button.content.dispose();this.button.content=this.A};return a}()});q("Mols/3DMol/ThreeDMol",["require","exports","../CommonLoader","./VRML"],function(q,a,f,e){function h(a){e.c(function(){e.Ia(function(){e.setStyle({},{cartoon:{color:"spectrum"}});e.render(!0,function(){f.Aa(a)})})})}Object.defineProperty(a,"__esModule",
{value:!0});a.c=function(a){try{jQuery.getScript("https://3Dmol.csb.pitt.edu/build/3Dmol.js",function(){h(a)})}catch(k){h(a)}}});q("Mols/Load","require exports ../Scene/Optimizations ../UI/Menu3D ../Vars ./3DMol/ThreeDMol ./CommonLoader".split(" "),function(q,a,f,e,h,b,k){Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){k.Ba();jQuery.getJSON("scene_info.json",function(a){!1===a.menuActive&&(h.b.ma=!1);b.c(a);h.b.ma&&e.c(a);f.I()})}});q("UI/LoadingScreens",["require","exports","../Vars"],
function(q,a,f){function e(){clearInterval(h)}Object.defineProperty(a,"__esModule",{value:!0});var h;a.Na=function(){document.getElementById("loading-container").outerHTML=""};a.da=function(a){e();f.l.displayLoadingUI();f.l.loadingUIText=a};a.Xa=function(){var a=90;clearInterval(h);h=setInterval(function(){a+=.02*(99-a);f.l.displayLoadingUI();f.l.loadingUIText="Loading the main scene... "+a.toFixed(0)+"%"},100)};a.Ya=e});q("UI/UI2D",["require","exports","../Vars"],function(q,a,f){function e(){jQuery("body").append('\n        <button\n          title="Click to switch to full screen"\n          id="fullscreen-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:80px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n            <svg\n              style="position:relative; left:0.5px;"\n              width="48" height="48"\n              xmlns="http://www.w3.org/2000/svg"\n              xmlns:svg="http://www.w3.org/2000/svg"\n              clip-rule="evenodd">\n                <g class="layer">\n                    <path d="m47.799999,43.649999l-47.699999,0l0,-39.749999l47.699999,0l0,39.749999zm-1.9875,-37.762499l-43.724999,0l0,35.774999l43.724999,0l0,-35.774999zm-7.95,13.9125l-1.9875,0l0,-6.441487l-22.341487,22.341487l6.441487,0l0,1.9875l-9.9375,0l0,-9.9375l1.9875,0l0,6.441487l22.341487,-22.341487l-6.441487,0l0,-1.9875l9.9375,0l0,9.9375z" fill="#ffffff" id="svg_1"/>\n                </g>\n            </svg>\n        </button>\n\n        <button\n          title="Click for help"\n          id="help-button"\n          class="ui-button"\n          style="color:white;\n                 width:80px;\n                 right:20px;\n                 position:absolute;\n                 height:50px;\n                 bottom:140px;\n                 background-color:rgba(51,51,51,0.7);\n                 border:none;\n                 outline:none;\n                 cursor:pointer;">\n                 <svg version="1.2" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" xml:space="preserve">\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="\n\tM35.5,9.8c1.7,5.4-0.6,8-1.6,8.9c-1.9,1.9-4.5,4.7-5.8,7c-1.5,2.7-4.1,12-6.8,4.4c-3.2-9.1,1.3-11.6,3.5-13.4\n\tc1.5-1.3,3.4-4.3,0.5-5.3c-4-1.3-6.1,5.3-10.7,4c-3-0.8-3.2-4.1-2.2-6.6C15.4,1.7,32.5,0.6,35.5,9.8L35.5,9.8z"/>\n<path fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" d="M28.3,39.6c0-5.5-8.5-5.5-8.5,0S28.3,45.1,28.3,39.6\n\t"/>\n</svg>\n\n        </button>\n    ');
jQuery("#fullscreen-button").click(function(){f.l.switchFullscreen(!0);jQuery("#renderCanvas").focus()});jQuery("#help-button").click(function(){window.open("help/index.html","_blank")});document.getElementById("babylonVRiconbtn").style.opacity="1.0";document.getElementById("babylonVRiconbtn").style.filter="alpha(opacity=1.0)"}Object.defineProperty(a,"__esModule",{value:!0});a.c=function(){e()};window.debugMode=function(){f.a.debugLayer.show();setTimeout(function(){document.getElementById("inspector-host").style.zIndex=
"15";document.getElementById("scene-explorer-host").style.zIndex="15"},500)}});q("Scene/LoadAndSetup","require exports ../Cameras/Setup ../Cameras/VRCamera ../Mols/Load ../Navigation/Navigation ../Navigation/Pickables ../UI/LoadingScreens ../UI/UI2D ../Vars ./Optimizations".split(" "),function(q,a,f,e,h,b,k,m,p,d,c){function n(){var a=BABYLON.Mesh.CreateSphere("navTargetMesh",4,.1,d.a),b=new BABYLON.StandardMaterial("myMaterial",d.a);b.diffuseColor=new BABYLON.Color3(1,0,1);a.material=b;d.Wa({ja:"ground",
na:a});e.c();c.c();window.i=d}function r(a){m.da("Loading the main scene...");BABYLON.SceneLoader.LoadAssetContainer("scene/","scene.babylon",d.a,function(b){m.Xa();d.a.executeWhenReady(function(){b.addAllToScene();d.a.activeCamera=d.a.cameras[0];for(var e=!1,f=0;1<d.a.lights.length;){var g=d.a.lights[f].name.toLowerCase();-1===g.indexOf("shadowlight")&&-1===g.indexOf("shadow_light")?d.a.lights[f].dispose():e?d.a.lights[f].dispose():(e=!0,f++)}for(var h in d.a.meshes)"protein_box"===d.a.meshes[h].name&&
(d.a.getMeshByName("protein_box").isVisible=!1);for(var m in d.a.meshes)if(d.a.meshes[m].material){e=d.a.meshes[m];if(void 0===e.material.emissiveTexture||null===e.material.emissiveTexture)e.material.emissiveTexture=e.material.diffuseTexture,e.material.diffuseColor=new BABYLON.Color3(0,0,0),e.material.specularColor=new BABYLON.Color3(0,0,0),e.material.emissiveColor=new BABYLON.Color3(0,0,0);c.ha(e,!1);k.la({mesh:e,a:d.a})}a()})},function(a){a.lengthComputable&&m.da("ALoading the main scene... "+Math.round(90*
a.loaded/a.total).toString()+"%")})}Object.defineProperty(a,"__esModule",{value:!0});a.load=function(){d.c();m.Na();n();r(function(){f.c();b.c();k.c();p.c();h.c()});window.addEventListener("resize",function(){d.l.resize()})};a.Ka=function(){setTimeout(c.I,1E3);m.Ya();d.a.activeCamera.maxZ=250;d.a.activeCamera.minZ=0;d.l.runRenderLoop(function(){d.a.render()})}});u.M({urlArgs:"bust="+(new Date).getTime()});u(["Scene/LoadAndSetup"],function(q){q.load()});q("Start",function(){})})();
